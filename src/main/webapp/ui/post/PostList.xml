<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>COMPONENT</w2:type>
		<w2:buildDate />
		<w2:MSA />
		<xf:model>
			<w2:dataCollection baseNode="map">
				<w2:dataMap baseNode="map" id="dmp_postVo" style="">
					<w2:keyInfo>
						<w2:key dataType="text" id="pageIndex" name="페이지_번호" defaultValue="1"></w2:key>
						<w2:key dataType="text" id="pageSize" name="페이지_건수" defaultValue="10"></w2:key>
					</w2:keyInfo>
					<w2:data use="false"></w2:data>
				</w2:dataMap>
				<w2:dataList baseNode="list" id="dlt_postVoList" repeatNode="map" saveRemovedData="true" style="">
					<w2:columnInfo>
						<w2:column dataType="text" id="jobPostingId" name="job_posting_id"></w2:column>
                        <w2:column dataType="text" id="companyId" name="company_id"></w2:column>
                        <w2:column dataType="text" id="title" name="title"></w2:column>
                        <w2:column dataType="text" id="description" name="description"></w2:column>
                        <w2:column dataType="text" id="requiredSkills" name="required_skills"></w2:column>
                        <w2:column dataType="text" id="experienceLevel" name="experience_level"></w2:column>
                        <w2:column dataType="text" id="salaryRange" name="salary_range"></w2:column>
                        <w2:column dataType="text" id="location" name="location"></w2:column>
                        <w2:column dataType="text" id="workType" name="work_type"></w2:column>
                        <w2:column dataType="text" id="preferredDeveloperTypes" name="preferred_developer_types"></w2:column>
                        <w2:column dataType="text" id="expiresAt" name="expires_at"></w2:column>
                        <w2:column dataType="text" id="postedAt" name="posted_at"></w2:column>
                        <w2:column dataType="text" id="status" name="status"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dmp_postVoDetail" style="">
					<w2:keyInfo>
						<w2:key dataType="text" id="jobPostingId" name="job_posting_id"></w2:key>
						<w2:key dataType="text" id="companyId" name="company_id"></w2:key>
						<w2:key dataType="text" id="title" name="title"></w2:key>
						<w2:key dataType="text" id="description" name="description"></w2:key>
						<w2:key dataType="text" id="requiredSkills" name="required_skills"></w2:key>
						<w2:key dataType="text" id="experienceLevel" name="experience_level"></w2:key>
						<w2:key dataType="text" id="salaryRange" name="salary_range"></w2:key>
						<w2:key dataType="text" id="location" name="location"></w2:key>
						<w2:key dataType="text" id="workType" name="work_type"></w2:key>
						<w2:key dataType="text" id="preferredDeveloperTypes" name="preferred_developer_types"></w2:key>
						<w2:key dataType="text" id="expiresAt" name="expires_at"></w2:key>
						<w2:key dataType="text" id="postedAt" name="posted_at"></w2:key>
						<w2:key dataType="text" id="status" name="status"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>

			<!-- 공고 목록 조회 -->
			<xf:submission id="sbm_selectPostVoList" ref='data:json,{"id":"dmp_postVo","key":"postVo"}'
				target='data:json,{"id":"dlt_postVoList","key":"elData.postVoList"}' action="/InsWebApp/POS0001List.pwkjson" method="post"
				mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
				processMsg="공고정보 리스트를 조회 중입니다." ev:submit="" ev:submitdone="scwin.sbm_postList_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>
			
			<!-- 공고 수정 -->
			<xf:submission id="sbm_updatePostVo" ref='data:json,{"id":"dmp_postVoDetail","key":"postVo"}'
				target="" action="/InsWebApp/POS0001Upd.pwkjson" method="post"
				mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
				processMsg="공고정보를 수정 중입니다." ev:submit="" ev:submitdone="scwin.sbm_updatePost_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>
			
			<!-- 공고 삭제 -->
			<xf:submission id="sbm_deletePostVo" ref='data:json,{"id":"dmp_postVoDetail","key":"postVo"}'
				target="" action="/InsWebApp/POS0001Del.pwkjson" method="post"
				mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
				processMsg="공고정보를 삭제 중입니다." ev:submit="" ev:submitdone="scwin.sbm_deletePost_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>
		</xf:model>
		<w2:layoutInfo></w2:layoutInfo>
		<w2:publicInfo method="" />
		<script lazy="false" type="text/javascript"><![CDATA[
	
	scwin.onpageload = function() {		
		console.log("=== PostList 페이지 로드 ===");
		
		//search_box
        var cptIbxName = $p.getComponentById("searchComp_1");
        if(cptIbxName == undefined){
			search_box.hide();
        }
		
		// 공고정보 조회
		scwin.btn_search_onclick();
	};

	/************************** 이벤트 함수 *************************/
	
	/**
	 * 조회 버튼 클릭 이벤트
	 */		   
	scwin.btn_search_onclick = function(e) {
		console.log("=== 공고 목록 조회 시작 ===");
		
		// PGAE번호 초기화
		dmp_postVo.set("pageIndex","1");
		pgl_postList.setSelectedIndex(1);

		// 서버통신 - 공고정보 조회
		$c.sbm.execute($p, sbm_selectPostVoList);
	};
	
	/**
	 * 공고 목록 조회 완료
	 */
	scwin.sbm_postList_submitdone = function(e) {
		console.log("=== 공고 목록 조회 완료 ===");
		console.log("응답 데이터:", e.responseJSON);

		// error 수신시
		var elData = e.responseJSON.elData;
		var elHeader  = e.responseJSON.elHeader;
		if(elHeader == null || elHeader == "" || elHeader == "undefined" || elHeader.resSuc == false) {
			console.error("공고 목록 조회 에러:", elHeader);
			alert(`에러코드 : ${elHeader.resCode}\n에러메시지 : ${elHeader.resMsg}`);
			return false;
		}

		// 공고정보 dataMap 초기화
		dmp_postVoDetail.setEmptyValue();

		// 총 레코드 수 업데이트
        spn_listCnt.setLabel(elData.totalCount);
        
        // 데이터를 그리드에 셋팅
        dlt_postVoList.setJSON(elData.postVoList);
        console.log("✅ GridView에 데이터 바인딩 완료 - 총 " + dlt_postVoList.getRowCount() + "개");
        
        // 페이지 네비게이터 업데이트
        var totalPageCount = Math.ceil(elData.totalCount / dmp_postVo.get("pageSize"));
        pgl_postList.setCount(totalPageCount);
        
		// 페이징 정보 업데이트
        spn_totalPageCount.setValue(totalPageCount);
        spn_pageIndex.setValue(dmp_postVo.get("pageIndex"));
        pgl_postList.setSelectedIndex(dmp_postVo.get("pageIndex"));
        
        // 데이터 확인 로그
        for (var i = 0; i < Math.min(dlt_postVoList.getRowCount(), 3); i++) {
            console.log("공고 " + (i+1) + ":");
            console.log("- ID:", dlt_postVoList.getCellData(i, "jobPostingId"));
            console.log("- 제목:", dlt_postVoList.getCellData(i, "title"));
            console.log("- 상태:", dlt_postVoList.getCellData(i, "status"));
        }
	};		

	/**
	 * GridView 행 클릭 이벤트 (상세 조회) - 표준 패턴 적용
	 */
	scwin.grd_list_oncellclick = function(row, col) {
		console.log("=== 공고 행 클릭 ===");
		console.log("선택된 행:", row);
		
		if (row < 0) return;
		
		// ✅ 표준 패턴: 그리드 데이터를 detail DataMap에 직접 복사
		dmp_postVoDetail.setJSON(dlt_postVoList.getRowJSON(row));
		
		var postData = dmp_postVoDetail.getJSON();
		console.log("선택된 공고 데이터:", postData);
		
		// 상세보기/수정 UI 표시
		scwin.showPostDetail();
	};
	
	/**
	 * 공고 상세보기/수정 UI 표시
	 */
	scwin.showPostDetail = function() {
		var postData = dmp_postVoDetail.getJSON();
		
		var message = "������ 공고 상세 정보\n\n" +
					 "ID: " + (postData.jobPostingId || "정보없음") + "\n" +
					 "제목: " + (postData.title || "정보없음") + "\n" +
					 "설명: " + (postData.description || "정보없음") + "\n" +
					 "위치: " + (postData.location || "정보없음") + "\n" +
					 "근무형태: " + scwin.getWorkTypeText(postData.workType) + "\n" +
					 "상태: " + scwin.getStatusText(postData.status) + "\n" +
					 "경력수준: " + (postData.experienceLevel || "정보없음") + "\n" +
					 "급여범위: " + (postData.salaryRange || "정보없음") + "\n\n" +
					 "수정하시겠습니까?";
		
		// 수정 여부 확인
		if (confirm(message)) {
			scwin.showEditForm(postData);
		}
	};
	
	/**
	 * 수정 폼 표시 (간단한 prompt 버전)
	 */
	scwin.showEditForm = function(postData) {
		console.log("=== 수정 모드 ===");
		console.log("기존 데이터:", postData);
		
		var newTitle = prompt("공고 제목을 수정하세요:", postData.title || "");
		if (newTitle === null) return; // 취소한 경우
		
		var newDescription = prompt("공고 설명을 수정하세요:", postData.description || "");
		if (newDescription === null) return; // 취소한 경우
		
		var newLocation = prompt("근무 지역을 수정하세요:", postData.location || "");
		if (newLocation === null) return; // 취소한 경우
		
		// ✅ 기존 데이터를 모두 유지하면서 수정된 부분만 변경
		var updateData = {
			jobPostingId: postData.jobPostingId,				// 필수: 공고 ID
			companyId: postData.companyId,						// 필수: 회사 ID  
			title: newTitle,									// 수정: 제목
			description: newDescription,						// 수정: 설명
			location: newLocation,								// 수정: 지역
			// 기존 값들 유지
			requiredSkills: postData.requiredSkills || "",
			experienceLevel: postData.experienceLevel || "",
			salaryRange: postData.salaryRange || "",
			workType: postData.workType || "",
			preferredDeveloperTypes: postData.preferredDeveloperTypes || "",
			expiresAt: postData.expiresAt || "",
			postedAt: postData.postedAt || "",
			status: postData.status || "active",
			selectedTechStackNames: postData.selectedTechStackNames || "[]"
		};
		
		console.log("전송할 수정 데이터:", updateData);
		
		// 수정 확인
		if (confirm("수정된 내용을 저장하시겠습니까?")) {
			// ✅ 전체 데이터를 dmp_postVoDetail에 설정
			dmp_postVoDetail.setJSON(updateData);
			
			// 수정 요청
			$c.sbm.execute($p, sbm_updatePostVo);
		}
	};
	
	/**
	 * 공고 수정 완료
	 */
	scwin.sbm_updatePost_submitdone = function(e) {
		console.log("=== 공고 수정 완료 ===");
		console.log("수정 응답:", e.responseJSON);
		
		var elHeader = e.responseJSON.elHeader;
		if(elHeader == null || elHeader == "" || elHeader == "undefined" || elHeader.resSuc == false) {
			console.error("공고 수정 에러:", elHeader);
			alert(`수정 에러\n에러코드 : ${elHeader.resCode}\n에러메시지 : ${elHeader.resMsg}`);
			return false;
		}
		
		alert("공고가 성공적으로 수정되었습니다!");
		
		// 목록 새로고침
		scwin.btn_search_onclick();
	};
	
	/**
	 * 삭제 버튼 클릭 - 표준 패턴 적용
	 */
	scwin.btn_delete_onclick = function() {
		console.log("=== 삭제 버튼 클릭 ===");
		
		var selectedRowIndex = grd_list.getSelectedRowIndex();
		if (selectedRowIndex < 0) {
			alert("삭제할 공고를 선택해주세요.");
			return;
		}
		
		// ✅ 표준 패턴: 선택된 행의 데이터를 detail에 설정
		dmp_postVoDetail.setJSON(dlt_postVoList.getRowJSON(selectedRowIndex));
		var postData = dmp_postVoDetail.getJSON();
		
		console.log("삭제 대상 - ID:", postData.jobPostingId, "제목:", postData.title);
		
		if (confirm("'" + postData.title + "' 공고를 삭제하시겠습니까?\n\n삭제된 공고는 복구할 수 없습니다.")) {
			// 삭제 요청
			$c.sbm.execute($p, sbm_deletePostVo);
		}
	};
	
	/**
	 * 공고 삭제 완료
	 */
	scwin.sbm_deletePost_submitdone = function(e) {
		console.log("=== 공고 삭제 완료 ===");
		console.log("삭제 응답:", e.responseJSON);
		
		var elHeader = e.responseJSON.elHeader;
		if(elHeader == null || elHeader == "" || elHeader == "undefined" || elHeader.resSuc == false) {
			console.error("공고 삭제 에러:", elHeader);
			alert(`삭제 에러\n에러코드 : ${elHeader.resCode}\n에러메시지 : ${elHeader.resMsg}`);
			return false;
		}
		
		alert("공고가 성공적으로 삭제되었습니다!");
		
		// 목록 새로고침
		scwin.btn_search_onclick();
	};

	/**
	 * 페이지 번호 클릭 이벤트
	 */
	scwin.pgl_postList_onclick = function(idx) {
		console.log("=== 페이지 변경 ===", idx);
		
		// 페이지 번호 세팅
		dmp_postVo.set( "pageIndex" , idx ); 
		// 서버통신 - 공고목록 조회
		$c.sbm.execute($p, sbm_selectPostVoList);
	};
	
	/**
	 * 새 공고 작성 버튼 클릭
	 */
	scwin.btn_new_onclick = function() {
		console.log("=== 새 공고 작성 ===");
		
		// CreatePosting 페이지로 이동
		$p.url("CreatePosting.xml");
	};
	
	// =========================
	// 유틸리티 함수들
	// =========================
	
	/**
	 * 근무형태 한글 변환
	 */
	scwin.getWorkTypeText = function(workType) {
		switch(workType) {
			case 'remote': return '원격근무';
			case 'onsite': return '출근근무';
			case 'hybrid': return '하이브리드';
			default: return workType || '정보없음';
		}
	};

	/**
	 * 상태 한글 변환
	 */
	scwin.getStatusText = function(status) {
		switch(status) {
			case 'active': return '활성';
			case 'closed': return '마감';
			case 'draft': return '임시저장';
			default: return status || '정보없음';
		}
	};
	
	/**
	 * 날짜 포맷팅
	 */
	scwin.formatDate = function(dateString) {
		if (!dateString) return "-";
		
		try {
			var date = new Date(dateString);
			var year = date.getFullYear();
			var month = String(date.getMonth() + 1).padStart(2, '0');
			var day = String(date.getDate()).padStart(2, '0');
			
			return year + '-' + month + '-' + day;
		} catch (error) {
			return dateString;
		}
	};

]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload">
		<xf:group class="sub_contents " id="" style="">
			<xf:group class="pgtbox" id="" style="">
				<w2:textbox class="pgt_tit" id="" label="공고정보 관리" style="" tagname="" />
			</xf:group>
			<xf:group class="schbox" id="search_box" style="">
				<xf:group class="schbox_inner" id="" style="">
					<xf:group adaptive="layout" adaptiveThreshold="1200" class="w2tb tbl" id="" style="width:Infinity%;" tagname="table">
						<w2:attributes>
							<w2:summary />
						</w2:attributes>
						<xf:group tagname="colgroup">
							
						</xf:group>
						<xf:group class="" id="" style="" tagname="tr">
							<xf:group class="" id="" style="" tagname="tr">
								
							</xf:group>
						</xf:group>
					</xf:group>
				</xf:group>
				<xf:group class="btn_schbox" id="" style="">
					<xf:trigger class="btn_cm sch" disabled="" escape="false" id="btn_search" style="" type="button" ev:onclick="scwin.btn_search_onclick" localeRef="COMMON_BUTTON_00001">
						<xf:label><![CDATA[조회]]></xf:label>
					</xf:trigger>
				</xf:group>
			</xf:group>
			
			<!-- 관리 버튼 영역 추가 -->
			<xf:group class="titbox" id="" style="">
				<xf:group class="count" id="">
					<w2:span id="" label="총" localeRef="COMMON_LABEL_00002" style=""></w2:span>
    				<w2:span class="num" id="spn_listCnt" label="0" ref="" style=""></w2:span>
    				<w2:span id="" label="건" localeRef="COMMON_LABEL_00003" style=""></w2:span>
    			</xf:group>
    			<xf:group class="rt" id="" style="">
    				<xf:trigger class="btn_cm add" id="btn_new" style="" type="button" ev:onclick="scwin.btn_new_onclick">
    					<xf:label><![CDATA[신규 공고]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class="btn_cm del" id="btn_delete" style="" type="button" ev:onclick="scwin.btn_delete_onclick">
    					<xf:label><![CDATA[삭제]]></xf:label>
    				</xf:trigger>
    			</xf:group>
			</xf:group>
			
			<xf:group adaptiveThreshold="" class="gvwbox" id="" style="">
				<w2:gridView autoFit="allColumn" checkReadOnlyOnPasteEnable="" class="gvw" dataList="data:dlt_postVoList"
					defaultCellHeight="26" focusMode="row" id="grd_list" scrollByColumn="false" scrollByColumnAdaptive="false" style="height: 300px;"
					visibleRowNum="10" ev:oncellclick="scwin.grd_list_oncellclick" readOnly="true">
					<w2:caption style="" id="caption2" value="공고 목록 (행을 클릭하면 상세보기/수정이 가능합니다)"></w2:caption>
					<w2:header style="" id="header2">
						<w2:row style="" id="row3">
							<w2:column width="80" inputType="text" style="" id="column1" value="공고ID" displayMode="label"></w2:column>
                            <w2:column width="200" inputType="text" style="" id="column2" value="제목" displayMode="label"></w2:column>
                            <w2:column width="250" inputType="text" style="" id="column3" value="설명" displayMode="label"></w2:column>
                            <w2:column width="100" inputType="text" style="" id="column4" value="지역" displayMode="label"></w2:column>
                            <w2:column width="100" inputType="text" style="" id="column5" value="근무형태" displayMode="label"></w2:column>
                            <w2:column width="80" inputType="text" style="" id="column6" value="상태" displayMode="label"></w2:column>
                            <w2:column width="100" inputType="text" style="" id="column7" value="등록일" displayMode="label"></w2:column>
						</w2:row>
					</w2:header>
					<w2:gBody style="" id="gBody2">
						<w2:row style="" id="row4">
							<w2:column width="80" inputType="text" style="" id="jobPostingId" value="" displayMode="label"></w2:column>
                            <w2:column width="200" inputType="text" style="" id="title" value="" displayMode="label"></w2:column>
                            <w2:column width="250" inputType="text" style="" id="description" value="" displayMode="label"></w2:column>
                            <w2:column width="100" inputType="text" style="" id="location" value="" displayMode="label"></w2:column>
                            <w2:column width="100" inputType="text" style="" id="workType" value="" displayMode="label"></w2:column>
                            <w2:column width="80" inputType="text" style="" id="status" value="" displayMode="label"></w2:column>
                            <w2:column width="100" inputType="text" style="" id="postedAt" value="" displayMode="label"></w2:column>
						</w2:row>
					</w2:gBody>
				</w2:gridView>
			</xf:group>
			<xf:group class="pglbox" id="" style="">
				<w2:pageList class="pgl" displayButtonType="display" displayFormat="#" id="pgl_postList" pageSize="5" pagingType="0"
					style="" ev:onclick="scwin.pgl_postList_onclick">
				</w2:pageList>	
				<xf:group class="pgl_count" id="" style="display: none;">
    				<w2:span class="num" id="spn_pageIndex" label="0" ref="data:dma_postVo.pageIndex" style=""></w2:span>
    				<w2:span id="span1" label="/" style=""></w2:span>
    				<w2:span id="spn_totalPageCount" label="0" ref="data:dma_postVo.totalPageCount" style=""></w2:span>
    				<w2:span id="span2" label="페이지" localeRef="COMMON_LABEL_00005" style=""></w2:span>
    			</xf:group>		
			</xf:group>
		</xf:group>
	</body>
</html>