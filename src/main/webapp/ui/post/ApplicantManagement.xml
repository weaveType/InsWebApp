<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head meta_screenName="지원자 상세보기">
		<w2:type>COMPONENT</w2:type>
		<w2:buildDate />
		<w2:MSA />
		<w2:layoutInfo />
		<w2:publicInfo method="" />
		<link rel="stylesheet" type="text/css" href="../../cm/css/gridview-enhancement.css"></link>
		<style>
			
			.stats-info {
			color: #6c757d;
			font-size: 14px;
			}
			.control-bar {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 15px 20px;
			background-color: #ffffff;
			}
			.selected-count {
			color: #6c757d;
			font-size: 14px;
			}
			.button-group {
			display: flex;
			align-items: center;
			gap: 10px;
			}
			.btn-template {
			background-color: #6c757d;
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			cursor: pointer;
			}
			.btn-approve {
			background-color: #28a745;
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			cursor: pointer;
			}
			.btn-reject {
			background-color: #dc3545;
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			cursor: pointer;
			}
			.skill-tag {
			display: inline-block;
			background-color: #e3f2fd;
			color: #1976d2;
			padding: 2px 8px;
			margin: 2px;
			border-radius: 12px;
			font-size: 12px;
			border: 1px solid #bbdefb;
			}
			.mbti-badge {
			background-color: #9c27b0;
			color: white;
			padding: 4px 8px;
			border-radius: 4px;
			font-size: 12px;
			font-weight: bold;
			}
			.preview-link {
			color: #007bff;
			text-decoration: none;
			cursor: pointer;
			}
			.preview-link:hover {
			text-decoration: underline;
			}
			.school-badge {
			background-color: #28a745;
			color: white;
			padding: 2px 6px;
			border-radius: 3px;
			font-size: 11px;
			margin-left: 5px;
			}
			.status-waiting {
			background-color: #ffc107;
			color: #212529;
			padding: 4px 8px;
			border-radius: 4px;
			font-size: 12px;
			font-weight: bold;
			}

			/* 이메일 작성 모달 스타일 */
			.email-modal {
			display: none; /* 기본적으로 숨김 */
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background-color: white;
			border-radius: 8px;
			padding: 20px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			width: 400px;
			z-index: 1000;
			}
			.email-modal-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
			z-index: 999;
			}
			.email-modal input, .email-modal textarea {
			width: 100%;
			margin: 8px 0;
			padding: 8px;
			border-radius: 4px;
			border: 1px solid #ddd;
			}
			.email-modal button {
			padding: 8px 16px;
			background-color: #28a745;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			}
			.email-modal button.cancel {
			background-color: #dc3545;
			}
		</style>
		<xf:model>
			<w2:dataCollection baseNode="map">
				<w2:dataList baseNode="list" repeatNode="map" id="dlt_applicantVoList" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column dataType="text" name="체크박스" id="chk"></w2:column>
						<w2:column dataType="text" name="이름" id="name"></w2:column>
						<w2:column dataType="text" name="경력" id="career"></w2:column>
						<w2:column dataType="text" name="포지션" id="currentPosition"></w2:column>
						<w2:column dataType="text" name="기술스택" id="techStack"></w2:column>
						<w2:column dataType="text" name="mbti" id="typeCode"></w2:column>
						<w2:column dataType="text" name="이력서" id="resumeFileName"></w2:column>
						<w2:column dataType="text" name="상태" id="applicationStatus"></w2:column>
						<w2:column dataType="text" name="이메일" id="email"></w2:column>
						<w2:column dataType="text" name="유저 ID" id="accountId"></w2:column>
					</w2:columnInfo>
					<w2:data use="false"></w2:data>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dmp_applicantVo">
					<w2:keyInfo>
						<w2:key dataType="text" name="페이지_번호" id="pageIndex" defaultValue="1"></w2:key>
						<w2:key dataType="text" name="페이지_건수" id="pageSize" defaultValue="10"></w2:key>
						<w2:key dataType="number" name="공고_id" id="jobPostingId"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
			</w2:dataCollection>
			<xf:submission id="sbm_applicantList" action="/InsWebApp/US0002List.pwkjson" method="post" mediatype="application/json" ref='data:json,{"id":"dmp_applicantVo","key":"applicantVo"}'
				target='data:json,{"id":"dlt_applicantVoList","key":"elData.applicantDetailVo"}' encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="지원자 목록을 조회중입니다." ev:submit=""
				ev:submitdone="scwin.sbm_applicantList_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>
		</xf:model>
		<script lazy="false" type="text/javascript"><![CDATA[scwin.onpageload = function () {
    var jobPostingId = null;

    if (!jobPostingId) {
        try {
            var href = window.location.href;
            var match = href.match(/[?&]jobPostingId=([^&]*)/);
            if (match && match[1]) {
                jobPostingId = decodeURIComponent(match[1]);
            }
        } catch (e) {
            console.log("location.href 파싱 실패:", e);
        }
    } else {
        // 비정상적 접근. 이전페이지로 이동
    }
    dmp_applicantVo.set("jobPostingId", jobPostingId);
    $c.sbm.execute(sbm_applicantList);
};

// 선택된 항목 수 업데이트
scwin.updateSelectedCount = function () {
    var checkedRows = gridView.getCheckedIndex("chk");
    var count = checkedRows.length;
    selectedCount.setValue(count + "명 선택됨");
};

// 서브미션 완료 후 체크박스 이벤트 바인딩
scwin.sbm_applicantList_submitdone = function (e) {

    // 초기 선택 수 표시
    scwin.updateSelectedCount();
};


scwin.pass_btn_onclick = function (e) {

    var checkedData = gridView.getCheckedIndex("chk");

    if (checkedData.length === 0) {
        $c.win.alert("선택된 지원자가 없습니다.");
        return;
    }

    // 이메일 및 이름추출
    let extractedEmails = [];
    let extractedNames = [];
    var emailInfoList = checkedData.map(function (rowIndex) {
        let email = dlt_applicantVoList.getCellData(rowIndex, "email");
        let name = dlt_applicantVoList.getCellData(rowIndex, "name");

        if (email) {
            extractedEmails.push(email);
        };

        if (name) {
            extractedNames.push(name);
        }
    });

    $c.win.openPopup("PassEmail.xml", {
        id: "pop_passEmail",
        type: "wframePopup",
        width: "700px",
        height: "650px",
        popupName: "합격 메일 보내기",
        modal: true
    }, {
        selectedUsers: emailInfoList  // 데이터 전달
    });

}

scwin.fail_btn_onclick = function (e) {

    var checkedData = gridView.getCheckedIndex("chk");

    if (checkedData.length === 0) {
        $c.win.alert("선택된 지원자가 없습니다.");
        return;
    }

    // 이메일 및 이름추출
    let extractedEmails = [];
    let extractedNames = [];
    var emailInfoList = checkedData.map(function (rowIndex) {
        let email = dlt_applicantVoList.getCellData(rowIndex, "email");
        let name = dlt_applicantVoList.getCellData(rowIndex, "name");

        if (email) {
            extractedEmails.push(email);
        };

        if (name) {
            extractedNames.push(name);
        }
    });

    // 팝업 생성 옵션
    $c.win.openPopup("FailEmail.xml", {
        id: "pop_failEmail",
        type: "wframePopup",
        width: "700px",
        height: "650px",
        popupName: "불합격 메일 보내기",
        modal: true
    }, {
        selectedUsers: emailInfoList  // 데이터 전달
    });
};
]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload">
		<w2:wframe src="../common/Header.xml" id="headerFrame" />
		<xf:group class="sub_contents" style="background-color:#f8f9fa;">

			<!-- 컨트롤 바 -->
			<xf:group
				style="display:flex; justify-content:center; background-color:#ffffff; border-bottom:1px solid #e9ecef; padding:15px 0;">
				<xf:group class="control-bar"
					style="display:flex;justify-content:space-between;align-items:center;max-width:1100px;width:94.92%;padding:0 min(30px, 4vw);">
					<xf:group style="display:flex; align-items:center; gap:10px;">
						<w2:selectbox id="mbtiFilter" style="width: 120px;height: 32px;" submenuSize="auto" appearance="minimal" direction="auto"
							chooseOption="true" chooseOptionLabel="MBTI 필터">
							<w2:choices>
								<w2:item>
									<w2:label><![CDATA[ENTJ]]></w2:label>
									<w2:value><![CDATA[entj]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[INFP]]></w2:label>
									<w2:value><![CDATA[infp]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[ENFP]]></w2:label>
									<w2:value><![CDATA[enfp]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[ISFJ]]></w2:label>
									<w2:value><![CDATA[isfj]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[ENTP]]></w2:label>
									<w2:value><![CDATA[entp]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[INTJ]]></w2:label>
									<w2:value><![CDATA[intj]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[ESTP]]></w2:label>
									<w2:value><![CDATA[estp]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[ISFP]]></w2:label>
									<w2:value><![CDATA[isfp]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[ESFJ]]></w2:label>
									<w2:value><![CDATA[esfj]]></w2:value>
								</w2:item>
							</w2:choices>
						</w2:selectbox>

						<!-- 기술스택 필터를 MultiSelect로 변경 -->
						<w2:multiselect id="techStackFilter" style="width: 200px;height: 32px;" separator=" " appearance="minimal">
							<w2:item>
								<w2:label><![CDATA[Spring Boot]]></w2:label>
								<w2:value><![CDATA[springboot]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Spring]]></w2:label>
								<w2:value><![CDATA[spring]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[React]]></w2:label>
								<w2:value><![CDATA[react]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Django]]></w2:label>
								<w2:value><![CDATA[django]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Vue]]></w2:label>
								<w2:value><![CDATA[vue]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[JavaScript]]></w2:label>
								<w2:value><![CDATA[js]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[TypeScript]]></w2:label>
								<w2:value><![CDATA[typescript]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Node.js]]></w2:label>
								<w2:value><![CDATA[nodejs]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Angular]]></w2:label>
								<w2:value><![CDATA[angular]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Next.js]]></w2:label>
								<w2:value><![CDATA[next.js]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Svelte]]></w2:label>
								<w2:value><![CDATA[svelte]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Redis]]></w2:label>
								<w2:value><![CDATA[redis]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[PostgreSQL]]></w2:label>
								<w2:value><![CDATA[postgresql]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[MySQL]]></w2:label>
								<w2:value><![CDATA[mysql]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[MongoDB]]></w2:label>
								<w2:value><![CDATA[mongodb]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[SQLite]]></w2:label>
								<w2:value><![CDATA[sqlite]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[FastAPI]]></w2:label>
								<w2:value><![CDATA[fastapi]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[NestJS]]></w2:label>
								<w2:value><![CDATA[nestjs]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Express]]></w2:label>
								<w2:value><![CDATA[express]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[JPA]]></w2:label>
								<w2:value><![CDATA[jpa]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[SQLAlchemy]]></w2:label>
								<w2:value><![CDATA[sqlalchemy]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Redux]]></w2:label>
								<w2:value><![CDATA[redux]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Tailwind]]></w2:label>
								<w2:value><![CDATA[tailwind]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[RabbitMQ]]></w2:label>
								<w2:value><![CDATA[rabbitmq]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Kafka]]></w2:label>
								<w2:value><![CDATA[kafka]]></w2:value>
							</w2:item>
							<w2:item>
								<w2:label><![CDATA[Elasticsearch]]></w2:label>
								<w2:value><![CDATA[elasticsearch]]></w2:value>
							</w2:item>
						</w2:multiselect>

						<!-- 상태 필터 추가 -->
						<w2:selectbox id="statusFilter" style="width: 130px;height: 32px;" submenuSize="auto" appearance="minimal"
							direction="auto" chooseOption="true" chooseOptionLabel="상태 필터">
							<w2:choices>
								<w2:item>
									<w2:label><![CDATA[서류검토]]></w2:label>
									<w2:value><![CDATA[서류검토]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[면접대기]]></w2:label>
									<w2:value><![CDATA[면접대기]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[진행중]]></w2:label>
									<w2:value><![CDATA[진행중]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[합격]]></w2:label>
									<w2:value><![CDATA[합격]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[불합격]]></w2:label>
									<w2:value><![CDATA[불합격]]></w2:value>
								</w2:item>
							</w2:choices>
						</w2:selectbox>

						<w2:textbox id="selectedCount" label="4명 선택됨" style="color:#6c757d; font-size:14px; border:none; background:transparent;" />
					</xf:group>

					<xf:group class="button-group" style="display:flex; align-items:center; gap:10px;">
						<xf:trigger class="btn-approve"
							style="background-color:#28a745; color:white; border:none; padding:8px 16px; border-radius:4px; margin-right:10px;" type="button"
							id="pass_btn" ev:onclick="scwin.pass_btn_onclick">
							<xf:label><![CDATA[✓ 일괄 합격]]></xf:label>
						</xf:trigger>
						<xf:trigger class="btn-reject"
							style="background-color:#dc3545; color:white; border:none; padding:8px 16px; border-radius:4px;" type="button" id="fail_btn" ev:onclick="scwin.fail_btn_onclick">
							<xf:label><![CDATA[✗ 일괄 불합격]]></xf:label>
						</xf:trigger>
					</xf:group>
				</xf:group>
			</xf:group>

			<!-- 그리드 영역 -->
			<xf:group style="display:flex; flex-direction:column; justify-content:center; align-items:center; padding:20px;">
				<w2:gridView checkAllType="false" defaultCellHeight="20" id="gridView"
					style="height:633px;width: 100%;overflow:hidden;box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);border:none;background:#ffffff;"
					dataList="data:dlt_applicantVoList" readOnly="true" visibleRowNum="10" sortable="true" focusFlow="linear">
					<w2:caption style="" id="caption2" value="this is a grid caption."></w2:caption>
					<w2:header style="" id="header2">
						<w2:row style="" id="row3">
							<w2:column width="70" inputType="checkbox" style="height: 40px;" readOnly="false" id="chk3" value="체크박스"
								displayMode="label">
							</w2:column>
							<w2:column width="70" inputType="text" style="" id="column24" value="ID" displayMode="label"></w2:column>
							<w2:column width="70" inputType="text" style="height:40px;" id="column10" value="이름" displayMode="label"></w2:column>
							<w2:column width="250" inputType="text" style="" id="column23" value="이메일" displayMode="label"></w2:column>
							<w2:column width="80" inputType="text" style="height:40px;" id="column9" value="경력" displayMode="label"></w2:column>
							<w2:column width="150" inputType="text" style="height:40px;" id="column8" value="포지션" displayMode="label"></w2:column>
							<w2:column width="150" inputType="text" style="height:40px;" id="column5" value="이력서" displayMode="label"></w2:column>
							<w2:column width="80" inputType="text" style="height:40px;" id="column6" value="mbti" displayMode="label"></w2:column>
							<w2:column width="*" inputType="text" style="height:40px;" id="column7" value="기술스택" displayMode="label"></w2:column>
							<w2:column width="100" inputType="text" style="height:40px;" id="column3" value="상태" displayMode="label"></w2:column>
						</w2:row>
					</w2:header>
					<w2:gBody style="" id="gBody2">
						<w2:row style="" id="row4">
							<w2:column width="70" inputType="checkbox" style="height:50px;" readOnly="false" id="chk" value=""
								displayMode="label">
							</w2:column>
							<w2:column width="70" inputType="text" style="" id="accountId" value="" displayMode="label"></w2:column>
							<w2:column width="100" inputType="text" style="" id="name" value="" displayMode="label"></w2:column>
							<w2:column width="100" inputType="text" style="" id="email" value="" displayMode="label"></w2:column>
							<w2:column width="80" inputType="text" style="" id="career" value="" displayMode="label"></w2:column>
							<w2:column width="100" inputType="text" style="" id="currentPosition" value="" displayMode="label"></w2:column>
							<w2:column width="*" inputType="text" style="" id="resumeFileName" value="" displayMode="label"></w2:column>
							<w2:column width="80" inputType="text" style="" id="typeCode" value="" displayMode="label"></w2:column>
							<w2:column width="*" inputType="text" style="" id="techStack" value="" displayMode="label"></w2:column>
							<w2:column width="100" inputType="text" style="" id="applicationStatus" value="" displayMode="label"></w2:column>
						</w2:row>
					</w2:gBody>
				</w2:gridView>
				<xf:group class="pglbox" id="" meta_snippetCategory="06_그리드" meta_snippetKeyComponent="true" meta_snippetName="6_03 페이지리스트"
					style="margin-top:20px;">
					<w2:pageList class="pgl" displayButtonType="display" displayFormat="#" id="pageList1" pageSize="10" pagingType="0"
						style="">
					</w2:pageList>
				</xf:group>
			</xf:group>
		</xf:group>
	</body>
</html>