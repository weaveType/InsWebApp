<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
            <w2:dataCollection baseNode="map">
                <!-- 지원자 정보를 담을 데이터리스트 -->
                <w2:dataList baseNode="list" repeatNode="map" id="dlt_applicants" saveRemovedData="true">
                    <w2:columnInfo>
                        <w2:column id="applicant_id" name="지원자ID" dataType="text"></w2:column>
                        <w2:column id="applicant_name" name="지원자명" dataType="text"></w2:column>
                        <w2:column id="apply_date" name="지원일자" dataType="text"></w2:column>
                        <w2:column id="position" name="지원포지션" dataType="text"></w2:column>
                        <w2:column id="experience" name="경력" dataType="text"></w2:column>
                        <w2:column id="status" name="심사상태" dataType="text"></w2:column>
                        <w2:column id="phone" name="연락처" dataType="text"></w2:column>
                        <w2:column id="email" name="이메일" dataType="text"></w2:column>
                        <w2:column id="portfolio_url" name="포트폴리오" dataType="text"></w2:column>
                        <w2:column id="score" name="평가점수" dataType="text"></w2:column>
                    </w2:columnInfo>
                </w2:dataList>
                
                <!-- 각 심사 단계별 필터링된 데이터리스트 -->
                <w2:dataList baseNode="list" repeatNode="map" id="dlt_document" saveRemovedData="true">
                    <w2:columnInfo>
                        <w2:column id="applicant_id" name="지원자ID" dataType="text"></w2:column>
                        <w2:column id="applicant_name" name="지원자명" dataType="text"></w2:column>
                        <w2:column id="position" name="지원포지션" dataType="text"></w2:column>
                        <w2:column id="experience" name="경력" dataType="text"></w2:column>
                        <w2:column id="score" name="평가점수" dataType="text"></w2:column>
                    </w2:columnInfo>
                </w2:dataList>
                
                <w2:dataList baseNode="list" repeatNode="map" id="dlt_interview" saveRemovedData="true">
                    <w2:columnInfo>
                        <w2:column id="applicant_id" name="지원자ID" dataType="text"></w2:column>
                        <w2:column id="applicant_name" name="지원자명" dataType="text"></w2:column>
                        <w2:column id="position" name="지원포지션" dataType="text"></w2:column>
                        <w2:column id="experience" name="경력" dataType="text"></w2:column>
                        <w2:column id="score" name="평가점수" dataType="text"></w2:column>
                    </w2:columnInfo>
                </w2:dataList>
                
                <w2:dataList baseNode="list" repeatNode="map" id="dlt_final" saveRemovedData="true">
                    <w2:columnInfo>
                        <w2:column id="applicant_id" name="지원자ID" dataType="text"></w2:column>
                        <w2:column id="applicant_name" name="지원자명" dataType="text"></w2:column>
                        <w2:column id="position" name="지원포지션" dataType="text"></w2:column>
                        <w2:column id="experience" name="경력" dataType="text"></w2:column>
                        <w2:column id="score" name="평가점수" dataType="text"></w2:column>
                    </w2:columnInfo>
                </w2:dataList>
                
                <w2:dataList baseNode="list" repeatNode="map" id="dlt_hired" saveRemovedData="true">
                    <w2:columnInfo>
                        <w2:column id="applicant_id" name="지원자ID" dataType="text"></w2:column>
                        <w2:column id="applicant_name" name="지원자명" dataType="text"></w2:column>
                        <w2:column id="position" name="지원포지션" dataType="text"></w2:column>
                        <w2:column id="experience" name="경력" dataType="text"></w2:column>
                        <w2:column id="score" name="평가점수" dataType="text"></w2:column>
                    </w2:columnInfo>
                </w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function() {
    // 페이지 로드 시 초기 데이터 설정
    scwin.initializeData();
    
    // 실제 운영환경에서는 서버 통신을 통해 데이터를 가져옴
    // scwin.searchApplicants();
};

// 초기 데이터 설정 (정적 데이터)
scwin.initializeData = function() {
    // 샘플 지원자 데이터
    var applicantData = [
        {"applicant_id":"A001", "applicant_name":"김개발", "apply_date":"2024-01-15", "position":"백엔드 개발자", "experience":"3년", "status":"document", "phone":"010-1234-5678", "email":"kim@email.com", "portfolio_url":"http://portfolio1.com", "score":"85"},
        {"applicant_id":"A002", "applicant_name":"이프론트", "apply_date":"2024-01-16", "position":"프론트엔드 개발자", "experience":"5년", "status":"interview", "phone":"010-2345-6789", "email":"lee@email.com", "portfolio_url":"http://portfolio2.com", "score":"90"},
        {"applicant_id":"A003", "applicant_name":"박풀스택", "apply_date":"2024-01-17", "position":"풀스택 개발자", "experience":"7년", "status":"final", "phone":"010-3456-7890", "email":"park@email.com", "portfolio_url":"http://portfolio3.com", "score":"95"},
        {"applicant_id":"A004", "applicant_name":"최데이터", "apply_date":"2024-01-18", "position":"데이터 엔지니어", "experience":"4년", "status":"hired", "phone":"010-4567-8901", "email":"choi@email.com", "portfolio_url":"http://portfolio4.com", "score":"92"},
        {"applicant_id":"A005", "applicant_name":"정모바일", "apply_date":"2024-01-19", "position":"모바일 개발자", "experience":"2년", "status":"document", "phone":"010-5678-9012", "email":"jung@email.com", "portfolio_url":"http://portfolio5.com", "score":"78"},
        {"applicant_id":"A006", "applicant_name":"강보안", "apply_date":"2024-01-20", "position":"보안 엔지니어", "experience":"6년", "status":"interview", "phone":"010-6789-0123", "email":"kang@email.com", "portfolio_url":"http://portfolio6.com", "score":"88"},
        {"applicant_id":"A007", "applicant_name":"조인공", "apply_date":"2024-01-21", "position":"AI 엔지니어", "experience":"3년", "status":"document", "phone":"010-7890-1234", "email":"jo@email.com", "portfolio_url":"http://portfolio7.com", "score":"82"},
        {"applicant_id":"A008", "applicant_name":"윤클라우드", "apply_date":"2024-01-22", "position":"클라우드 엔지니어", "experience":"5년", "status":"final", "phone":"010-8901-2345", "email":"yoon@email.com", "portfolio_url":"http://portfolio8.com", "score":"91"}
    ];

    // 전체 지원자 데이터 설정
    dlt_applicants.setJSON(applicantData);
    
    // 각 심사 단계별 데이터 필터링
    scwin.filterApplicantsByStatus();
};

// 심사 상태별 지원자 필터링
scwin.filterApplicantsByStatus = function() {
    var allData = dlt_applicants.getAllJSON();
    
    var documentData = [];
    var interviewData = [];
    var finalData = [];
    var hiredData = [];
    
    // 상태별 분류
    for (var i = 0; i < allData.length; i++) {
        var applicant = allData[i];
        switch(applicant.status) {
            case "document":
                documentData.push(applicant);
                break;
            case "interview":
                interviewData.push(applicant);
                break;
            case "final":
                finalData.push(applicant);
                break;
            case "hired":
                hiredData.push(applicant);
                break;
        }
    }
    
    // 각 데이터리스트에 설정
    dlt_document.setJSON(documentData);
    dlt_interview.setJSON(interviewData);
    dlt_final.setJSON(finalData);
    dlt_hired.setJSON(hiredData);
};

// 서버에서 지원자 데이터 조회 (동적 데이터 로드용)
scwin.searchApplicants = function() {
    // 실제 환경에서는 submission을 통해 서버와 통신
    /*
    com.win.executeSubmission({
        action: "/recruitment/getApplicants",
        target: "data:json,dlt_applicants",
        submitDoneHandler: function(e) {
            // 데이터 로드 성공 시 상태별 필터링
            scwin.filterApplicantsByStatus();
        }
    });
    */
};

// 지원자 상세 정보 보기
scwin.showApplicantDetail = function(applicantId) {
    // 지원자 상세 팝업 또는 상세 페이지로 이동
    var applicant = dlt_applicants.getMatchedJSON("applicant_id", applicantId, true)[0];
    if (applicant) {
        alert("지원자 정보\n\n이름: " + applicant.applicant_name + 
              "\n포지션: " + applicant.position + 
              "\n경력: " + applicant.experience + 
              "\n점수: " + applicant.score);
    }
};

// 지원자 상태 변경
scwin.changeApplicantStatus = function(applicantId, newStatus) {
    // 실제 환경에서는 서버 통신 후 상태 변경
    var rowIndex = dlt_applicants.getMatchedIndex("applicant_id", applicantId, true);
    if (rowIndex !== -1) {
        dlt_applicants.setCellData(rowIndex, "status", newStatus);
        scwin.filterApplicantsByStatus();
        
        // 서버로 상태 변경 요청
        /*
        com.win.executeSubmission({
            action: "/recruitment/updateStatus",
            target: "data:json,{'applicant_id':'" + applicantId + "','status':'" + newStatus + "'}",
            submitDoneHandler: function(e) {
                com.win.alert("상태가 변경되었습니다.");
            }
        });
        */
    }
};

// 드래그 앤 드롭 시작
scwin.onDragStart = function(info) {
    // 드래그 시작 시 지원자 ID 저장
    event.dataTransfer.setData("applicantId", info.rowData.applicant_id);
    event.dataTransfer.setData("currentStatus", info.rowData.status);
};

// 드롭 허용
scwin.onDragOver = function(e) {
    e.preventDefault();
};

// 드롭 처리
scwin.onDrop = function(targetStatus) {
    var applicantId = event.dataTransfer.getData("applicantId");
    var currentStatus = event.dataTransfer.getData("currentStatus");
    
    if (currentStatus !== targetStatus) {
        scwin.changeApplicantStatus(applicantId, targetStatus);
    }
};
]]></script>
        <style type="text/css"><![CDATA[
            /* 전체 레이아웃 스타일 */
            .sub_contents {
                padding: 20px;
                background-color: #f5f5f5;
                min-height: 100vh;
            }
            
            /* 채용 단계 컨테이너 */
            .recruitment_container {
                display: flex;
                gap: 20px;
                height: calc(100vh - 100px);
            }
            
            /* 각 단계별 박스 */
            .stage_box {
                flex: 1;
                background-color: #ffffff;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                padding: 20px;
                display: flex;
                flex-direction: column;
            }
            
            /* 단계 헤더 */
            .stage_header {
                text-align: center;
                padding-bottom: 15px;
                border-bottom: 2px solid #e0e0e0;
                margin-bottom: 20px;
            }
            
            .stage_title {
                font-size: 20px;
                font-weight: bold;
                color: #333;
            }
            
            .stage_count {
                font-size: 14px;
                color: #666;
                margin-top: 5px;
            }
            
            /* 지원자 카드 스타일 */
            .applicant_card {
                background-color: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 15px;
                margin-bottom: 10px;
                cursor: move;
                transition: all 0.3s ease;
            }
            
            .applicant_card:hover {
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                transform: translateY(-2px);
            }
            
            .applicant_name {
                font-size: 16px;
                font-weight: bold;
                color: #212529;
                margin-bottom: 5px;
            }
            
            .applicant_info {
                font-size: 14px;
                color: #6c757d;
                margin-bottom: 3px;
            }
            
            .applicant_score {
                font-size: 14px;
                color: #28a745;
                font-weight: bold;
            }
            
            /* 상태별 색상 */
            .stage_box.document { border-top: 4px solid #6c757d; }
            .stage_box.interview { border-top: 4px solid #17a2b8; }
            .stage_box.final { border-top: 4px solid #ffc107; }
            .stage_box.hired { border-top: 4px solid #28a745; }
            
            /* 드래그 오버 시 스타일 */
            .stage_box.drag-over {
                background-color: #e8f4f8;
                border: 2px dashed #17a2b8;
            }
            
            /* 스크롤 영역 */
            .applicant_list {
                flex: 1;
                overflow-y: auto;
                padding-right: 5px;
            }
            
            /* 스크롤바 스타일 */
            .applicant_list::-webkit-scrollbar {
                width: 6px;
            }
            
            .applicant_list::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 3px;
            }
            
            .applicant_list::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 3px;
            }
            
            .applicant_list::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
        ]]></style>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <xf:group class="sub_contents" id="">
            <xf:group class="recruitment_container" id="">
                <!-- 서류심사 영역 -->
                <xf:group class="stage_box document" id="grp_document" 
                    ondragover="scwin.onDragOver(event);" 
                    ondrop="scwin.onDrop('document');">
                    <xf:group class="stage_header" id="">
                        <w2:textbox class="stage_title" id="" label="서류심사"></w2:textbox>
                        <w2:textbox class="stage_count" id="txt_documentCount" label=""></w2:textbox>
                    </xf:group>
                    <xf:group class="applicant_list" id="">
                        <w2:generator id="gen_document" dataList="data:dlt_document" style="">
                            <xf:group class="applicant_card" id="" draggable="true" 
                                ondragstart="scwin.onDragStart({rowData: data:dlt_document.getRowJSON(%%_rowIndex%%)});"
                                onclick="scwin.showApplicantDetail(data:dlt_document.applicant_id);">
                                <w2:textbox class="applicant_name" id="" label="" ref="data:dlt_document.applicant_name"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="" ref="data:dlt_document.position"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="경력: " ref="data:dlt_document.experience"></w2:textbox>
                                <w2:textbox class="applicant_score" id="" label="점수: " ref="data:dlt_document.score"></w2:textbox>
                            </xf:group>
                        </w2:generator>
                    </xf:group>
                </xf:group>
                
                <!-- 면접심사 영역 -->
                <xf:group class="stage_box interview" id="grp_interview"
                    ondragover="scwin.onDragOver(event);" 
                    ondrop="scwin.onDrop('interview');">
                    <xf:group class="stage_header" id="">
                        <w2:textbox class="stage_title" id="" label="면접심사"></w2:textbox>
                        <w2:textbox class="stage_count" id="txt_interviewCount" label=""></w2:textbox>
                    </xf:group>
                    <xf:group class="applicant_list" id="">
                        <w2:generator id="gen_interview" dataList="data:dlt_interview" style="">
                            <xf:group class="applicant_card" id="" draggable="true"
                                ondragstart="scwin.onDragStart({rowData: data:dlt_interview.getRowJSON(%%_rowIndex%%)});"
                                onclick="scwin.showApplicantDetail(data:dlt_interview.applicant_id);">
                                <w2:textbox class="applicant_name" id="" label="" ref="data:dlt_interview.applicant_name"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="" ref="data:dlt_interview.position"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="경력: " ref="data:dlt_interview.experience"></w2:textbox>
                                <w2:textbox class="applicant_score" id="" label="점수: " ref="data:dlt_interview.score"></w2:textbox>
                            </xf:group>
                        </w2:generator>
                    </xf:group>
                </xf:group>
                
                <!-- 최종심사 영역 -->
                <xf:group class="stage_box final" id="grp_final"
                    ondragover="scwin.onDragOver(event);" 
                    ondrop="scwin.onDrop('final');">
                    <xf:group class="stage_header" id="">
                        <w2:textbox class="stage_title" id="" label="최종심사"></w2:textbox>
                        <w2:textbox class="stage_count" id="txt_finalCount" label=""></w2:textbox>
                    </xf:group>
                    <xf:group class="applicant_list" id="">
                        <w2:generator id="gen_final" dataList="data:dlt_final" style="">
                            <xf:group class="applicant_card" id="" draggable="true"
                                ondragstart="scwin.onDragStart({rowData: data:dlt_final.getRowJSON(%%_rowIndex%%)});"
                                onclick="scwin.showApplicantDetail(data:dlt_final.applicant_id);">
                                <w2:textbox class="applicant_name" id="" label="" ref="data:dlt_final.applicant_name"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="" ref="data:dlt_final.position"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="경력: " ref="data:dlt_final.experience"></w2:textbox>
                                <w2:textbox class="applicant_score" id="" label="점수: " ref="data:dlt_final.score"></w2:textbox>
                            </xf:group>
                        </w2:generator>
                    </xf:group>
                </xf:group>
                
                <!-- 채용완료 영역 -->
                <xf:group class="stage_box hired" id="grp_hired"
                    ondragover="scwin.onDragOver(event);" 
                    ondrop="scwin.onDrop('hired');">
                    <xf:group class="stage_header" id="">
                        <w2:textbox class="stage_title" id="" label="채용완료"></w2:textbox>
                        <w2:textbox class="stage_count" id="txt_hiredCount" label=""></w2:textbox>
                    </xf:group>
                    <xf:group class="applicant_list" id="">
                        <w2:generator id="gen_hired" dataList="data:dlt_hired" style="">
                            <xf:group class="applicant_card" id="" draggable="true"
                                ondragstart="scwin.onDragStart({rowData: data:dlt_hired.getRowJSON(%%_rowIndex%%)});"
                                onclick="scwin.showApplicantDetail(data:dlt_hired.applicant_id);">
                                <w2:textbox class="applicant_name" id="" label="" ref="data:dlt_hired.applicant_name"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="" ref="data:dlt_hired.position"></w2:textbox>
                                <w2:textbox class="applicant_info" id="" label="경력: " ref="data:dlt_hired.experience"></w2:textbox>
                                <w2:textbox class="applicant_score" id="" label="점수: " ref="data:dlt_hired.score"></w2:textbox>
                            </xf:group>
                        </w2:generator>
                    </xf:group>
                </xf:group>
            </xf:group>
        </xf:group>
    </body>
</html>