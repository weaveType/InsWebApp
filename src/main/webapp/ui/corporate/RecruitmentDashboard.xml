<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head meta_screenName="채용관리 대시보드">
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        		<!-- 공고 목록 조회용 -->
        		<w2:dataMap baseNode="map" id="dmp_postVo" style="">
        			<w2:keyInfo>
        				<w2:key dataType="text" id="pageIndex" name="페이지_번호" defaultValue="1"></w2:key>
        				<w2:key dataType="text" id="pageSize" name="페이지_건수" defaultValue="10"></w2:key>
        				<w2:key dataType="text" id="companyId" name="회사_ID" defaultValue=""></w2:key>
        			</w2:keyInfo>
        			<w2:data use="false"></w2:data>
        		</w2:dataMap>



        		<!-- 공고 목록 데이터 -->
        		<w2:dataList baseNode="list" id="dlt_postVoList" repeatNode="map" saveRemovedData="true" style="">
        			<w2:columnInfo>
        				<w2:column dataType="text" id="jobPostingId" name="job_posting_id"></w2:column>
        				<w2:column dataType="text" id="companyId" name="company_id"></w2:column>
        				<w2:column dataType="text" id="title" name="title"></w2:column>
        				<w2:column dataType="text" id="description" name="description"></w2:column>
        				<w2:column dataType="text" id="requiredSkills" name="required_skills"></w2:column>
        				<w2:column dataType="text" id="experienceLevel" name="experience_level"></w2:column>
        				<w2:column dataType="text" id="salaryRange" name="salary_range"></w2:column>
        				<w2:column dataType="text" id="location" name="location"></w2:column>
        				<w2:column dataType="text" id="workType" name="work_type"></w2:column>
        				<w2:column dataType="text" id="preferredDeveloperTypes" name="preferred_developer_types"></w2:column>
        				<w2:column dataType="text" id="expiresAt" name="expires_at"></w2:column>
        				<w2:column dataType="text" id="postedAt" name="posted_at"></w2:column>
        				<w2:column dataType="text" id="status" name="status"></w2:column>
        			</w2:columnInfo>
        		</w2:dataList>

        		<!-- 공고 상세 데이터 -->
        		<w2:dataMap baseNode="map" id="dmp_postVoDetail" style="">
        			<w2:keyInfo>
        				<w2:key dataType="text" id="jobPostingId" name="job_posting_id"></w2:key>
        				<w2:key dataType="text" id="companyId" name="company_id"></w2:key>
        				<w2:key dataType="text" id="title" name="title"></w2:key>
        				<w2:key dataType="text" id="description" name="description"></w2:key>
        				<w2:key dataType="text" id="requiredSkills" name="required_skills"></w2:key>
        				<w2:key dataType="text" id="experienceLevel" name="experience_level"></w2:key>
        				<w2:key dataType="text" id="salaryRange" name="salary_range"></w2:key>
        				<w2:key dataType="text" id="location" name="location"></w2:key>
        				<w2:key dataType="text" id="workType" name="work_type"></w2:key>
        				<w2:key dataType="text" id="preferredDeveloperTypes" name="preferred_developer_types"></w2:key>
        				<w2:key dataType="text" id="expiresAt" name="expires_at"></w2:key>
        				<w2:key dataType="text" id="postedAt" name="posted_at"></w2:key>
        				<w2:key dataType="text" id="status" name="status"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>
        	<w2:workflowCollection />
        	


        	<!-- 기업용 공고 목록 조회 (자신의 공고만) -->
    	<xf:submission id="sbm_selectPostVoList" ref='data:json,{"id":"dmp_postVo","key":"postVo"}'
    		target='data:json,{"id":"dlt_postVoList","key":"elData.postVoList"}' action="/InsWebApp/POS0005List.pwkjson" method="post"
    		mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
    		processMsg="우리 회사의 공고정보를 조회 중입니다." ev:submit="" ev:submitdone="scwin.sbm_postList_submitdone" ev:submiterror="" abortTrigger="">
    	</xf:submission>

        	<!-- 공고 수정 -->
        	<xf:submission id="sbm_updatePostVo" ref='data:json,{"id":"dmp_postVoDetail","key":"postVo"}'
        		target="" action="/InsWebApp/POS0001Upd.pwkjson" method="post"
        		mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
        		processMsg="공고정보를 수정 중입니다." ev:submit="" ev:submitdone="scwin.sbm_updatePost_submitdone" ev:submiterror="" abortTrigger="">
        	</xf:submission>
        	
        	<!-- 공고 삭제 -->
        	<xf:submission id="sbm_deletePostVo" ref='data:json,{"id":"dmp_postVoDetail","key":"postVo"}'
        		target="" action="/InsWebApp/POS0001Del.pwkjson" method="post"
        		mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
        		processMsg="공고정보를 삭제 중입니다." ev:submit="" ev:submitdone="scwin.sbm_deletePost_submitdone" ev:submiterror="" abortTrigger="">
        	</xf:submission>
        	
        	<xf:submission id="sbm_deleteCorporateVo" action="/InsWebApp/CP0001Del.pwkjson" method="post" mediatype="application/json"
        		ref='data:json,{"id":"dmp_corporateVoDetail","key":"corporateVo"}' target="" encoding="UTF-8" instance="" replace=""
        		errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit=""
        		ev:submitdone="scwin.sbm_deleteCorporateVo_submitdone" ev:submiterror="" abortTrigger="">
        	</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <style type="text/css"><![CDATA[
            /* ==========================================================================
               전역 설정
               ========================================================================== */
            * {
                box-sizing: border-box;
            }

            /* ==========================================================================
               메인 컨테이너
               ========================================================================== */
            .dashboard_container {
                min-height: 100vh;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 0;
                margin: 0;
            }

            .dashboard_content {
                padding: 40px;
                max-width: 1400px;
                margin: 0 auto;
            }

            /* ==========================================================================
               헤더 섹션
               ========================================================================== */
            .dashboard_header {
                text-align: center;
                margin-bottom: 50px;
                color: white;
            }
            
            .dashboard_title {
                font-size: 48px;
                font-weight: 800;
                margin-bottom: 12px;
                text-shadow: 0 4px 20px rgba(0,0,0,0.3);
                background: linear-gradient(45deg, #ffffff, #f0f8ff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            .dashboard_subtitle {
                font-size: 20px;
                font-weight: 400;
                opacity: 0.9;
                text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            }

            /* ==========================================================================
               통계 카드 섹션
               ========================================================================== */
            .stats_grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 30px;
                margin-bottom: 50px;
            }
            
            .stat_card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-radius: 24px;
                padding: 40px 35px;
                text-align: center;
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
                transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
                position: relative;
                overflow: hidden;
                cursor: pointer;
            }

            .stat_card:hover {
                transform: translateY(-8px) scale(1.02);
                box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
                background: rgba(255, 255, 255, 1);
            }

            .stat_card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 6px;
                background: var(--card-gradient);
                border-radius: 24px 24px 0 0;
            }

            .stat_card.blue::before { --card-gradient: linear-gradient(90deg, #4285f4, #34a853); }
            .stat_card.green::before { --card-gradient: linear-gradient(90deg, #34a853, #0f9d58); }
            .stat_card.orange::before { --card-gradient: linear-gradient(90deg, #ff9800, #f57c00); }
            .stat_card.purple::before { --card-gradient: linear-gradient(90deg, #9c27b0, #673ab7); }

            .stat_icon {
                width: 80px;
                height: 80px;
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 36px;
                margin: 0 auto 24px;
                background: var(--icon-bg);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .stat_card.blue .stat_icon { --icon-bg: linear-gradient(135deg, #e3f2fd, #bbdefb); }
            .stat_card.green .stat_icon { --icon-bg: linear-gradient(135deg, #e8f5e9, #c8e6c9); }
            .stat_card.orange .stat_icon { --icon-bg: linear-gradient(135deg, #fff3e0, #ffe0b2); }
            .stat_card.purple .stat_icon { --icon-bg: linear-gradient(135deg, #f3e5f5, #e1bee7); }

            .stat_value {
                font-size: 48px;
                font-weight: 800;
                color: #1a2332;
                margin-bottom: 12px;
                background: linear-gradient(135deg, #1a2332, #2c3e50);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            .stat_label {
                font-size: 18px;
                color: #64748b;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            /* ==========================================================================
               액션 카드 섹션
               ========================================================================== */
            .action_grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 30px;
                margin-bottom: 50px;
            }

            .action_card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-radius: 24px;
                padding: 35px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
                transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
            }

            .action_card:hover {
                transform: translateY(-5px);
                box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
            }

            .action_header {
                display: flex;
                align-items: center;
                margin-bottom: 25px;
            }
            
            .action_icon {
                width: 50px;
                height: 50px;
                border-radius: 12px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                color: white;
                margin-right: 16px;
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            }
            
            .action_title {
                font-size: 22px;
                font-weight: 700;
                color: #1a2332;
                margin: 0;
            }
            
            .action_description {
                color: #64748b;
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 25px;
            }

            /* ==========================================================================
               버튼 스타일
               ========================================================================== */
            .btn_primary {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 14px 32px;
                border-radius: 12px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 8px;
            }
            
            .btn_primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
                background: linear-gradient(135deg, #5a72e7, #6a44a0);
            }
            
            .btn_secondary {
                background: rgba(255, 255, 255, 0.9);
                color: #667eea;
                border: 2px solid rgba(102, 126, 234, 0.2);
                padding: 12px 28px;
                border-radius: 12px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            }

            .btn_secondary:hover {
                background: rgba(255, 255, 255, 1);
                border-color: #667eea;
                color: #5a72e7;
                transform: translateY(-1px);
            }

            /* ==========================================================================
               공고 관리 섹션
               ========================================================================== */
            .posts_section {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-radius: 24px;
                padding: 40px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
                margin-bottom: 30px;
            }

            .section_header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                flex-wrap: wrap;
                gap: 20px;
            }

            .section_title {
                font-size: 28px;
                font-weight: 700;
                color: #1a2332;
                background: linear-gradient(135deg, #1a2332, #667eea);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            /* ==========================================================================
               그리드 스타일 개선
               ========================================================================== */
            .grid_container {
                background: #f8fafc;
                border-radius: 16px;
                padding: 20px;
                border: 1px solid #e2e8f0;
            }
            
            .grid_header_controls {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                flex-wrap: wrap;
                gap: 15px;
            }

            .record_count {
                color: #64748b;
                font-size: 16px;
                font-weight: 500;
            }

            .record_number {
                color: #1a2332;
                font-weight: 700;
                font-size: 18px;
                margin: 0 5px;
            }

            .grid_actions {
                display: flex;
                gap: 12px;
                align-items: center;
            }

            .btn_grid {
                padding: 10px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 1px solid #e2e8f0;
                background: white;
            }
            
            .btn_grid.refresh {
                color: #0ea5e9;
                border-color: #0ea5e9;
            }
            
            .btn_grid.refresh:hover {
                background: #0ea5e9;
                color: white;
            }
            
            .btn_grid.delete {
                color: #ef4444;
                border-color: #ef4444;
            }
            
            .btn_grid.delete:hover {
                background: #ef4444;
                color: white;
            }

            /* ==========================================================================
               반응형 디자인
               ========================================================================== */
            @media (max-width: 1200px) {
                .dashboard_content {
                    padding: 30px 20px;
                }

                .stats_grid {
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 20px;
                }
                
                .action_grid {
                    grid-template-columns: 1fr;
                }
            }
            
            @media (max-width: 768px) {
                .dashboard_content {
                    padding: 20px 15px;
                }

                .dashboard_title {
                    font-size: 36px;
                }

                .dashboard_subtitle {
                    font-size: 18px;
                }

                .stats_grid {
                    grid-template-columns: 1fr;
                }

                .stat_card {
                    padding: 30px 25px;
                }
                
                .section_header {
                    flex-direction: column;
                    align-items: flex-start;
                }

                .grid_header_controls {
                    flex-direction: column;
                    align-items: flex-start;
                }
            }

            /* ==========================================================================
               애니메이션
               ========================================================================== */
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .fade-in-up {
                animation: fadeInUp 0.6s ease-out forwards;
            }

            .delay-100 { animation-delay: 0.1s; }
            .delay-200 { animation-delay: 0.2s; }
            .delay-300 { animation-delay: 0.3s; }
            .delay-400 { animation-delay: 0.4s; }
        ]]></style>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function () {
    console.log("=== 채용관리 대시보드 로드 ===");

    var userInfoStr = WebSquare.cookie.getCookie("userInfo");
    if (!userInfoStr) {
        console.warn("사용자 정보가 없습니다. 로그인 페이지로 이동합니다.");
        $p.url("/InsWebApp/ui/common/MainPage.xml");
        return;
    }

    try {
        var userInfo = JSON.parse(userInfoStr);
        if (userInfo.role !== "COMPANY") {
            console.warn("기업 회원이 아닙니다. 메인 페이지로 이동합니다.");
            $p.url("/InsWebApp/ui/common/MainPage.xml");
            return;
        }

        console.log("기업 정보:", userInfo);

        // 페이지 로드 시 초기화
        scwin.initializeDashboard();

        // 애니메이션 효과 적용
        scwin.applyAnimations();

    } catch (e) {
        console.error("사용자 정보 파싱 오류:", e);
        $p.url("/InsWebApp/ui/common/MainPage.xml");
    }
};

// 대시보드 초기화
scwin.initializeDashboard = function () {
    console.log("대시보드 초기화 시작");

    // 회사 ID 설정
    var userInfoStr = WebSquare.cookie.getCookie("userInfo");
    var userInfo = JSON.parse(userInfoStr);
    var companyId = userInfo.companyId;

    if (companyId) {
        dmp_postVo.set("companyId", companyId);

        // 공고 목록 조회 (통계는 이 결과에서 계산)
        scwin.loadPostList();
    } else {
        console.error("회사 ID를 찾을 수 없습니다.");
        alert("회사 정보를 찾을 수 없습니다. 다시 로그인해주세요.");
    }
};

// 공고 데이터로부터 통계 계산
scwin.calculateStatistics = function (postList) {
    console.log("통계 계산 시작");

    var totalJobs = postList.length;
    var activeJobs = 0;
    var closedJobs = 0;
    var currentDate = new Date();

    console.log("현재 시간:", currentDate);

    // 각 공고의 만료일을 확인해서 상태 계산
    for (var i = 0; i < postList.length; i++) {
        var post = postList[i];
        var expiresAt = post.expiresAt;

        // 만료일 파싱
        var expirationDate = null;
        if (expiresAt) {
            // ISO 8601 형식의 날짜 처리 (예: 2025-07-21T00:21:37.000Z)
            expirationDate = new Date(expiresAt);
        }

        // 만료 여부 확인
        var isExpired = expirationDate && expirationDate < currentDate;

        console.log("공고 ID:", post.jobPostingId,
                   "제목:", post.title,
                   "만료일:", expiresAt,
                   "파싱된 날짜:", expirationDate,
                   "만료됨:", isExpired);

        if (isExpired) {
            closedJobs++;
        } else {
            activeJobs++;
        }
    }

    // 카운터 애니메이션과 함께 값 설정
    scwin.animateCounter(tbx_totalJobs, totalJobs);
    scwin.animateCounter(tbx_activeJobs, activeJobs);
    scwin.animateCounter(tbx_closedJobs, closedJobs);

    console.log("통계 업데이트 완료:", {
        totalJobs: totalJobs,
        activeJobs: activeJobs,
        closedJobs: closedJobs,
        currentDate: currentDate
    });
};

// 카운터 애니메이션
scwin.animateCounter = function (element, targetValue) {
    var currentValue = 0;
    var increment = targetValue / 20; // 20단계로 나누어 애니메이션
    var timer = setInterval(function() {
        currentValue += increment;
        if (currentValue >= targetValue) {
            currentValue = targetValue;
            clearInterval(timer);
        }
        element.setValue(Math.floor(currentValue).toString());
    }, 50); // 50ms 간격
};

// 공고 목록 조회
scwin.loadPostList = function () {
    console.log("공고 목록 조회 시작");

    // 페이지 번호 초기화
    dmp_postVo.set("pageIndex", "1");
    if (pgl_postList) {
        pgl_postList.setSelectedIndex(1);
    }

    // 서버통신 - 공고정보 조회
    $c.sbm.execute($p, sbm_selectPostVoList);
};

// 공고 목록 조회 완료
scwin.sbm_postList_submitdone = function (e) {
    console.log("공고 목록 조회 완료:", e.responseJSON);

    var elHeader = e.responseJSON.elHeader;
    if (elHeader && elHeader.resSuc === false) {
        console.error("공고 목록 조회 에러:", elHeader);
        alert(`에러: ${elHeader.resMsg}`);
        return false;
    }

    var elData = e.responseJSON.elData;
    var originalPostList = elData.postVoList || [];

    // 활성 공고만 필터링 (만료되지 않은 공고만)
    var currentDate = new Date();
    var activePostList = [];

    for (var i = 0; i < originalPostList.length; i++) {
        var post = originalPostList[i];
        var expirationDate = post.expiresAt ? new Date(post.expiresAt) : null;
        var isExpired = expirationDate && expirationDate < currentDate;

        if (!isExpired) {
            activePostList.push(post);
        }
    }

    console.log("전체 공고:", originalPostList.length, "활성 공고:", activePostList.length);

    // 선택된 공고 정보 초기화
    dmp_postVoDetail.setEmptyValue();

    // 총 레코드 수 업데이트 (활성 공고만)
    if (spn_listCnt) {
        spn_listCnt.setLabel(activePostList.length);
    }

    // 활성 공고만 그리드에 바인딩
    dlt_postVoList.setJSON(activePostList);

    // 페이지 네비게이터 업데이트 (활성 공고 기준)
    if (pgl_postList && activePostList.length > 0) {
        var pageSize = dmp_postVo.get("pageSize") || 10;
        var totalPageCount = Math.ceil(activePostList.length / pageSize);
        pgl_postList.setCount(totalPageCount);
    }

    // 통계 계산 (전체 공고 리스트로, 내부에서 만료 여부 확인)
    if (originalPostList && originalPostList.length > 0) {
        scwin.calculateStatistics(originalPostList);
    } else {
        // 데이터가 없으면 0으로 설정
        scwin.animateCounter(tbx_totalJobs, 0);
        scwin.animateCounter(tbx_activeJobs, 0);
        scwin.animateCounter(tbx_closedJobs, 0);
    }

    console.log("공고 목록 바인딩 완료 - 활성 공고만 표시");
};

// 애니메이션 효과 적용
scwin.applyAnimations = function () {
    // 애니메이션 클래스 추가 (실제 DOM 조작은 WebSquare 환경에서 제한적)
    console.log("애니메이션 효과 적용");
};

// =========================
// 빠른 액션 기능들
// =========================

// 새 공고 작성
scwin.btn_newJob_onclick = function (e) {
    console.log("새 공고 작성 버튼 클릭");
    try {
        if ($p.parent() && $p.parent().pf_main) {
            $p.parent().pf_main.setSrc("../post/PostCreate.xml");
        } else {
            $p.url("../post/PostCreate.xml");
        }
    } catch (error) {
        console.error("페이지 이동 오류:", error);
        $p.url("../post/PostCreate.xml");
    }
};



// 기업정보 수정
scwin.btn_companyUpdate_onclick = function (e) {
    console.log("기업정보 수정 버튼 클릭");
    try {
        if ($p.parent() && $p.parent().pf_main) {
            $p.parent().pf_main.setSrc("../corporate/CorporateUpdate.xml");
        } else {
            $p.url("../corporate/CorporateUpdate.xml");
        }
    } catch (error) {
        console.error("페이지 이동 오류:", error);
        $p.url("../corporate/CorporateUpdate.xml");
    }
};



// 전체 공고 보기
scwin.btn_allPosts_onclick = function (e) {
    console.log("전체 공고 보기 버튼 클릭");
    try {
        if ($p.parent() && $p.parent().pf_main) {
            $p.parent().pf_main.setSrc("../post/PostList.xml");
        } else {
            $p.url("../post/PostList.xml");
        }
    } catch (error) {
        console.error("페이지 이동 오류:", error);
        $p.url("../post/PostList.xml");
    }
};

// =========================
// 공고 관리 기능들
// =========================

// GridView 행 클릭 이벤트
scwin.grd_postList_oncellclick = function (row, col) {
    console.log("공고 행 클릭:", row);

    if (row < 0) return;

    // 선택된 공고 데이터 설정
    dmp_postVoDetail.setJSON(dlt_postVoList.getRowJSON(row));

    var postData = dmp_postVoDetail.getJSON();
    console.log("선택된 공고:", postData.title);

    // 공고 상세 페이지로 이동
    scwin.openPostDetail(postData.jobPostingId);
};

// 공고 상세보기 페이지로 이동
scwin.openPostDetail = function (jobPostingId) {
    console.log("공고 상세보기:", jobPostingId);

    if (!jobPostingId) {
        alert("공고 정보를 찾을 수 없습니다.");
        return;
    }

    try {
        if ($p.parent() && $p.parent().pf_main) {
            $p.parent().pf_main.setSrc("../post/PostDetail.xml", {
                dataObject: { jobPostingId: jobPostingId }
            });
        } else {
            $p.url("../post/PostDetail.xml?jobPostingId=" + encodeURIComponent(jobPostingId));
        }
    } catch (error) {
        console.error("페이지 이동 오류:", error);
        alert("페이지 이동 중 오류가 발생했습니다.");
    }
};

// 새로고침
scwin.btn_refresh_onclick = function () {
    console.log("새로고침 버튼 클릭");
    scwin.loadPostList();
};

// 공고 삭제
scwin.btn_delete_onclick = function () {
    console.log("삭제 버튼 클릭");

    var postData = dmp_postVoDetail.getJSON();
    if (!postData || !postData.jobPostingId) {
        alert("삭제할 공고를 먼저 선택해주세요.\n(목록에서 행을 클릭하여 선택)");
        return;
    }

    var confirmMsg = `'${postData.title || "선택된 공고"}'를 삭제하시겠습니까?\n\n삭제된 공고는 목록에서 보이지 않게 됩니다.`;

    if (confirm(confirmMsg)) {
        $c.sbm.execute($p, sbm_deletePostVo);
    }
};

// 공고 삭제 완료
scwin.sbm_deletePost_submitdone = function (e) {
    console.log("공고 삭제 완료:", e.responseJSON);

    var elHeader = e.responseJSON.elHeader;
    if (elHeader && elHeader.resSuc === false) {
        console.error("공고 삭제 에러:", elHeader);
        alert(`삭제 실패: ${elHeader.resMsg}`);
        return false;
    }

    alert("공고가 성공적으로 삭제되었습니다!");

    // 선택된 공고 정보 초기화
    dmp_postVoDetail.setEmptyValue();

    // 목록 새로고침 (통계도 함께 업데이트됨)
    scwin.loadPostList();
};

// 페이지 변경
scwin.pgl_postList_onclick = function (idx) {
    console.log("페이지 변경:", idx);
    dmp_postVo.set("pageIndex", idx);
    $c.sbm.execute($p, sbm_selectPostVoList);
};

// 통계 카드 클릭 이벤트들
scwin.statCard_totalJobs_onclick = function () {
    console.log("총 공고 수 카드 클릭");
    // 스크롤을 공고 목록으로 이동
    document.querySelector('.posts_section').scrollIntoView({ behavior: 'smooth' });
};

scwin.statCard_activeJobs_onclick = function () {
    console.log("활성 공고 카드 클릭");
    // 스크롤을 공고 목록으로 이동
    document.querySelector('.posts_section').scrollIntoView({ behavior: 'smooth' });
};

scwin.statCard_closedJobs_onclick = function () {
    console.log("마감된 공고 카드 클릭");
    // 스크롤을 공고 목록으로 이동
    document.querySelector('.posts_section').scrollIntoView({ behavior: 'smooth' });
};


]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <w2:wframe src="../common/Header.xml" id="headerFrame" />
        <xf:group class="dashboard_container" id="">
        	<xf:group class="dashboard_content" id="">
        		<!-- 헤더 섹션 -->
        		<xf:group class="dashboard_header fade-in-up" id="">
        			<w2:textbox id="" label="🎯 채용관리 대시보드" class="dashboard_title"></w2:textbox>
        			<w2:textbox id="" label="우리 회사의 공고를 관리하고 우수한 인재를 찾아보세요" class="dashboard_subtitle"></w2:textbox>
        		</xf:group>

        		<!-- 통계 카드 섹션 -->
        		<xf:group class="stats_grid" id="">
        			<!-- 총 공고 수 -->
        			<xf:group class="stat_card blue fade-in-up delay-100" id="" ev:onclick="scwin.statCard_totalJobs_onclick">
        				<xf:group class="stat_icon" id="">
        					<w2:span label="📄"></w2:span>
        				</xf:group>
        				<w2:textbox id="tbx_totalJobs" label="0" class="stat_value"></w2:textbox>
        				<w2:textbox id="" label="총 공고 수" class="stat_label"></w2:textbox>
        			</xf:group>

        			<!-- 활성 공고 -->
        			<xf:group class="stat_card green fade-in-up delay-200" id="" ev:onclick="scwin.statCard_activeJobs_onclick">
        				<xf:group class="stat_icon" id="">
        					<w2:span label="📋"></w2:span>
        				</xf:group>
        				<w2:textbox id="tbx_activeJobs" label="0" class="stat_value"></w2:textbox>
        				<w2:textbox id="" label="활성 공고" class="stat_label"></w2:textbox>
        			</xf:group>

        			<!-- 마감된 공고 -->
        			<xf:group class="stat_card orange fade-in-up delay-300" id="" ev:onclick="scwin.statCard_closedJobs_onclick">
        				<xf:group class="stat_icon" id="">
        					<w2:span label="📪"></w2:span>
        				</xf:group>
        				<w2:textbox id="tbx_closedJobs" label="0" class="stat_value"></w2:textbox>
        				<w2:textbox id="" label="마감된 공고" class="stat_label"></w2:textbox>
        			</xf:group>
        		</xf:group>

        		<!-- 빠른 액션 카드 -->
        		<xf:group class="action_grid" id="">
        			<!-- 공고 작성 카드 -->
        			<xf:group class="action_card fade-in-up delay-100" id="">
        				<xf:group class="action_header" id="">
        					<xf:group class="action_icon" id="">
        						<w2:span label="✏️"></w2:span>
        					</xf:group>
        					<w2:textbox id="" label="새로운 공고 작성" class="action_title"></w2:textbox>
        				</xf:group>
        				<w2:textbox id="" label="새로운 채용공고를 작성하여 우수한 인재를 찾아보세요." class="action_description"></w2:textbox>
        				<xf:trigger id="btn_newJob" type="button" class="btn_primary" ev:onclick="scwin.btn_newJob_onclick">
        					<xf:label><![CDATA[➕ 공고 작성하기]]></xf:label>
        				</xf:trigger>
        			</xf:group>

        			<!-- 전체 공고 보기 카드 -->
        			<xf:group class="action_card fade-in-up delay-200" id="">
        				<xf:group class="action_header" id="">
        					<xf:group class="action_icon" id="">
        						<w2:span label="📋"></w2:span>
        					</xf:group>
        					<w2:textbox id="" label="전체 공고 보기" class="action_title"></w2:textbox>
        				</xf:group>
        				<w2:textbox id="" label="시장의 다른 공고들을 확인하고 경쟁력을 분석해보세요." class="action_description"></w2:textbox>
        				<xf:trigger id="btn_allPosts" type="button" class="btn_secondary" ev:onclick="scwin.btn_allPosts_onclick">
        					<xf:label><![CDATA[🌐 전체 공고 보기]]></xf:label>
        				</xf:trigger>
        			</xf:group>

        			<!-- 기업정보 관리 카드 -->
        			<xf:group class="action_card fade-in-up delay-300" id="">
        				<xf:group class="action_header" id="">
        					<xf:group class="action_icon" id="">
        						<w2:span label="🏢"></w2:span>
        					</xf:group>
        					<w2:textbox id="" label="기업정보 관리" class="action_title"></w2:textbox>
        				</xf:group>
        				<w2:textbox id="" label="회사 정보와 프로필을 최신 상태로 유지하세요." class="action_description"></w2:textbox>
        				<xf:trigger id="btn_companyUpdate" type="button" class="btn_secondary" ev:onclick="scwin.btn_companyUpdate_onclick">
        					<xf:label><![CDATA[⚙️ 정보 수정]]></xf:label>
        				</xf:trigger>
        			</xf:group>
        		</xf:group>

        		<!-- 채용공고 목록 섹션 -->
        		<xf:group class="posts_section fade-in-up" id="">
        			<xf:group class="section_header" id="">
        				<w2:textbox id="" label="📋 현재 진행 중인 채용공고" class="section_title"></w2:textbox>
        			</xf:group>

        			<!-- 그리드 컨트롤 -->
        			<xf:group class="grid_container" id="">
        				<xf:group class="grid_header_controls" id="">
        					<xf:group class="record_count" id="">
        						<w2:span id="" label="활성 공고"></w2:span>
        						<w2:span class="record_number" id="spn_listCnt" label="0"></w2:span>
        						<w2:span id="" label="개 (마감된 공고 제외)"></w2:span>
        					</xf:group>
        					<xf:group class="grid_actions" id="">
        						<xf:trigger class="btn_grid refresh" id="btn_refresh" type="button" ev:onclick="scwin.btn_refresh_onclick">
        							<xf:label><![CDATA[🔄 새로고침]]></xf:label>
        						</xf:trigger>
        						<xf:trigger class="btn_grid delete" id="btn_delete" type="button" ev:onclick="scwin.btn_delete_onclick">
        							<xf:label><![CDATA[🗑️ 선택 삭제]]></xf:label>
        						</xf:trigger>
        					</xf:group>
        				</xf:group>

        				<!-- 공고 목록 GridView -->
        				<w2:gridView autoFit="allColumn" checkReadOnlyOnPasteEnable="true" class="gvw" dataList="data:dlt_postVoList"
        					defaultCellHeight="35" focusMode="row" id="grd_postList" scrollByColumn="false"
        					style="height: 400px; border-radius: 12px; border: 1px solid #e2e8f0;"
        					visibleRowNum="10" ev:oncellclick="scwin.grd_postList_oncellclick" readOnly="true">
        					<w2:caption style="" id="caption1" value="📌 활성 공고만 표시됩니다 (마감된 공고는 자동으로 숨김처리)"></w2:caption>
        					<w2:header style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: 600;" id="header1">
        						<w2:row style="" id="row1">
        							<w2:column width="100" inputType="text" style="" id="column1" value="공고ID" displayMode="label"></w2:column>
        							<w2:column width="300" inputType="text" style="" id="column2" value="📝 제목" displayMode="label"></w2:column>
        							<w2:column width="250" inputType="text" style="" id="column3" value="💼 설명" displayMode="label"></w2:column>
        							<w2:column width="120" inputType="text" style="" id="column4" value="📍 지역" displayMode="label"></w2:column>
        							<w2:column width="120" inputType="text" style="" id="column5" value="🏠 근무형태" displayMode="label"></w2:column>
        							<w2:column width="100" inputType="text" style="" id="column6" value="📊 상태" displayMode="label"></w2:column>
        							<w2:column width="120" inputType="text" style="" id="column7" value="📅 등록일" displayMode="label"></w2:column>
        						</w2:row>
        					</w2:header>
        					<w2:gBody style="" id="gBody1">
        						<w2:row style="cursor: pointer;" id="row2">
        							<w2:column width="100" inputType="text" style="" id="jobPostingId" value="" displayMode="label"></w2:column>
        							<w2:column width="300" inputType="text" style="font-weight: 600; color: #1a2332;" id="title" value="" displayMode="label"></w2:column>
        							<w2:column width="250" inputType="text" style="color: #64748b;" id="description" value="" displayMode="label"></w2:column>
        							<w2:column width="120" inputType="text" style="" id="location" value="" displayMode="label"></w2:column>
        							<w2:column width="120" inputType="text" style="" id="workType" value="" displayMode="label"></w2:column>
        							<w2:column width="100" inputType="text" style="font-weight: 500;" id="status" value="" displayMode="label"></w2:column>
        							<w2:column width="120" inputType="text" style="color: #64748b;" id="postedAt" value="" displayMode="label"></w2:column>
        						</w2:row>
        					</w2:gBody>
        				</w2:gridView>

        				<!-- 페이징 -->
        				<xf:group style="text-align: center; padding: 25px 0;" id="">
        					<w2:pageList displayButtonType="display" displayFormat="#" id="pgl_postList" pageSize="5" pagingType="0"
        						style="display: inline-block;" ev:onclick="scwin.pgl_postList_onclick">
        					</w2:pageList>
        				</xf:group>
        			</xf:group>
        		</xf:group>
        	</xf:group>
        </xf:group>
    </body>
</html>