<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">

	<head meta_screenName="결과 표시 프레임">
		<w2:type>COMPONENT</w2:type>
		<w2:buildDate />
		<w2:MSA />
		<xf:model>
			<w2:dataCollection baseNode="map">
				<w2:dataMap baseNode="map" id="dma_userInfoVo">
					<w2:keyInfo>
						<w2:key id="isMbtiChecked" name="MBTI검사완료여부" dataType="number"></w2:key>
						<w2:key id="isCodeChecked" name="코드분석완료여부" dataType="number"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
			</w2:dataCollection>
		</xf:model>
		<w2:layoutInfo />
		<w2:publicInfo method="" />

		<style type="text/css"><![CDATA[
        .result-section {
            text-align: center;
            padding: 20px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .result-item {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .result-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 16px;
        }

        .result-type {
            font-size: 28px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 12px;
        }

        .result-image {
            max-width: 300px;
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        ]]></style>
		<script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function () {
    // 부모 페이지의 데이터 참조
    var parentUserInfoVo = $p.parent().dma_userInfoVo;
    if (parentUserInfoVo) {
        dma_userInfoVo.setJSON(parentUserInfoVo.getJSON());
        scwin.loadResults();
    }
};

scwin.loadResults = function () {
    try {
        let isMbtiDone = dma_userInfoVo.get("isMbtiChecked") == 1;
        let isCodeDone = dma_userInfoVo.get("isCodeChecked") == 1;

        // MBTI 결과 로드
        if (isMbtiDone) {
            var userInfo = scwin.getUserInfoByCookie();
            if (userInfo && userInfo.mbti) {
                const imageUrl = "/InsWebApp/images/ws5/mbti/png/" + userInfo.mbti + ".png";
                mbti_result_image.setSrc(imageUrl);
                mbti_result_type.setLabel(userInfo.mbti);
                mbti_result_container.show();
            }
        } else {
            mbti_result_container.hide();
        }

        // 코드분석 결과 로드 (예시)
        if (isCodeDone) {
            // 코드분석 결과 이미지 및 정보 설정
            const codeImageUrl = "/InsWebApp/images/ws5/code/result.png"; // 실제 경로로 변경 필요
            code_result_image.setSrc(codeImageUrl);
            code_result_type.setLabel("분석 완료");
            code_result_container.show();
        } else {
            code_result_container.hide();
        }
    } catch (err) {
        console.error("ResultFrame.xml - loadResults 오류:", err);
    }
};

scwin.getUserInfoByCookie = function () {
    var userInfoCookie = WebSquare.cookie.getCookie("userInfo");
    var userInfo = null;

    if (userInfoCookie) {
        try {
            userInfo = JSON.parse(userInfoCookie);
        } catch (e) {
            console.error("사용자 정보 파싱 오류:", e);
            userInfo = null;
        }
    }
    return userInfo;
};
]]></script>
	</head>

	<body ev:onpageload="scwin.onpageload">
		<xf:group class="result-section">
			<xf:group class="result-grid">
				<!-- MBTI 결과 -->
				<xf:group id="mbti_result_container" class="result-item">
					<w2:textbox class="result-title" label="MBTI 성격 유형"></w2:textbox>
					<w2:textbox id="mbti_result_type" class="result-type"></w2:textbox>
					<xf:image id="mbti_result_image" src="" class="result-image"></xf:image>
				</xf:group>

				<!-- 코드분석 결과 -->
				<xf:group id="code_result_container" class="result-item">
					<w2:textbox class="result-title" label="코드 분석 결과"></w2:textbox>
					<w2:textbox id="code_result_type" class="result-type"></w2:textbox>
					<xf:image id="code_result_image" src="" class="result-image"></xf:image>
				</xf:group>
			</xf:group>
		</xf:group>
	</body>
</html>