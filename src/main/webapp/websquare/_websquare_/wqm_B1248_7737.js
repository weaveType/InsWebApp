"use strict";(self.webpackChunkwebpack_test=self.webpackChunkwebpack_test||[]).push([[7737],{7737:(e,t,i)=>{i.r(t),i.d(t,{treeview_virtual:()=>p});var o=i(1570),s=i(6323),a=i(4171),l=function(){this.index=0,this.depthIndex=1,this.id="",this.label="",this.orgLabel="",this.value="",this.element=null,this.depth=-1,this.parentNode=null,this.childNodes=[],this._isRoot=null,this._hasChild=null,this._isLastChild=null,this.image="",this.selectedImage="",this.expandedImage="",this.checked=!1,this.folder=null,this.expandedNodes=[],this._isExpanded=!1};l.prototype.appendChild=function(e){if(e){var t=this;do{if(e==t)return!1;t=t.parentNode}while(t);if(e.parentNode){for(var i=0;i<e.parentNode.expandedNodes.length;i++){if(e==e.parentNode.expandedNodes[i]){e.parentNode.expandedNodes.splice(i,1);break}}e.parentNode.removeChild(e)}return e.parentNode=this,this.childNodes.push(e),!0}},l.prototype.removeChild=function(e){if(e){for(var t=[],i=0;i<this.childNodes.length;i++){var o=this.childNodes[i];o!=e&&t.push(o)}this.childNodes=t}},l.prototype.isRoot=function(){return this._isRoot=null,this._isRoot=null==this.parentNode,this._isRoot},l.prototype.hasChild=function(){return this._hasChild=null,this.folder?this.folder:(this._hasChild=0!=this.childNodes.length,this._hasChild=0!=this.childNodes.length,this._hasChild)},l.prototype.isLeaf=function(){return!this.hasChild()},l.prototype.isFirstChild=function(){var e=!1;return this.parentNode?(this.parentNode.childNodes[0]&&this===this.parentNode.childNodes[0]&&(e=!0),e):e},l.prototype.isLastChild=function(){if(this._isLastChild=null,!this.parentNode)return!0;var e=this.parentNode.childNodes;return e[e.length-1]==this&&(this._isLastChild=!0),1!=this._isLastChild&&(this._isLastChild=!1),this._isLastChild},l.prototype.hasSibling=function(){return this._isLastChild=null,!!this.parentNode&&1!=this.parentNode.childNodes.length},l.prototype.isExpanded=function(){if(this._isExpanded=!1,null==this.parentNode)return this._isExpanded=!0,!0;if(this.hasChild()){for(var e=0;e<this.parentNode.expandedNodes.length;e++)if(this.index==this.parentNode.expandedNodes[e].index){this._isExpanded=!0;break}return this._isExpanded}return!1},l.prototype.isFirstChildByRoot=function(){var e=!1;return this.parentNode?(0!=this.parentNode.depth||this.parentNode.childNodes[0]&&this===this.parentNode.childNodes[0]&&(e=!0),e):e},l.prototype._getAncestor=function(){for(var e=this;null!=e;e=e.parentNode)if(e.depth<=1)return e},(l.nodeIterator=function(e,t){this.node=e,this.status=0,this.options=o.q.extend({type:"dfs",pruning:null},o.q.extend({},t)),this.stack=[]}).prototype.next=function(){return!!this.node&&(0==this.status?(this.status=1,!0):("dfs"==this.options.type?(this.stack=this.node.childNodes.concat(this.stack),this.node=this.stack.shift()):"bfs"==this.options.type&&(this.stack=this.stack.concat(this.node.childNodes),this.node=this.stack.shift()),!!this.node))},l.nodeIterator.prototype.stop=function(){this.status=2},l.nodeIterator.prototype.getNode=function(){return this.node};var n=function(){this.nodeCount=0,this.rootNode=null,this.hash_index_node={},this.useXPath=!1,this.useCheckbox=!1,this.useImage=!1;var e="w2:";this.xpath={nodeset:"",label:e+"label",value:e+"value",depth:e+"depth",nodeName:e+"node",checkbox:"",folder:e+"folder"},this.dataPath={},this.imageXPath={image:"",iconImage:"",leafImage:"",selectedImage:"",expandedImage:""},this.checkbox={xpath:"",trueValue:"",falseValue:"",checkboxDisabled:"",checkboxDisabledTrueValue:"",checkboxDisabledFalseValue:"",checkboxDisabledAll:""},this.valueAttribute="",this.displayMode="0",this.delimiter="\t",this.customFormatter="",this.treeView="",this.maxDepth=-1,this.isInstance=!1};n.prototype.getNodeset=function(){if(""!=this.xpath.nodeset)return this.xpath.nodeset},n.prototype.setXPath=function(e,t,i,o,s,a,l){""!=e&&(this.useXPath=!0,this.xpath.nodeset=e,this.xpath.label=t,this.xpath.value=i,this.xpath.depth=o,this.xpath.nodeName=s,this.xpath.folder=a,this.xpath.auth=l)},
n.prototype.setDataPath=function(e,t,i,o,s,a){this.dataPath.label=e,this.dataPath.value=t,this.dataPath.depth=i,this.dataPath.nodeName=o,this.dataPath.folder=s,this.dataPath.checkbox=a},n.prototype.setCheckbox=function(e,t,i,o,s,a,l,n,h,d,r){""!=e&&(this.useCheckbox=!0,this.checkbox.xpath=e,this.checkbox.trueValue=t,this.checkbox.falseValue=i,this.checkbox.checkboxDisabled=o,this.checkbox.checkboxDisabledTrueValue=s,this.checkbox.checkboxDisabledFalseValue=a,this.checkbox.checkboxDisabledAll=l,this.checkbox.refreshCheckboxModel=n,this.checkbox.refreshCheckboxDisableModel=h,this.checkbox.hierarchy=d,this.checkbox.colID=r)},n.prototype.setDisplayMode=function(e,t){this.displayMode=e,this.delimiter=t},n.prototype.setImage=function(e,t,i,o,s,a){this.useImage=!0,this.imageXPath.image=e||"",this.imageXPath.iconImage=t||"",this.imageXPath.leafImage=i||"",this.imageXPath.selectedImage=o||"",this.imageXPath.expandedImage=s||"",this.imageXPath.imageTitle=a||""},n.prototype.setXML=function(e){e&&(this.nodeCount=0,this.rootNode=null,this.hash_index_node={},1==this.isInstance?(this.rootNode=this.parseNodeInstance(e,0,0),1==this.useImage&&this.parseImageInstance(this.rootNode)):(this.rootNode=this.parseNode(e,0,0),1==this.useImage&&this.parseImage(this.rootNode)))},n.prototype.setDataList=function(e){var t=s.Z.getComponentById(e);if(t){this.rootNode=new l,this.nodeCount=0,this.hash_index_node[this.rootNode.index]=this.rootNode,this.dataType="list";for(var i=t.getAllFilteredJSON(),o=this.rootNode,n=0;n<i.length;n++){var h=i[n],d=parseInt(h[this.dataPath.depth],10)||0,r=o.depth,c=new l;c.index=++this.nodeCount,c.depth=d,c.element=h,c.orgLabel=h[this.dataPath.label],c.label=h[this.dataPath.label],c.value=h[this.dataPath.value],c.folder=h[this.dataPath.folder];var p=c.label;switch(this.displayMode){case"0":default:c.label=p;break;case"1":c.label=c.value+this.delimiter+p;break;case"2":c.label=p+this.delimiter+c.value}if(1==this.useCheckbox&&h[this.dataPath.checkbox])if(h[this.dataPath.checkbox].wq_trim()==this.checkbox.trueValue?(c.checked=!0,1==this.checkbox.refreshCheckboxModel&&t.setCellData(n,this.dataPath.checkbox,this.checkbox.trueValue)):(c.checked=!1,1==this.checkbox.refreshCheckboxModel&&t.setCellData(n,this.dataPath.checkbox,this.checkbox.falseValue)),this.checkbox.checkboxDisabled){var u=h[this.checkbox.checkboxDisabled].wq_trim();1==this.checkbox.checkboxDisabledAll?(c.checkboxDisabled=!0,1==this.checkbox.refreshCheckboxDisableModel&&t.setCellData(n,this.checkbox.checkboxDisabled,this.checkbox.checkboxDisabledTrueValue)):(c.checkboxDisabled=!1,1==this.checkbox.refreshCheckboxDisableModel&&t.setCellData(n,this.checkbox.checkboxDisabled,this.checkbox.checkboxDisabledFalseValue)),u==this.checkbox.checkboxDisabledTrueValue?(c.checkboxDisabled=!0,1==this.checkbox.refreshCheckboxDisableModel&&t.setCellData(n,this.checkbox.checkboxDisabled,this.checkbox.checkboxDisabledTrueValue)):u==this.checkbox.checkboxDisabledFalseValue&&(c.checkboxDisabled=!1,1==this.checkbox.refreshCheckboxDisableModel&&t.setCellData(n,this.checkbox.checkboxDisabled,this.checkbox.checkboxDisabledFalseValue))}if("function"==typeof this.customFormatter){var f=this.customFormatter,m=this.getCloneNode(c);c.label=f.call(this.treeview,c.orgLabel,c.label,m)||c.label}if(d<=0&&a.v.printLog("["+e+"] The depth value must be a positive integer. (1 or more)"),r<d)o.appendChild(c);else if(r==d)o.parentNode.appendChild(c);else if(r>d){o=o.parentNode;for(var g=0;g<r-d&&null!=o.parentNode;g++)o=o.parentNode;o.appendChild(c)}o=c}this.nodeCount++;var b=function(e,t,i){if(i){i.depthIndex=t,i.depth=e,e>this.maxDepth&&(this.maxDepth=e);for(var o=1,s=0;s<i.childNodes.length;s++)b.call(this,e+1,o,i.childNodes[s]),o++;this.hash_index_node[i.index]=i}};b.call(this,0,0,this.rootNode),1==this.useImage&&this.parseDataListImage(this.rootNode)}},n.prototype.setData=function(e){if(e&&null!=e.data)switch(this.nodeCount=0,this.rootNode=null,this.hash_index_node={},e.type){case"dataList":
this.setDataList(e.data);break;case"xmlInstance":case"inlineXML":this.setXML(e.data)}},n.prototype.appendXML=function(e,t){if(e){var i=this.findNodeByIndex(t),o=i.element,s=1;if(1==this.isInstance){for(var a=e.firstChild;null!=a;a=e.firstChild)1==a.nodeType&&a.tagName==this.xpath.nodeName&&i.appendChild(this.parseNodeInstance(a,i.depth+1,s++,i)),o.appendChild(e.removeChild(a));1==this.useImage&&this.parseImageInstance(i)}else{for(var l=e.getChildNodes(),n=0;n<l.length;n++)1==(a=l[n]).nodeType&&a.getTagName()==this.xpath.nodeName&&i.appendChild(this.parseNode(a,i.depth+1,s++,i)),o.appendChild(e.removeChild(a));1==this.useImage&&this.parseImage(i)}return i}},n.prototype.parseNode=function(e,t,i,o){if(!e)return null;var s=WebSquare.jsonUtil.getValue(e._element,this.xpath.label,this.valueAttribute),a=null,n=this.xpath.auth&&WebSquare.jsonUtil.getValue(e._element,this.xpath.auth,this.valueAttribute);if(this.xpath.folder)a=WebSquare.jsonUtil.getValue(e._element,this.xpath.folder,this.valueAttribute);for(var h="",d=this.xpath.value.split(" "),r=0;r<d.length;r++)0!=r&&(h+="$$"),h+=WebSquare.jsonUtil.getValue(e._element,d[r],this.valueAttribute);var c=new l;switch(c.index=this.nodeCount++,c.depthIndex=i,this.displayMode){case"0":default:c.label=s;break;case"1":c.label=h+this.delimiter+s;break;case"2":c.label=s+this.delimiter+h}if(c.orgLabel=c.label,c.value=h,c.element=e,c.depth=t,c.folder=a,c.auth=n,t>this.maxDepth&&(this.maxDepth=t),1==t?this.xpath.value?c.xpath=this.xpath.nodeset+"["+this.xpath.value+"='"+c.value+"']":c.xpath=this.xpath.nodeset:t>1&&("recursive"==this.dataType?this.xpath.value?c.xpath=o.xpath+"/"+this.xpath.nodeName+"["+this.xpath.value+"='"+c.value+"']":c.xpath=o.xpath+"/"+this.xpath.nodeName:this.xpath.value?c.xpath=this.xpath.nodeset+"["+this.xpath.value+"='"+c.value+"']":c.xpath=this.xpath.nodeset),1==this.useCheckbox){var p=WebSquare.jsonUtil.getValue(e._element,this.checkbox.xpath,this.valueAttribute);if(c.checkboxXPath=c.xpath+"/"+this.checkbox.xpath,p==this.checkbox.trueValue?(c.checked=!0,1==this.checkbox.refreshCheckboxModel&&WebSquare.ModelUtil.setInstanceValue(c.checkboxXPath,this.checkbox.trueValue)):(c.checked=!1,1==this.checkbox.refreshCheckboxModel&&WebSquare.ModelUtil.setInstanceValue(c.checkboxXPath,this.checkbox.falseValue)),this.checkbox.checkboxDisabled){c.checkboxDisableXPath=c.xpath+"/"+this.checkbox.checkboxDisabled;var u=WebSquare.jsonUtil.getValue(e._element,this.checkbox.checkboxDisabled,this.valueAttribute);1==this.checkbox.checkboxDisabledAll?(c.checkboxDisabled=!0,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(c.checkboxDisableXPath,this.checkbox.checkboxDisabledTrueValue)):(c.checkboxDisabled=!1,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(c.checkboxDisableXPath,this.checkbox.checkboxDisabledFalseValue)),u==this.checkbox.checkboxDisabledTrueValue?(c.checkboxDisabled=!0,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(c.checkboxDisableXPath,this.checkbox.checkboxDisabledTrueValue)):u==this.checkbox.checkboxDisabledFalseValue&&(c.checkboxDisabled=!1,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(c.checkboxDisableXPath,this.checkbox.checkboxDisabledFalseValue))}}var f=1,m=e.getChildNodes();for(r=0;r<m.length;r++){var g=m[r];1==g.nodeType&&g.getTagName()==this.xpath.nodeName&&c.appendChild(this.parseNode(g,t+1,f++,c))}if(1==this.useCheckbox&&1==this.checkbox.hierarchy){var b=0,x=!1;for(r=0;r<c.childNodes.length;r++){var v=c.childNodes[r];1==v.checked?b++:1==v.partial&&(x=!0)}1==x||0<b&&b<c.childNodes.length?c.partial=!0:b>0&&b==c.childNodes.length?(c.checked=!0,c.checkboxDom||(c.checkboxDom=document.getElementById(this.treeview.id+"_checkbox_"+c.index)),c.checkboxDom&&(c.checkboxDom.checked=!0)):c.partial=!1}if(this.hash_index_node[c.index]=c,"function"==typeof this.customFormatter){
var y=this.customFormatter,N=this.getCloneNode(c),_=y.call(this.treeview,c.orgLabel,c.label,N)||c.label;c.label=_}return c},n.prototype.parseNodeInstance=function(e,t,i,o){if(!e)return null;var a=WebSquare.xml.getValue(e,this.xpath.label).wq_trim(),n=null,h=this.xpath.auth&&WebSquare.xml.getValue(e,this.xpath.auth).wq_trim();this.xpath.folder&&(n=s.Z.getBoolean(WebSquare.xml.getValue(e,this.xpath.folder).wq_trim()));for(var d="",r=this.xpath.value.split(" "),c=0;c<r.length;c++)0!=c&&(d+="$$"),d+=WebSquare.xml.getValue(e,r[c]).wq_trim();var p=new l;switch(p.index=this.nodeCount++,p.depthIndex=i,this.displayMode){case"0":default:p.label=a;break;case"1":p.label=d+this.delimiter+a;break;case"2":p.label=a+this.delimiter+d}if(p.orgLabel=p.label,p.value=d,p.element=e,p.depth=t,p.folder=n,p.auth=h,t>this.maxDepth&&(this.maxDepth=t),1==t?this.xpath.value?p.xpath=this.xpath.nodeset+"["+this.xpath.value+"='"+p.value+"']":p.xpath=this.xpath.nodeset:t>1&&("recursive"==this.dataType?this.xpath.value?p.xpath=o.xpath+"/"+this.xpath.nodeName+"["+this.xpath.value+"='"+p.value+"']":p.xpath=o.xpath+"/"+this.xpath.nodeName:this.xpath.value?p.xpath=this.xpath.nodeset+"["+this.xpath.value+"='"+p.value+"']":p.xpath=this.xpath.nodeset),1==this.useCheckbox){var u=WebSquare.xml.getValue(e,this.checkbox.xpath).wq_trim();if(p.checkboxXPath=p.xpath+"/"+this.checkbox.xpath,u==this.checkbox.trueValue?(p.checked=!0,1==this.checkbox.refreshCheckboxModel&&WebSquare.ModelUtil.setInstanceValue(p.checkboxXPath,this.checkbox.trueValue)):(p.checked=!1,1==this.checkbox.refreshCheckboxModel&&WebSquare.ModelUtil.setInstanceValue(p.checkboxXPath,this.checkbox.falseValue)),this.checkbox.checkboxDisabled){p.checkboxDisableXPath=p.xpath+"/"+this.checkbox.checkboxDisabled;var f=WebSquare.xml.getValue(e,this.checkbox.checkboxDisabled).wq_trim();1==this.checkbox.checkboxDisabledAll?(p.checkboxDisabled=!0,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(p.checkboxDisableXPath,this.checkbox.checkboxDisabledTrueValue)):(p.checkboxDisabled=!1,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(p.checkboxDisableXPath,this.checkbox.checkboxDisabledFalseValue)),f==this.checkbox.checkboxDisabledTrueValue?(p.checkboxDisabled=!0,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(p.checkboxDisableXPath,this.checkbox.checkboxDisabledTrueValue)):f==this.checkbox.checkboxDisabledFalseValue&&(p.checkboxDisabled=!1,1==this.checkbox.refreshCheckboxDisableModel&&WebSquare.ModelUtil.setInstanceValue(p.checkboxDisableXPath,this.checkbox.checkboxDisabledFalseValue))}}for(var m=0,g=e.firstChild;null!=g;g=g.nextSibling)1==g.nodeType&&g.tagName==this.xpath.nodeName&&p.appendChild(this.parseNodeInstance(g,t+1,m++,p));if(1==this.useCheckbox&&1==this.checkbox.hierarchy){var b=0,x=!1;for(c=0;c<p.childNodes.length;c++){var v=p.childNodes[c];1==v.checked?b++:1==v.partial&&(x=!0)}1==x||0<b&&b<p.childNodes.length?p.partial=!0:b>0&&b==p.childNodes.length?(p.checked=!0,p.checkboxDom||(p.checkboxDom=document.getElementById(this.treeview.id+"_checkbox_"+p.index)),p.checkboxDom&&(p.checkboxDom.checked=!0)):p.partial=!1}if(this.hash_index_node[p.index]=p,"function"==typeof this.customFormatter){var y=this.customFormatter,N=this.getCloneNode(p),_=y.call(this.treeview,p.orgLabel,p.label,N)||p.label;p.label=_}return p},n.prototype.parseNodeByNode=function(e,t,i,o){if(!e)return null;var s=new l;s.index=++this.nodeCount,s.depthIndex=i,s.parentNode=o,s.label=e.label,s.orgLabel=s.label,s.value=e.value,s.element=this.getCloneNodeElemnt(e.element),s.depth=t,s.folder=e.folder,s.xpath="",s.checkboxXPath="",s.selectedImage=e.selectedImage,s.expandedImage=e.expandedImage,s.image=e.image,s.imageTitle=e.imageTitle,s.labelStyle=e.labelStyle,s.expandedNodes=e.expandedNodes.splice(0),void 0!==e.checked&&(s.checked=e.checked),s.checkboxDisableXPath="",void 0!==e.checkboxDisabled&&(s.checkboxDisabled=e.checkboxDisabled)
;for(var a=1,n=0;n<e.childNodes.length;n++)s.appendChild(this.parseNodeByNode(e.childNodes[n],t+1,a++,s,o));return this.hash_index_node[s.index]=s,s},n.prototype.parseImage=function(e){var t="",i="",o="",s="",a="",l=/\.[a-zA-Z][a-zA-Z][a-zA-Z][\s]*$/;""!=this.imageXPath.image&&(t=this.imageXPath.image.match(l)?this.imageXPath.image:WebSquare.jsonUtil.getValue(e.element._element,this.imageXPath.image,this.valueAttribute)),""!=this.imageXPath.iconImage&&(i=this.imageXPath.iconImage.match(l)?this.imageXPath.iconImage:WebSquare.jsonUtil.getValue(e.element._element,this.imageXPath.iconImage,this.valueAttribute)),""!=this.imageXPath.selectedImage&&(o=this.imageXPath.selectedImage.match(l)?this.imageXPath.selectedImage:WebSquare.jsonUtil.getValue(e.element._element,this.imageXPath.selectedImage,this.valueAttribute)),""!=this.imageXPath.expandedImage&&(s=this.imageXPath.expandedImage.match(l)?this.imageXPath.expandedImage:WebSquare.jsonUtil.getValue(e.element._element,this.imageXPath.expandedImage,this.valueAttribute)),""!=this.imageXPath.leafImage&&(a=this.imageXPath.leafImage.match(l)?this.imageXPath.leafImage:WebSquare.jsonUtil.getValue(e.element._element,this.imageXPath.leafImage,this.valueAttribute)),""!=a&&1==e.isLeaf()&&(t=a),""!=i&&(t=i,o=i,s=i),""==o&&(o=t),""==s&&(s=t),e.image=t,e.selectedImage=o,e.expandedImage=s,e.imageTitle=this.imageXPath.imageTitle&&WebSquare.jsonUtil.getValue(e.element._element,this.imageXPath.imageTitle,this.valueAttribute);for(var n=0;n<e.childNodes.length;n++)this.parseImage(e.childNodes[n])},n.prototype.parseImageInstance=function(e){var t="",i="",o="",s="",a="",l=/\.[a-zA-Z][a-zA-Z][a-zA-Z][\s]*$/;""!=this.imageXPath.image&&(t=this.imageXPath.image.match(l)?this.imageXPath.image:WebSquare.xml.getValue(e.element,this.imageXPath.image).wq_trim()||""),""!=this.imageXPath.iconImage&&(i=this.imageXPath.iconImage.match(l)?this.imageXPath.iconImage:WebSquare.xml.getValue(e.element,this.imageXPath.iconImage).wq_trim()||""),""!=this.imageXPath.selectedImage&&(o=this.imageXPath.selectedImage.match(l)?this.imageXPath.selectedImage:WebSquare.xml.getValue(e.element,this.imageXPath.selectedImage).wq_trim()||""),""!=this.imageXPath.expandedImage&&(s=this.imageXPath.expandedImage.match(l)?this.imageXPath.expandedImage:WebSquare.xml.getValue(e.element,this.imageXPath.expandedImage).wq_trim()||""),""!=this.imageXPath.leafImage&&(a=this.imageXPath.leafImage.match(l)?this.imageXPath.leafImage:WebSquare.xml.getValue(e.element,this.imageXPath.leafImage).wq_trim()||""),""!=a&&1==e.isLeaf()&&(t=a),""!=i&&(t=i,o=i,s=i),""==o&&(o=t),""==s&&(s=t),e.image=t,e.selectedImage=o,e.expandedImage=s,e.imageTitle=this.imageXPath.imageTitle&&WebSquare.xml.getValue(e.element,this.imageXPath.imageTitle);for(var n=0;n<e.childNodes.length;n++)this.parseImageInstance(e.childNodes[n])},n.prototype.parseDataListImage=function(e,t){var i="",o="",s="",a="",l="",n=/\.[a-zA-Z][a-zA-Z][a-zA-Z][\s]*$/;if(""!=this.imageXPath.image&&(i=this.imageXPath.image.match(n)?this.imageXPath.image:e.element?e.element[this.imageXPath.image].wq_trim():""),""!=this.imageXPath.iconImage&&(o=this.imageXPath.iconImage.match(n)?this.imageXPath.iconImage:e.element?e.element[this.imageXPath.iconImage].wq_trim():""),""!=this.imageXPath.selectedImage&&(s=this.imageXPath.selectedImage.match(n)?this.imageXPath.selectedImage:e.element?e.element[this.imageXPath.selectedImage].wq_trim():""),""!=this.imageXPath.expandedImage&&(a=this.imageXPath.expandedImage.match(n)?this.imageXPath.expandedImage:e.element?e.element[this.imageXPath.expandedImage].wq_trim():""),""!=this.imageXPath.leafImage&&(l=this.imageXPath.leafImage.match(n)?this.imageXPath.leafImage:e.element?e.element[this.imageXPath.leafImage].wq_trim():""),""!=l&&1==e.isLeaf()&&(i=l),""!=o&&(i=o,s=o,a=o),""==s&&(s=i),""==a&&(a=i),e.image=i,e.selectedImage=s,e.expandedImage=a,e.imageTitle=this.imageXPath.imageTitle&&WebSquare.jsonUtil.getValue(e.element._element,this.imageXPath.imageTitle,this.valueAttribute),
!0!==t)for(var h=0;h<e.childNodes.length;h++)this.parseDataListImage(e.childNodes[h])},n.prototype.parseListToTree=function(e){for(var t=WebSquare.xml.parse('<Treeview xmlns:w2="http://www.inswave.com/websquare" />',!0),i=WebSquare.xmljs.xml2json(t).E[0],o=0;o<e.length;o++)e[o]._element.parent=i;var s=i,a=0;this.dataType="list";for(o=0;o<e.length;o++){s=new WebSquare.Elem(s);var l=e[o],n=parseInt(WebSquare.jsonUtil.getValue(l._element,this.xpath.depth,this.valueAttribute))||0;a=parseInt(WebSquare.jsonUtil.getValue(s._element,this.xpath.depth,this.valueAttribute))||0;if(0===n&&0!==a&&(l.setNodeValue(this.xpath.depth,a),n=a),a<n)l._element.parent=s._element,l=s.appendChild(l._element);else if(a==n&&0==o)l._element.parent=s._element,l=s.appendChild(l._element);else if(a==n){l._element.parent=s.getParentNode()._element,l=s.getParentNode().appendChild(l._element)}else if(a>n){s=s.getParentNode();for(var h=0;h<a-n;h++)null!=s._element.parent&&(s=s.getParentNode());s.element&&(s=s._element),l._element.parent=s._element,l=s.appendChild(l._element)}s=l}return new WebSquare.Elem(i)},n.prototype.parseListToTreeInstance=function(e){var t=WebSquare.xml.parse('<Treeview xmlns:w2="http://www.inswave.com/websquare" />',!0),i=t.documentElement,o=0;this.dataType="list";for(var s=0;s<e.length;s++){var a=e[s].cloneNode(!0),l=parseInt(WebSquare.xml.getValue(a,this.xpath.depth))||0;o=parseInt(WebSquare.xml.getValue(i,this.xpath.depth))||0;if(0===l&&0!==o&&(WebSquare.xml.setValue(a,this.xpath.depth,o),l=o),o<l)a=WebSquare.xml.appendChild(i,a),o=l;else if(o==l&&0==s)a=WebSquare.xml.appendChild(i,a);else if(o==l){var n=i.parentNode;a=WebSquare.xml.appendChild(n,a)}else if(o>l){i=i.parentNode;for(var h=0;h<o-l;h++)null!=i.parentNode&&(i=i.parentNode);i.documentElement&&(i=i.documentElement),a=WebSquare.xml.appendChild(i,a)}i=a}return t.documentElement},n.prototype.parseRecursiveToTree=function(e){this.dataType="recursive";var t=WebSquare.xml.parse('<Treeview xmlns:w2="http://www.inswave.com/websquare" />',!0);if(e[0]instanceof WebSquare.Elem){for(var i=new WebSquare.Elem(WebSquare.xmljs.xml2json(t).E[0]),o=0;o<e.length;o++){var a=null;a=e[o],i.appendChild(a._element)}return i}for(o=0;o<e.length;o++){a=null;a=s.Z.isOpera()?WebSquare.xml.parse(e[o]).firstChild:e[o].cloneNode(!0),WebSquare.xml.appendChild(t.documentElement,a)}return t.documentElement},n.prototype.parseTreeToList=function(){var e=this.xpath.nodeset;if(e.indexOf("/")>-1){var t=e.split("/");e=t[t.length-2]}e&&""!=e||(e="Treeview");var i=WebSquare.xml.parse("<"+e+' xmlns:w2="http://www.inswave.com/websquare" />',!0),o=i.documentElement,s=this.getNodeIterator({type:"dfs"});for(s.next();s.next();){var a=s.getNode();o.appendChild(a.element)}return i.documentElement},n.prototype.getNodeIterator=function(e){return e=o.q.extend({rootNode:null},e||{}),new l.nodeIterator(e.rootNode||this.rootNode,e)},n.prototype.size=function(){return this.nodeCount},n.prototype.findNodeByValue=function(e){var t,i=null;for(t in this.hash_index_node)if(this.hash_index_node[t].value==e){i=this.hash_index_node[t];break}return i},n.prototype.findNodeByIndex=function(e){var t=this.hash_index_node[e];return t||null},n.prototype.IterateFindNodeByIndex=function(e){for(var t=null,i=this.getNodeIterator(),o=0;i.next();){var s=i.getNode();if(!s.parentNode||1!=s.depth&&!0!==s.parentNode._isExpanded||o++,s.index==e){t=s;break}}return t&&(t._nodePosition=o),i=null,t},n.prototype.setRender=function(e,t){e.rendered=t;for(var i=0;i<e.childNodes.length;i++)this.setRender(e.childNodes[i],t)},n.prototype.getCloneNode=function(e){var t={};return t.checkboxDisabled=e.checkboxDisabled,t.checked=e.checked,t.folder=e.folder,t.image=e.image,t.imageTitle=e.imageTitle,t.rendered=e.rendered,t.id=e.id,t.index=e.index,t.value=e.value,t.label=e.label,t.labelStyle=e.labelStyle,t},n.prototype.getCloneNodeElemnt=function(e){var t={};return t.depth=e.depth,t.label=e.label,t.value=e.value,t.rowStatus=e.rowStatus,t},n.prototype.clearNode=function(e,t){
try{if(e.element=null,e.parentNode){this._removeNode(e.parentNode.expandedNodes,e),this._removeNode(e.parentNode.childNodes,e);for(var i=e.depthIndex-1;i<e.parentNode.childNodes.length;i++)e.parentNode.childNodes[i].depthIndex=i+1}e.parentNode=null,e.childNodes=[];var s=document.getElementById(t+"_node_"+e.index);s&&o.q.removeNode(s),delete this.hash_index_node[e.index]}catch(e){a.v.printLog("virtualTree.clearNode error : "+e.message)}},n.prototype.changeNodeIndex=function(e,t){var i=this.hash_index_node[e];i.index=t,delete this.hash_index_node[e],this.hash_index_node[t]=i,this.changeDomIndex("node",e,t,!0),this.changeDomIndex("checkbox",e,t),this.changeDomIndex("label",e,t),i.checkboxDom&&(i.checkboxDom=null,delete i.checkboxDom)},n.prototype.changeDomIndex=function(e,t,i,o){var a=document.getElementById(this.treeview.id+"_"+e+"_"+t);if(null!=a&&(a.setAttribute("id",this.treeview.id+"_"+e+"_"+i),o)){var l=s.Z.getDataPrefix("index");a.setAttribute(l,i)}},n.prototype.getLastChildIndex=function(e){var t=this.findNodeByIndex(e),i=e;if(t.hasChild()){i=this.size();for(var o=t;!o.isRoot()&&o.depthIndex==o.parentNode.childNodes.length;)o=o.parentNode;o.isRoot()||o.depthIndex==o.parentNode.childNodes.length||(i=o.parentNode.childNodes[o.depthIndex].index-1)}return i},n.prototype._removeNode=function(e,t){try{if(!(e instanceof Array&&t))return;for(var i=e.length-1;i>=0;i--)if(e[i]===t){e.splice(i,1);break}}catch(e){a.v.printLog("virtualTree._removeNode error : "+e.message)}},n.prototype._insertNode=function(e,t,i,o){try{if(!(e instanceof Array&&t&&i))return;for(var s=!0===o?1:0,l=!1,n=e.length-1;n>=0;n--)if(e[n]===t){e.splice(n+s,0,i),l=!0;break}l||e.push(i)}catch(e){a.v.printLog("virtualTree._insertNode error : "+e.message)}};var h=i(8548),d=i(866),r=i(2847),c=i(3885),p=function(e,t,i){c.q.call(this,e,t,i)};o.q.extend(p.prototype,c.q.prototype),p.prototype.defaultOptions={pluginType:"uiplugin.treeview",pluginName:"treeview",renderType:"virtual",userEvents:["onclick","ondblclick","onchange","onrightbuttonclick","ondrop","oncheckboxclick","onlabelclick","onlabelover","ontoggleclick","onviewchange","oneditend"],toggleEvent:"ondblclick",useConfig:!0,hierarchy:!1,refreshCheckboxModel:!1,refreshCheckboxDisableModel:!1,displayMode:"0",delimiter:"\t",folderOpenToggleImage:o.q._resourceURI+"uiplugin/treeview/images/plus.png",folderCloseToggleImage:o.q._resourceURI+"uiplugin/treeview/images/minus.png",leafToggleImage:o.q._resourceURI+"uiplugin/treeview/images/middle.gif",lastToggleImage:o.q._resourceURI+"uiplugin/treeview/images/last.gif",middleToggleImage:o.q._resourceURI+"uiplugin/treeview/images/middle.gif",labelclass:"",labelonClickClass:"treeview_select_node",labelForCheckbox:!1,title:"",escape:!0,rowHeight:20,useDrag:!1,accordion:!1,dynamicAppend:!1,dataType:"recursive",lineShow:!0,alwaysDraw:!1,showTreeDepth:0,showCheckbox:!1,trueValue:"true",falseValue:"false",checkAllChildNodes:!1,checkboxDisabled:"",checkboxDisabledTrueValue:"true",checkboxDisabledFalseValue:"false",checkboxDisabledAll:!1,scrollFix:!1,tooltipDisplay:!1,tooltipShowAlways:!1,tooltipStyle:"border:2px solid #7BAFE4; background-color:#ffffff;cursor:default;",tooltipClass:"",tooltipTime:1,tooltipGroupClass:!0,redrawInterval:3,useHirarchySelect:!1,iwsSupport:!1,multiselect:!1,useDrop:!1,selectedClass:"treeview_select_nodedom",iwsDropDelta:5},p.prototype.initialize=function(e){try{switch(this.inlineElement=!1,this.useDataCollection=!1,this.successBinding=!1,this.nativeScrollWidth=18,this.tooltip=null,this.timeShowTooltip=null,this.timeHideTooltip=null,this.tree=new n,this.tree.treeview=this,this.selectedInfo={groupDom:null,dom:null,node:null},this.multiSelectedInfo=[],this.resizeObj={width:0,height:0},this.tree.setData(this._getDataObj(e)),this._request=null,this._expandedNodes=[this.tree.rootNode],this._items=[],1==this.options.accordion&&(this.options.showTreeDepth=0),this._setExpandedLevel(),this._arrowDownPressed=!1,this._arrowUpPressed=!1,this._forceRedraw=!1,
this.isMobile=s.Z.isMobile(),this.touchDelta={x:0,y:0},!0===this.options.hierarchy&&(this.options.checkAllChildNodes=!0),this.options.displayMode){case"0":case"1":case"2":break;case"value delim label":this.options.displayMode="1";break;case"label delim value":this.options.displayMode="2";break;default:this.options.displayMode="0"}this.tree.setDisplayMode(this.options.displayMode,this.options.delimiter),this.editModeComp=null,this.options=WebSquare.cssManager.styleToClass(this.id,this.options),1==this.options.showCheckbox&&(1==s.Z.isOpera()?this.checkboxStyle="left:-1px;top:-1px":this.checkboxStyle="left:0px;top:0px"),this.options.useHirarchySelect&&(this.selectedInfoStack=[]),this._bExtraRowRedraw=!1,this._epsilon=2,this._initMaxRowHeight(),this._bSkipScrollY=!1}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.finalize=function(){null!=this.editModeComp&&WebSquare.idCache[this.editModeComp.uuid]&&this.editModeComp.remove(),this._request=null;for(var e=0,t=this._items.length;e<t;e++)this._items[e]=null;this._items=null;for(e=0,t=this.dom.length;e<t;e++)this.dom[e]=null;for(var i in this.dom=null,this.selectedInfo)this.selectedInfo.hasOwnProperty(i)&&(this.selectedInfo[i]=null);this.selectedInfo=null;for(e=0,t=this.tree.size();e<t;e++)this.tree.hash_index_node[e]=null;for(var i in this.tree)this.tree.hasOwnProperty(i)&&(this.tree[i]=null);this.tree=null,c.q.removeCheckResize(this.uuid),c.q.prototype.finalize.call(this)},p.prototype._getData=function(e,t,i){try{for(var o=[],s=0,a=e.length;s<a;s++){var l=[];l=this.tree.hash_index_node[e[s].parent].childNodes.slice(0),o.push({parent:e[s].parent,items:l.splice(e[s].offset,e[s].limit)})}this._setData(t,i,o)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._setData=function(e,t,i){for(var o=[],s=0,a=i.length;s<a;s++){for(var l=i[s],n=-1,h=0,d=o.length;h<d;h++)if(o[h].index===l.parent){n=h;break}o=n>-1?o.slice(0,n+1).concat(l.items).concat(o.slice(n+1)):l.items.concat(o)}this._items=o,this._redraw(o,e,t)},p.prototype._expandNode=function(e){if(e.expandedNodes||(e.expandedNodes=[]),e.hasChild()){var t=e.parentNode;t&&!e.isExpanded()&&(-1===t.expandedNodes.indexOf(e)&&t.expandedNodes.push(e),t._isExpanded=!0)}},p.prototype._collapseNode=function(e){var t=e.parentNode;if(t&&e.isExpanded()){for(var i=-1,o=0,s=t.expandedNodes.length;o<s;o++){var a=t.expandedNodes[o];if(e.index===a.index){i=o;break}}t.expandedNodes.splice(i,1),t._isExpanded=!1}},p.prototype.redraw=function(e,t){var i=this.render.clientHeight||parseInt(this.render.style.height,10)||parseInt(WebSquare.style.getComputedStyle(this.render,"height"),10),o=Math.floor(i/this._minRowHeight),s=Math.ceil(this.getElementById(this.id+"_scrollY_div").scrollTop/this.options.rowHeight),a=this._buildTree(s,o);this._getData(a,e,t),this._items.length>0&&(this.resizeObj={width:this.render.offsetWidth,height:this.render.offsetHeight})},p.prototype._buildTree=function(e,t){var i=[];this._sortAllExpandedNodes(this._expandedNodes),this._calculateExpandedNodes(this._expandedNodes,0);var o=function(s,a){for(var l=0,n=s.length;l<n;l++){var h=s[l];if(f=e,m=e+t,g=h._start,b=h._end,g<f&&b<f||g>m&&b>m)e>h._end&&a&&(a.offset-=h._end-h._start+1);else{var d=Math.max(e,h._start),r=Math.min(e+t-1,h._end),c=Math.max(0,Math.min(r-d+1,t));if(a&&(a.limit-=c,e>h._start)){var p=h._end-h._start+1-c;p>0&&(a.offset-=p)}var u={parent:h.index,offset:e>h._start?e-h._start:0,limit:Math.min(c,t)};i.push(u),o(h.expandedNodes,u)}}var f,m,g,b};return o(this._expandedNodes),i},p.prototype._iterateAllExpandedNodes=function(e,t){try{for(var i=0,o=e.length;i<o;i++)t(e[i]),this._iterateAllExpandedNodes(e[i].expandedNodes,t)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._findExpandedNodeByIndex=function(e){var t=null;return this._iterateAllExpandedNodes(this._expandedNodes,(function(i){i.index===e&&(t=i)})),t},p.prototype._sortAllExpandedNodes=function(e){try{e.sort((function(e,t){return e.depthIndex-t.depthIndex}))
;for(var t=0;t<e.length;t++)this._sortAllExpandedNodes(e[t].expandedNodes)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._calculateExpandedNodes=function(e,t){try{for(var i=0;i<e.length;i++){var o,s=e[i],a=e[i-1];o=a?a._end+1+(s.depthIndex-a.depthIndex):t+s.depthIndex,s._start=o;var l=s.childNodes.length;this._iterateAllExpandedNodes(s.expandedNodes,(function(e){l+=e.childNodes.length})),s._end=s._start+l-1,this._calculateExpandedNodes(s.expandedNodes,s._start)}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._setExpandedLevel=function(){try{var e=0,t=null;if(1==this.options.alwaysDraw)for(e=0;e<this.tree.size();e++)t=this.tree.hash_index_node[e],this._expandNode(t);else for(e=0;e<this.tree.size();e++)(t=this.tree.hash_index_node[e]).depth<=this.options.showTreeDepth&&this._expandNode(t)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.toHTML=function(){try{var e=[],t=this.nativeScrollWidth+"px",i=""==this.options.style?"":"style='"+this.options.style+"' ",o="style='right:"+t+";'",s="style='right:"+t+"; height:"+t+";'",a="style='width:"+t+";'";return e.push("<div id='"+this.id+"' tabindex='0' "+i+"class='w2treeview_virtual "+this.options.className+"'>"),e.push("  <div id='"+this.id+"_main_div' "+o+" class='w2treeview_virtual_main_div' >"),e.push("  </div>"),e.push("  <div id='"+this.id+"_scrollX_div' "+s+" class='w2treeview_virtual_scrollX_div'>"),e.push("      <div id='"+this.id+"_scrollX_scrollbar' style='width:1px; height:1px; visibility:hidden;'></div>"),e.push("  </div>"),e.push("  <div id='"+this.id+"_scrollY_div' "+a+" class='w2treeview_virtual_scrollY_div' >"),e.push("      <div id='"+this.id+"_scrollY_scrollbar' style='width:1px; height:1px; visibility:hidden;'></div>"),e.push("  </div>"),this.options.useDrop&&e.push("<div id='"+this.id+"_drop_div' class='w2treeview_virtual_drop_div'></div>"),e.push("</div>"),e.join("")}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setAction=function(){try{var e;if(this.useDataCollection&&(e=this.modelControl.getDataComp())&&e._getDelayedRefreshComponent&&e._getDelayedRefreshComponent(this.id)&&(this.refreshItemset(),e._setDelayedRefreshComponent(this.id,!1)),this.dom[this.id+"_main_div"]=document.getElementById(this.id+"_main_div"),this.dom[this.id+"_scrollX_div"]=document.getElementById(this.id+"_scrollX_div"),this.dom[this.id+"_scrollX_scrollbar"]=document.getElementById(this.id+"_scrollX_scrollbar"),this.dom[this.id+"_scrollY_div"]=document.getElementById(this.id+"_scrollY_div"),this.dom[this.id+"_scrollY_scrollbar"]=document.getElementById(this.id+"_scrollY_scrollbar"),this.tree.rootNode?this.redraw(!0):this._updateScroll(),this.event.addListener(this.render,"onclick",this.event.bindAsEventListener(this,this.handleClickEvent)),this.event.addListener(this.render,"ondblclick",this.event.bindAsEventListener(this,this.handleDblclickEvent)),this.event.addListener(this.render,"onmouseover",this.event.bindAsEventListener(this,this.handleMouseoverEvent)),this.event.addListener(this.render,"onmouseout",this.event.bindAsEventListener(this,this.handleMouseoutEvent)),this.event.addListener2(this.dom[this.id+"_main_div"],"onmousewheel",this.handleMouseWheelEvent,this),this.event.addListener2(this.dom[this.id+"_main_div"],"onscroll",this.fixScrollTop,this),this.options.iwsSupport?this.addClass("w2noselect"):this.event.addListener(this.render,"onselectstart",(function(e){r.f.stopEvent(e)})),this.event.addListener(this.render,"oncontextmenu",this.event.bindAsEventListener(this,this.handleContextmenuEvent)),this.event.addListener(this.render,"onmousedown",this.event.bindAsEventListener(this,this.activateDrag)),this.event.addListener(this.render,"onkeydown",this.event.bindAsEventListener(this,this.handleKeydownEvent)),this.event.addListener2(this.dom[this.id+"_scrollX_div"],"onscroll",this.handleScrollXEvent,this),this.event.addListener2(this.dom[this.id+"_scrollY_div"],"onscroll",this.handleScrollYEvent,this),this.refreshStop=!1,
this.useDataCollection)(e=this.modelControl.getDataComp()).bind("onbeforecelldatachange",this.event.bindAsEventListener(this,this.notifyValidCheck));c.q.addCheckResize(this.uuid,"checkResize")}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._redraw=function(e,t,i){try{for(var o=[],s=0,a=e.length;s<a;s++)o.push(this.nodeToHTML(e[s]));if(document.getElementById(this.id+"_main_div").innerHTML=o.join(""),1==t){var l=0;this._forceRedraw=!0,this._iterateAllExpandedNodes(this._expandedNodes,(function(e){l+=e.childNodes.length})),this._updateScroll(l)}i&&i.call(this)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._getNativeScrollWidth=function(){var e=document.createElement("div");e.style="overflow-y:scroll; visibility:hidden; width:100px;",document.body.appendChild(e);var t=document.createElement("div");e.appendChild(t);var i=100-t.offsetWidth;return document.body.removeChild(e),i},p.prototype._updateScroll=function(e){var t=this.getElementById(this.id+"_main_div"),i=this.getElementById(this.id+"_scrollY_div"),o=this.getElementById(this.id+"_scrollX_div"),s=this.getElementById(this.id+"_scrollY_scrollbar"),a=this.getElementById(this.id+"_scrollX_scrollbar"),l=t.clientWidth,n=t.scrollWidth,h=this._getVisibleInfo(),d=h.height,r=l<n,c=r?this.nativeScrollWidth:0,p=e>t.childNodes.length||d>=t.offsetHeight-c,u=0;if(p){var f=Math.max(t.offsetHeight-d-c,0),m=Math.floor(f/this._maxRowHeight);if((u=e-h.rowCount-m)<=0&&(u=0,p=!1,e-t.childNodes.length>0&&0===i.scrollTop)){var g=this._buildTree(0,e);return this._getData(g)}}this._bExtraRowRedraw=!1,i.style.visibility=p?"visible":"hidden",t.style.right=p?this.nativeScrollWidth+"px":0,o.style.visibility=r?"visible":"hidden",o.style.right=p?this.nativeScrollWidth+"px":0;var b=u*this.options.rowHeight+t.offsetHeight,x=p?n+this.nativeScrollWidth:n;s.style.height=b+"px",a.style.width=x+"px"},p.prototype.expandNode=function(e,t,i){try{var o=null;if(o="number"==typeof e?this.tree.findNodeByIndex(e):this.tree.findNodeByValue(e),this._expandNode(o),t)for(var s=0,a=o.childNodes.length;s<a;s++)this.expandNode(o.childNodes[s].index,t);this.refreshStop||!0===i||this.redraw(!0)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.collapseNode=function(e,t){try{var i=null;if(i="number"==typeof e?this.tree.findNodeByIndex(e):this.tree.findNodeByValue(e),this._collapseNode(i),t)for(var o=0,s=i.childNodes.length;o<s;o++)this.collapseNode(i.childNodes[o].index,t);this.redraw(!0)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.findNodeByValue=function(e,t){try{var i=this.tree.findNodeByValue(e);if(!0===t&&i){var o=i.index*this.options.rowHeight,s=WebSquare.style.getAbsoluteTop(this.render)+this.render.offsetHeight,a=this.dom[this.id+"_scrollY_div"].scrollTop;return s<o?(a+s<o||a>=o)&&(this.dom[this.id+"_scrollY_div"].scrollTop=o-s+parseInt(this.render.offsetHeight/2)):(a+s<o||a>=o)&&(this.dom[this.id+"_scrollY_div"].scrollTop=0),this.selectNode(e,null),this.getSelectedNode()}return i}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.findNodeByIndex=function(e,t){try{if(!0===t){var i=this.tree.findNodeByIndex(e);if(!i)return;var o=i.index*this.options.rowHeight,s=WebSquare.style.getAbsoluteTop(this.render)+this.render.offsetHeight,a=this.dom[this.id+"_scrollY_div"].scrollTop;return s<o?(a+s<o||a>=o)&&(this.dom[this.id+"_scrollY_div"].scrollTop=o-s+parseInt(this.render.offsetHeight/2)):(a+s<o||a>=o)&&(this.dom[this.id+"_scrollY_div"].scrollTop=0),this.selectNode(null,e),this.getSelectedNode()}return this.tree.findNodeByIndex(e)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.toggleChild=function(e,t,i){try{var o;if(null==t&&(t=-1),null!=e&&(o=this.tree.findNodeByValue(e))&&(t=o.index),(o=this.tree.findNodeByIndex(t)).isLeaf())return;if(1==this.options.accordion)for(var s=o._getAncestor(),a=1,l=this.tree.size();a<l;a++)this.tree.hash_index_node[a]._getAncestor()!=s&&this._collapseNode(this.tree.hash_index_node[a]);switch(i){case!0:this._expandNode(o);break;case!1:
this._collapseNode(o);break;default:o.isExpanded()?this._collapseNode(o):this._expandNode(o)}this.redraw(!0)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.appendData=function(e,t,i){try{if(0==this.options.dynamicAppend){var o=WebSquare.language.getMessage("Treeview_warning1")||"If you are processing the treeview dynamically, it is recommended to set dynamicAppend='true'";$l(o+"["+this.id+"]")}if(void 0===e||null==e||!t)return;i=void 0!==i&&i;var s=this.tree.findNodeByIndex(e);if(!i&&s.childNodes&&s.childNodes[0]&&s.childNodes[0].rendered)return;var a=null;"recursive"==this.options.dataType?a=this.tree.parseRecursiveToTree(t):"listed"==this.options.dataType&&(a=this.tree.parseListToTree(t)),this.tree.appendXML(a,e),0==e?(s.hasChild(),this.redraw()):s.childNodes.length>0&&(s.childNodes[0].rendered=!1,this.toggleChild(null,s.index,!0))}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.spanAll=function(e){try{if(1==this.options.accordion){var t=WebSquare.language.getMessage("Treeview_warning2","spanAll")||"The spanAll API is not supported in treeview's accordion mode.";return void $l(t+"["+this.id+"]")}var i=this.tree.size();if(1==e)for(var o=0;o<i;o++)this._expandNode(this.tree.hash_index_node[o]);else if(0==e)for(o=i-1;o>=0;o--)this.tree.hash_index_node[o].expandedNodes=[];this.redraw(!0)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.spanNode=function(e,t,i){try{return null==e&&null==t&&null==i?void 0:null==t&&null==i&&"object"==typeof e?this._spanNode(e):null==i&&"object"==typeof e&&"boolean"==typeof t?this._spanNode(e,t):this._spanNode({index:e,applyChildNodes:i},t)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._spanNode=function(e,t){try{if(1==this.options.accordion){var i=WebSquare.language.getMessage("Treeview_warning2","spanNode")||"The spanNode API is not supported in treeview's accordion mode.";return void $l(i+"["+this.id+"]")}var o=e.index,s=e.depth,a=e.applyChildNodes;if(0==o||o){var l=(c=this.findNodeByIndex(o)).childNodes;if(1==t){if(1==a)for(var n=0;n<l.length;n++)l[n].childNodes.length>0&&this.spanNode(l[n].index,t,a)}else if(0==t&&1==a)for(n=l.length-1;n>=0;n--)l[n].childNodes.length>0&&this.spanNode(l[n].index,t,a);this.toggleChild(null,o,t)}else if(0==s||s)for(var h=0,r=this.tree.nodeCount;h<r;h++){var c;if((c=this.tree.hash_index_node[h]).depth===s){if("boolean"==typeof a)for(var p=c.childNodes,u=(n=0,p.length);n<u;n++)p[n].childNodes.length>0&&this.spanNode(p[n].index,t,a);this.toggleChild(null,c.index,t)}}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.selectNode=function(e,t,i,o,a){try{"object"==typeof a&&null!=a||(a={});i=void 0===i||i;var l=s.Z.getBoolean(this.options.useHirarchySelect),n=this.selectedInfo.node?this.tree.getCloneNode(this.selectedInfo.node):null,h=null,c=this.options.multiselect&&(a.ctrlKey||a.shiftKey);if(null!=e?h=this.tree.findNodeByValue(e):null!=t&&(h=this.tree.findNodeByIndex(t)),this.options.multiselect)if(c){if(a.ctrlKey){var p=this.multiSelectedInfo.indexOf(h.index);if(p>=0){var u=this.multiSelectedInfo[p];if(this.multiSelectedInfo.splice(p,1),!(this.multiSelectedInfo.length>0))return this.deselectNode();h=this.tree.findNodeByIndex(this.multiSelectedInfo[this.multiSelectedInfo.length-1]),n=this.tree.findNodeByIndex(u),this._deselectNodeByIndex(u)}else this.multiSelectedInfo.push(h.index)}else if(a.shiftKey){var f=this.multiSelectedInfo.length-1,m=this.multiSelectedInfo[f];if(m!==h.index){for(var g=m>h.index?-1:1,b=[],x=m+g;x*g<=h.index*g;x+=g){(v=this.multiSelectedInfo.indexOf(x))>=0?b.push(v):this.multiSelectedInfo.push(x)}b.length>0&&b.push(f),b.sort((function(e,t){return Number(t)-Number(e)}));for(x=0;x<b.length;x++){var v=b[x],y=this.multiSelectedInfo[v];this.multiSelectedInfo.splice(v,1),this._deselectNodeByIndex(y)}return this._selectNodeMulti()}}}else this._deselectNodeMulti(),this.multiSelectedInfo.push(h.index);if(this.selectedInfo.dom&&!c&&(this.removeClass(this.selectedInfo.dom,this.options.labelonClickClass),
this.removeClass(this.selectedInfo.groupDom,this.options.selectedClass),this.selectedInfo.dom.style.backgroundColor=this.originalBackgroundColor,this.selectedInfo.dom.style.color=this.originalColor,""!=this.selectedInfo.node.image)){var N=this.selectedInfo.node,_=document.getElementById(this.id+"_icon_"+N.index),I=N.isExpanded()?N.expandedImage:N.image;if(_){var k=this.getURL(I);_.style="background-image:url("+k+")"}}if(l&&this.selectedInfoStack.length>0){for(x=0;x<this.selectedInfoStack.length;x++){var C=this.selectedInfoStack[x];C.dom&&(this.removeClass(C.dom,this.options.labelonClickClass),this.removeClass(this.selectedInfo.groupDom,this.options.selectedClass),C.dom.style.backgroundColor=C.org.background,C.dom.style.color=C.org.color)}this.selectedInfoStack=[]}if(!0!==a.skipEvent&&(null!=n&&null!=h?n.index!=h.index&&r.f.fireEvent(this,"onchange",n,h):(null==n&&null!=h||null!=n&&null==h)&&r.f.fireEvent(this,"onchange",n,h)),this.selectedInfo.node=h,null!=this.selectedInfo.node&&i){for(var w=this.selectedInfo.node.parentNode,S=[];w;){t=w.index;S.push(t),w=w.parentNode}for(var x in S.reverse(),S)this._expandNode(this.findNodeByIndex(S[x]));this.redraw(!0)}if(this.selectedInfo.dom=document.getElementById(this.id+"_label_"+this.selectedInfo.node.index),this.selectedInfo.groupDom=document.getElementById(this.id+"_node_"+this.selectedInfo.node.index),this.addClass(this.selectedInfo.dom,this.options.labelonClickClass),this.addClass(this.selectedInfo.groupDom,this.options.selectedClass),""!=this.selectedInfo.node.image&&""!=this.selectedInfo.node.selectedImage)if(_=document.getElementById(this.id+"_icon_"+this.selectedInfo.node.index)){this.originalIconImage=_.style;k=this.getURL(this.selectedInfo.node.selectedImage);_.style="background-image:url("+k+")"}if(this.selectedInfo.dom){if(this.originalBackgroundColor=this.selectedInfo.dom.style.backgroundColor,this.originalColor=this.selectedInfo.dom.style.color,l){for(w=this.selectedInfo.node;w;){var D=document.getElementById(this.id+"_label_"+w.index);this.selectedInfoStack.push({node:w,groupDom:document.getElementById(this.id+"_node_"+w.index),dom:D,org:{background:D?D.style.backgroundColor:null,color:D?D.style.color:null}}),this.selectedInfoStack[this.selectedInfoStack.length-1].dom&&(this.addClass(this.selectedInfoStack[this.selectedInfoStack.length-1].dom,this.options.labelonClickClass),this.addClass(this.selectedInfoStack[this.selectedInfoStack.length-1].groupDom,this.options.selectedClass),this.selectedInfoStack[this.selectedInfoStack.length-1].dom.style.backgroundColor="",this.selectedInfoStack[this.selectedInfoStack.length-1].dom.style.color=""),w=w.parentNode}this.selectedInfoStack.reverse()}this.selectedInfo.dom.style.backgroundColor="",this.selectedInfo.dom.style.color=""}if(!0!==o){if(this.options.scrollFix)this.render.focus();else if(this.selectedInfo.groupDom&&(this.selectedInfo.groupDom.setAttribute("tabindex",0),this.selectedInfo.groupDom.focus(),this.selectedInfo.groupDom.setAttribute("tabindex",-1),!0!==a.skipScrollTop)){var T=this.getElementById(this.id+"_main_div"),E=this.selectedInfo.groupDom.offsetTop+this.selectedInfo.groupDom.offsetHeight-T.offsetHeight;E>0&&(this.dom[this.id+"_scrollY_div"].scrollTop+=Math.ceil(E/this.options.rowHeight)*this.options.rowHeight)}if(this.useDataCollection&&this.successBinding){var P=this.modelControl.getDataComp();if(null!=this.selectedInfo.node){for(var B in P.refCompHash){var M=P.refCompHash[B];null!=M&&WebSquare.idCache[M.uuid]&&"input"==M.options.pluginName&&M.setValue(M.getValue())}P.setRowPosition(this.selectedInfo.node.index-1)}else P.setRowPosition(null)}}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.selectNode1=function(e,t,i,o,s){try{var a=this.options.multiselect&&s&&s.ctrlKey,l={oldNode:{},newNode:null},n=null;if(null!=this.selectedInfo.node&&(l.oldNode=this.tree.getCloneNode(this.selectedInfo.node),n=l.oldNode.index),this.selectNode(e,t,i,o,s),null!=this.selectedInfo.node){var h=this.selectedInfo.node.index
;null==n||n!=h?l.newNode=this.tree.getCloneNode(this.selectedInfo.node):a&&(l.newNode=this.tree.findNodeByIndex(t))}else a&&(l.newNode={});null!=l.newNode&&r.f.fireEvent(this,"onviewchange",l)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._selectNodeMulti=function(e){try{"object"==typeof e&&null!=e||(e={});var t={skipScrollTop:!0,skipEvent:!0,ctrlKey:!0},i=this.multiSelectedInfo.slice(0);this.multiSelectedInfo=[];for(var o=0;o<i.length;o++)this.selectNode(null,i[o],!1,!0===e.noFocus,t)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.isOpen=function(e){try{if(e>=this.tree.size()||e<1)return;return this.findNodeByIndex(e).isExpanded()}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getSelectedNode=function(){try{return this.selectedInfo?this.selectedInfo.node:null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getSelectedDom=function(){try{return this.selectedInfo?this.selectedInfo.dom:null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getSelectedLabel=function(){try{return this.selectedInfo&&this.selectedInfo.node?this.selectedInfo.node.label:""}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getSelectedValue=function(){try{return this.selectedInfo&&this.selectedInfo.node?this.selectedInfo.node.value:""}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getSelectedIndex=function(){try{return this.selectedInfo&&this.selectedInfo.node?this.selectedInfo.node.index:""}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getSelectedElement=function(){try{return this.selectedInfo&&this.selectedInfo.node?this.selectedInfo.node.element:null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setLabelStyle=function(e,t,i,o){var s;"object"==typeof e&&"number"==typeof e.index?s=e:"number"==typeof e?s=this.tree.findNodeByIndex(e):"string"==typeof e&&(s=this.tree.findNodeByValue(e)),this._setLabelStyle(s,t,i,o)},p.prototype._setLabelStyle=function(e,t,i,o){if(null!=e){for(t in null==e.labelStyle&&(e.labelStyle={}),e.labelStyleStr="",e.labelStyle[t]=i,this.originalBackgroundColor=e.labelStyle["background-color"]||this.originalBackgroundColor,this.originalColor=e.labelStyle.color||this.originalColor,e.labelStyle)e.labelStyleStr+=t+":"+e.labelStyle[t]+";";if(e.rendered){var s=document.getElementById(this.id+"_label_"+e.index);if(s){for(var a="",l=0,n=t.length;l<n;l++)"-"===t.charAt(l)?(a+=t.charAt(l+1).capitalize(),l++):a+=t.charAt(l);s.style[a]=i}}if(!0===o)for(l=0,n=e.childNodes.length;l<n;l++){var h=e.childNodes[l];this._setLabelStyle(h,t,i,o)}}},p.prototype.disableCheckboxByValue=function(e,t,i){try{var o=this.tree.findNodeByValue(e);o&&this.disableCheckbox(o,t,i)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setLabelByIndex=function(e,t,i){this.setLabel(this.tree.findNodeByIndex(e),t,i)},p.prototype.setLabelByValue=function(e,t,i){this.setLabel(this.tree.findNodeByValue(e),t,i)},p.prototype.setLabel=function(e,t,i){try{if(e){var o=this.refreshStop;if(this.refreshStop=!0,this.useDataCollection||(this.modelControl.useItemset&&WebSquare.ModelUtil.setInstanceValue(e.xpath+"/"+this.tree.xpath.label,t),WebSquare.xml.setValue(e.element,"label",t)),"function"==typeof this.tree.customFormatter){var s=this.tree.getCloneNode(e);t=this.tree.customFormatter.call(this,t,t,s)}if(e.label=t,e.orgLabel=t,e.rendered){var a=document.getElementById(this.id+"_label_"+e.index);a&&(a.innerHTML=t)}if(this.refreshStop=o,this.useDataCollection){var l=this.modelControl.getDataComp();null!=l&&l.setCellData(e.index-1,this.tree.dataPath.label,t,null,i)}}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.checkNode=function(e,t,i,o,s){try{var a=this.tree.findNodeByIndex(e);a.checked=t;var l=document.getElementById(this.id+"_checkbox_"+e);if(l&&(l.checked=t),1==this.options.refreshCheckboxModel){if(this.stopRefresh(!0),this.useDataCollection&&this.tree.checkbox.colID){var n=this.modelControl.getDataComp(),h=t?this.options.trueValue:this.options.falseValue
;null!=n&&n.setCellData(e-1,this.tree.checkbox.colID,h,null,s)}else 1==t?a.checkboxXPath&&null!=WebSquare.ModelUtil.findInstanceNode(a.checkboxXPath)&&WebSquare.ModelUtil.setInstanceValue(a.checkboxXPath,this.options.trueValue):a.checkboxXPath&&null!=WebSquare.ModelUtil.findInstanceNode(a.checkboxXPath)&&WebSquare.ModelUtil.setInstanceValue(a.checkboxXPath,this.options.falseValue);this.stopRefresh(!1)}if(!1!==i&&(1==i||1==this.options.hierarchy||1==this.options.checkAllChildNodes))for(var r=0,c=a.childNodes.length;r<c;r++){var p=a.childNodes[r];this.checkNode(p.index,t,!0,!1)}if(1==this.options.hierarchy&&this.partialSelection(a),!1!==o&&a.parentNode.parentNode&&1==this.options.hierarchy){var u=!0;for(r=0,c=a.parentNode.childNodes.length;r<c;r++){if(1!=(p=a.parentNode.childNodes[r]).checked){u=!1;break}}1==u?this.checkNode(a.parentNode.index,!0,!1):this.checkNode(a.parentNode.index,!1,!1)}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.checkByIndex=function(e,t,i){try{var o=this.tree.findNodeByIndex(e);if(!o)return;this.checkNode(o.index,t,i)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.checkByValue=function(e,t,i){try{var o=this.tree.findNodeByValue(e);if(!o)return;this.checkNode(o.index,t,i)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getCheckedNodeByType=function(e,t){try{"object"==typeof e&&null!=e||(e={});for(var i=[],o=this.tree.getNodeIterator({type:"bfs"});o.next();){var s=o.getNode();(1==s.checked||e.hierarchy&&1==s.partial&&!s.isRoot())&&(e.excludeRoot&&!s.isRoot()||!e.excludeRoot)&&i.push(s[t])}return i}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getCheckedValues=function(e){return this.getCheckedNodeByType(e,"value")},p.prototype.getCheckedLabels=function(e){return this.getCheckedNodeByType(e,"label")},p.prototype.getCheckedIndexes=function(e){return this.getCheckedNodeByType(e,"index")},p.prototype.getCheckedNodes=function(e){return this.getCheckedNodeByType(e,"element")},p.prototype.disableCheckbox=function(e,t,i){try{if(t=s.Z.getBoolean(t),e.checkboxDisabled=t,1==this.options.refreshCheckboxDisableModel&&(this.stopRefresh(!0),1==t?null!=WebSquare.ModelUtil.findInstanceNode(e.checkboxDisableXPath)&&WebSquare.ModelUtil.setInstanceValue(e.checkboxDisableXPath,this.options.checkboxDisabledTrueValue):null!=WebSquare.ModelUtil.findInstanceNode(e.checkboxDisableXPath)&&WebSquare.ModelUtil.setInstanceValue(e.checkboxDisableXPath,this.options.checkboxDisabledFalseValue),this.stopRefresh(!1)),!0===i||!1===i)for(var o=0,a=e.childNodes.length;o<a;o++){var l=e.childNodes[o];this.disableCheckbox(l,t,i)}this.redraw(!1)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.partialSelection=function(e){try{var t=0,i=!1;if(0==e.childNodes.length)return;for(var o=0,s=e.childNodes.length;o<s;o++){var a=e.childNodes[o];1==a.checked?t++:1==a.partial&&(i=!0)}1==i||0<t&&t<e.childNodes.length?(e.partial=!0,this.addClass(e.checkboxDom,"treeview_partialselect")):(e.partial=!1,this.removeClass(e.checkboxDom,"treeview_partialselect"))}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getParentValue=function(e){try{var t="",i=this.tree.findNodeByValue(e);return i&&i.parentNode&&(t=i.parentNode.value),t}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getChildData=function(e,t){try{for(var i=this.tree.findNodeByValue(e),o=[],s=0,a=i.childNodes.length;s<a;s++)1==this.options.dynamicAppend||this.useDataCollection?o.push(i.childNodes[s].element):o.push(WebSquare.ModelUtil.findInstanceNode(i.childNodes[s].xpath)),1==t&&(o=o.concat(this.getChildData(i.childNodes[s].value,!0)));return o}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getChildNodes=function(e,t){try{for(var i=this.tree.findNodeByValue(e),o=[],s=0;s<i.childNodes.length;s++)o.push(i.childNodes[s]),1==t&&(o=o.concat(this.getChildNodes(i.childNodes[s].value,!0)));return o}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setCustomFormatter=function(e){if("function"==typeof e){
for(var t=this.tree.getNodeIterator();t.next();){var i=t.getNode();if(!i.isRoot()){var o=this.tree.getCloneNode(i),s=e.call(this,i.orgLabel,i.label,o)||i.label;if(i.label=s,i.rendered){var a=document.getElementById(this.id+"_label_"+i.index);a&&(a.firstChild.nodeValue=i.label)}}}t=null,this.tree.customFormatter=e}},p.prototype.appendNode=function(e,t){try{if(0==this.options.dynamicAppend){var i=WebSquare.language.getMessage("Treeview_warning1")||"If you are processing the treeview dynamically, it is recommended to set dynamicAppend='true'";$l(i+"["+this.id+"]")}if(1==this.options.dynamicAppend){var o=e.childNodes?e.childNodes.length+1:1,s=t.parentNode,a=this.tree.parseNodeByNode(t,e.depth+1,o,e);e.appendChild(a);for(var l=0,n=s.expandedNodes.length;l<n;l++){var h=s.expandedNodes[l];if(t.index===h.index){s.expandedNodes.splice(l,1);break}}for(l=0,n=e.childNodes.length;l<n;l++)this.tree.setRender(e.childNodes[l],!1);e.childNodes.length>0&&(e.childNodes[0].rendered=!1,e.expandedNodes.push(a),this.toggleChild(null,e.index,!0))}else e.appendChild(t),e.expandedNodes.push(t),this.toggleChild(null,e.index,!0)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.removeNode=function(e){try{if(!e)return;var t=e.parentNode;t&&(e.isExpanded()&&this._collapseNode(e),t.removeChild(e),this.redraw(!0))}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.removeNodeList=function(e){try{for(var t=0;t<e.length;t++)if(e[t]){var i=e[t].parentNode;i&&i.removeChild(e[t])}this.drawContents()}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.moveNode=function(e,t,i){try{if(!this.useDataCollection)return!1;if(e==t)return!1;if(this._isParentRelation(e,t))return a.v.printLog("treeview moveNode : Invalid argument. [destIndex] must not be child of [srcIndex].["+this.id+"]"),!1;for(var o=this.modelControl.getDataComp(),s=e-1,l=t-1,n=this.findNodeByIndex(e),h=this.findNodeByIndex(t),r=this.getLastChildIndex(s+1)-1,c=[],p=[],u=this.tree.dataPath.depth,f=0,m=s;m<=r;m++){var g=o.getRowJSON(m);g[u]=i?Number(g[u])+(h.depth-n.depth+1):Number(g[u])+(h.depth-n.depth),"number"!==o.getColumnInfo(u).dataType&&(g[u]=g[u]+""),c.push(g),f++,p.push(m)}var b=0;if(!i){var x=this.getLastChildIndex(t);b=x-t,t<=s&&x>=r&&(b-=f)}this.stopRefresh(!0),o.removeRange(s,r),this.stopRefresh(!1),this.notifyRemovedRows(p.join(","),!1,{skipRedraw:!0}),s<l&&(l+=s-r-1);var v=l+1+b;this.stopRefresh(!0),o.insertJSON(v,c),this.stopRefresh(!1);var y=[];for(m=0;m<f;m++)y.push(v+m);return this.notifyInsertData(y.join(","),!1,{skipRedraw:!0}),this.redraw(!0),this.selectNode(null,v+1),!0}catch(e){return d.Y.printStackTrace(e,null,this),!1}},p.prototype.getLastChildIndex=function(e){try{var t=this.findNodeByIndex(e),i=e;if(t.hasChild()){i=this.tree.nodeCount-1;for(var o=t;!o.isRoot()&&o.depthIndex==o.parentNode.childNodes.length;)o=o.parentNode;o.isRoot()||o.depthIndex==o.parentNode.childNodes.length||(i=o.parentNode.childNodes[o.depthIndex].index-1)}return i}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.activateDrag=function(e){try{this.options.iwsSupport||r.f.stopEvent(e);var t=s.Z.getDataPrefix("index"),i=s.Z.getDataPrefix("tdIndex");1==WebSquare.getBody().getLayerListener().existShow&&WebSquare.getBody().getLayerListener().hideAll();var o=this,a=this.event.getTargetIterator(e,this.render);if(a.element.id===this.id)return;for(var l=!1,n=!1,h=!1,c=!1,p=!1;a.next();)if((a.match("treeview_icon_open")||a.match("treeview_icon_close"))&&(n=!0),a.match("treeview_label")&&(p=!0),(a.match("treeview_icon_navi")||a.match("treeview_icon_navi_img"))&&(l=!0),a.match("treeview_icon_label")&&(h=!0),a.match("treeview_checkbox")&&(c=!0),a.match("treeview_virtual_node")){var u=Number(a.getElement().getAttribute(t));if(null==u){a.stop();break}if("onmousedown"==this.options.toggleButtonEvent){var f=this.tree.findNodeByIndex(u);if(l&&!f.isLeaf()){this.toggleChild(null,u);var m=!!(f.childNodes&&f.childNodes[0]&&f.childNodes[0].rendered)
;this.inlineElement?r.f.fireEvent(this,"ontoggleclick",null,u,m):r.f.fireEvent(this,"ontoggleclick",f.element,u,m)}}if(!this.options.multiselect&&(p||c||h||l||n)&&this.selectNode1(null,u,!1,!0),1==this.options.useDrag){var g=this.tree.hash_index_node[u].label,b="treeview_label";if(this.options.useDrop){var x=document.getElementById(this.id+"_node_"+u);if(x){for(var v="",y=0;y<x.childNodes.length;y++){var N=x.childNodes[y];("SPAN"!==N.tagName.toUpperCase()||this.hasClass(N,"treeview_icon_label"))&&(v+=N.outerHTML)}this.multiSelectedInfo.length>1&&(v+="<span class='treeview_count'>"+this.multiSelectedInfo.length+"</span>"),g=v}b="treeview_virtual_node"}WebSquare.dragdrop.gDragManager.activate(e,a.getElement(),{id:this.id+"_drag",className:"w2treeview_drag",contents:g,delay:15,dropClass:"treeview_virtual_node",dragoverClass:b,applyMousePosition:!0,handleStart:function(e){o.options.multiselect&&-1===o.multiSelectedInfo.indexOf(u)&&o.selectNode(null,u,!1,!0,{skipEvent:!0})},onDrop:function(e,a,l,n,h,d,c){if(o.options.useDrop){var p=document.getElementById(o.id+"_drop_div");if(p&&(p.style.display="none"),!isNaN(o._oldDropNodeIndex)){var u=document.getElementById(o.id+"_node_"+o._oldDropNodeIndex),f=document.getElementById(o.id+"_label_"+o._oldDropNodeIndex);o.removeClass(f,o.options.labelonClickClass),o.removeClass(u,o.options.selectedClass),o._oldDropNodeIndex=null}}if(e){var m=null,g={},b=null,x=null,v=null;for(g=a?new WebSquare.targetIterator(a,o.render):o.event.getTargetIterator(c);g.next();){if(g.match("w2treeview_virtual")){var y=g.getElement().id;s.Z.getComponentById(y)&&(m=s.Z.getComponentById(y)),g.stop()}if(g.match("w2grid")&&(b=g.getElement().id,g.stop()),!x&&g.match(null,null,"td")){var N=g.getElement();x=parseInt(N.getAttribute(i),10)}}if(g=null,m&&!a&&(a=document.getElementById(m.id+"_node_0")),e&&a&&m){var _,I=Number(e.getAttribute(t)),k=Number(a.getAttribute(t)),C=o.tree.findNodeByIndex(I),w=m.tree.findNodeByIndex(k);if(m.options.useDrop){_=-1;var S=d-(a.offsetTop-e.offsetTop);o.options.iwsSupport&&Math.abs(S)<o.options.iwsDropDelta?_=0:S>0&&(_=1)}!1!==r.f.fireEvent(m,"ondrop",C,w,o,m,c,_)&&m.options.useDrop&&!o.options.iwsSupport&&m.moveSelectedNode(k,_)}if(null!=b&&(v=(b=s.Z.getComponentById(b)).getDataLength(),null!=x&&(v=b.rowIndex+parseInt(x/(b.oneRowDataLength+b.defaultColCnt)))),e&&b){I=parseInt(e.getAttribute(t),10)-1;if(o.useDataCollection)var D=o.modelControl.getDataComp();C=o.tree.findNodeByIndex(I+1);r.f.fireEvent(b,"ondropfromtree",{dataListId:D.id,fromRowIndex:I,toRowIndex:v,dragNode:C})}}},onDragover:function(e,i,a,l,n,h,d){(i||r.f.fireEvent(o,"ondragleave",d),o.options.useDrop)&&((_=document.getElementById(o.id+"_drop_div"))&&(_.style.display="none"));if(e&&i){for(var c=null,p=new WebSquare.targetIterator(i,o.render);p.next();)if(p.match("w2treeview_virtual")){var u=p.getElement().id;s.Z.getComponentById(u)&&(c=s.Z.getComponentById(u)),p.stop()}if(p=null,c){var f=Number(e.getAttribute(t)),m=i.getAttribute("id"),g=Number(m.substring(m.lastIndexOf("_")+1,m.length)),b=o.tree.findNodeByIndex(f),x=c.tree.findNodeByIndex(g),v=r.f.fireEvent(c,"ondragover",b,x,o,c,d);if(o.options.useDrop&&!1!==v){var y=-1,N=h-(i.offsetTop-e.offsetTop);o.options.iwsSupport&&Math.abs(N)<o.options.iwsDropDelta?y=0:N>0&&(y=1);var _=document.getElementById(o.id+"_drop_div");if(0===y){if(!isNaN(o._oldDropNodeIndex)&&-1===o.multiSelectedInfo.indexOf(o._oldDropNodeIndex)){var I=document.getElementById(o.id+"_node_"+o._oldDropNodeIndex),k=document.getElementById(o.id+"_label_"+o._oldDropNodeIndex);o.removeClass(k,o.options.labelonClickClass),o.removeClass(I,o.options.selectedClass)}var C=document.getElementById(o.id+"_node_"+g),w=document.getElementById(o.id+"_label_"+g);o.addClass(w,o.options.labelonClickClass),o.addClass(C,o.options.selectedClass),o._oldDropNodeIndex=g}else if(_){var S=i.offsetTop;1===y&&(S+=i.offsetHeight),_.style.display="block",_.style.top=S+"px"}var D=Number(g);-1===y&&(D=g-1);var T=o._getValidDropNodeArr(D)
;!T||T.length}}}}})}a.stop()}a=null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getNextNode=function(e){for(var t=null,i=e.index,o=0,s=this._items.length;o<s;o++)if(this._items[o].index==i){t=this._items[o+1];break}return t},p.prototype.getPreviousNode=function(e){for(var t=null,i=e.index,o=0,s=this._items.length;o<s;o++)if(this._items[o].index==i){t=this._items[o-1];break}return t},p.prototype.showTooltip=function(e,t,i){try{null!=this.timeShowTooltip&&(clearTimeout(this.timeShowTooltip),this.timeShowTooltip=null),null!=this.timeHideTooltip&&(clearTimeout(this.timeHideTooltip),this.timeHideTooltip=null);var o=this;this.timeShowTooltip=setTimeout(this.event.bindAsEventListener(this,(function(){try{var a=h.I.getConfiguration("/WebSquare/tooltipShowHideHandler/@value");if(a){var l=s.Z.getGlobalFunction(a,o.scope_id),n=!0;if("function"==typeof l&&(n=l(o)),!n)return}}catch(e){d.Y.printStackTrace(e)}this.tooltip||(this.tooltip=new WebSquare.uiplugin.group(this.id+"_tooltip",{className:"w2treeview_tooltip "+this.options.tooltipClass}),this.tooltip.writeTo(WebSquare.getBody(),null,this.parentFrame),this.tooltip.activate(),this.options.tooltipGroupClass||this.tooltip.removeClass("w2group")),this.tooltip.setStyle("display","block"),this.tooltip.setStyle("left",e+"px"),this.tooltip.setStyle("top",t+"px"),this.options.escape&&(i=WebSquare.xml._encode(i+"")),this.tooltip.render.innerHTML=i})),1e3*this.options.tooltipTime)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.hideTooltip=function(){try{this.timeHideTooltip=setTimeout(this.event.bindAsEventListener(this,(function(){this.tooltip&&this.tooltip.setStyle("display","none")})),1e3*this.options.tooltipTime)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.onPropertyChange=function(e,t){try{if("disabled"===e)this.options.disabled=t,t?this.addClass(this.render,"w2treeview_disabled"):this.removeClass(this.render,"w2treeview_disabled")}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setDisabled=function(e){e=s.Z.getBoolean(e);var t=c.q.prototype.setDisabled.call(this,e);return this.disableCheckbox(this.tree.rootNode,e,!0),t},p.prototype.setEditMode=function(e){try{var t=document.getElementById(this.id+"_label_"+e);if(null==this.editModeComp||null==this.editModeComp.render){this.editModeComp=new WebSquare.uiplugin.input(this.id+"_input"),this.editModeComp.writeTo(t.parentNode),this.editModeComp.activate();var i=this.uuid;this.editModeComp.bind("onblur",(function(){var e=WebSquare.idCache[i],t=e.modelControl.getDataComp();if(t){var o=this._oldValue,s=this.getValue();t.setCellData(this._index-1,e.tree.dataPath.label,s)}else e.setLabelByIndex(this._index-1,s);e.appendChild(this),this.render.style.display="none",document.getElementById(e.id+"_label_"+this._index).style.display="",this.setValueNM(""),r.f.fireEvent(e,"oneditend",{oldValue:o,newValue:s,index:this._index})})),this.editModeComp.bind("onkeydown",(function(e){r.f.stopPropagation(e)})),this.editModeComp.bind("onmousedown",(function(e){r.f.stopPropagation(e)})),this.editModeComp.bind("onselectstart",(function(e){r.f.stopPropagation(e)}))}else this.editModeComp.render.style.display="",t.parentNode.appendChild(this.editModeComp.render);this.editModeComp._index=e,t.style.display="none",this.editModeComp.setVerticalAlign=function(){};var o=this.findNodeByIndex(e);o&&""!=o.label&&(this.editModeComp.setValueNM(o.label),this.editModeComp._oldValue=o.label),this.editModeComp.focus()}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.handleClickEvent=function(e){try{for(var t=!1,i=!1,o=!1,a=!1,l=s.Z.getDataPrefix("index"),n=s.Z.getDataPrefix("value"),c=this.event.getTargetIterator(e,this.render);c.next();)if((c.match("treeview_icon_open")||c.match("treeview_icon_close"))&&(t=!0),c.match("treeview_checkbox")&&(o=!0),c.match("treeview_label")&&(i=!0),c.match("treeview_icon_label")&&(a=!0),c.match("treeview_virtual_node")){
var p=c.getElement().getAttribute(l),u=c.getElement().getAttribute(n),f=this.tree.findNodeByIndex(p);if(t&&"onmousedown"!==this.options.toggleButtonEvent){this.toggleChild(null,p);var m=f.childNodes&&f.childNodes[0]&&f.childNodes[0].rendered;this.inlineElement?r.f.fireEvent(this,"ontoggleclick",null,p,m):r.f.fireEvent(this,"ontoggleclick",f.element,p,m)}if(o&&!f.checkboxDisabled){var g=!f.checked;this.checkNode(p,g),this.inlineElement?r.f.fireEvent(this,"oncheckboxclick",u,null,p):1==this.options.dynamicAppend||this.useDataCollection?r.f.fireEvent(this,"oncheckboxclick",u,f.element,p):r.f.fireEvent(this,"oncheckboxclick",u,WebSquare.ModelUtil.findInstanceNode(f.xpath),p)}i&&("onclick"===this.options.toggleEvent&&this.toggleChild(null,p),this.inlineElement?r.f.fireEvent(this,"onlabelclick",u,null,p):r.f.fireEvent(this,"onlabelclick",u,f.element,p)),a&&(this.inlineElement?r.f.fireEvent(this,"onImageclick",u,null,p):r.f.fireEvent(this,"onImageclick",u,f.element,p));var b=h.I.getConfiguration("/WebSquare/treeview/useClickEventToggleButton/@value"),x=s.Z.getBoolean(this.options.noFocusOnIconLabelClick||h.I.getConfiguration("/WebSquare/treeview/noFocusOnIconLabelClick/@value"));if(i||o||t&&"false"!=b){var v={shiftKey:e.shiftKey,ctrlKey:e.ctrlKey};this.selectNode1(null,p,!1,x,v),r.f.fireEvent(this,"onclick",u,p)}c.stop()}c=null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.handleToggleEvent=function(e){try{for(var t=!1,i=this.event.getTargetIterator(e,this.render);i.next();)if(i.match("treeview_label")&&(t=!0),t&&i.match("treeview_virtual_node")){var o=s.Z.getDataPrefix("index"),a=i.getElement().getAttribute(o);this.toggleChild(null,a),i.stop()}i=null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.handleScrollXEvent=function(e){var t=this.dom[this.id+"_scrollX_div"].scrollLeft,i=t-this.oldScrollLeft;this.dom[this.id+"_main_div"].scrollLeft+=i,this.oldScrollLeft=t,r.f.stopEvent(e)},p.prototype.handleScrollYEvent=function(e){if(!0!==this._bSkipScrollY){var t=this.uuid,i=function(){var e=WebSquare.idCache[t],i={skipScrollTop:!0};if(e._arrowDownPressed){var o=e.getNextNode(e.selectedInfo.node);o||(o=e.selectedInfo.node),e.selectNode1(null,o.index,!1,!1,i),e._arrowDownPressed=!1}else if(e._arrowUpPressed){var s=e.getPreviousNode(e.selectedInfo.node);s||(s=e.selectedInfo.node),e.selectNode1(null,s.index,!1,!1,i),e._arrowUpPressed=!1}else if(e.options.multiselect)e._selectNodeMulti();else if(e.selectedInfo.node)for(var a=0;a<e._items.length;a++)if(e._items[a]==e.selectedInfo.node){e.selectNode1(null,e.selectedInfo.node.index,!1,!1,i);break}},o=this._checkScrollEnd();this.options.redrawInterval>0?(h.I.clearTimer(this.id+"_redraw"),h.I.setTimer((function(){WebSquare.idCache[t].redraw(o,i)}),{key:this.id+"_redraw",caller:this,delay:this.options.redrawInterval})):(0==this.options.redrawInterval||this._forceRedraw)&&(this.redraw(o,i),this._forceRedraw=!1),r.f.stopEvent(e)}},p.prototype.handleMouseWheelEvent=function(e){var t,i=e||window.event,o=i.detail,s=i.wheelDelta,a=1;o=(o=o?s&&(a=s/o)?o/a:-o/1.35:s/120)<1?o<-1?(-Math.pow(o,2)-224)/225:o:(Math.pow(o,2)+224)/225,t=e.deltaY?e.deltaY:-180*Math.min(Math.max(o/2,-1),1),this.dom[this.id+"_scrollY_div"].scrollTop+=t,r.f.stopEvent(e)},p.prototype.handleKeydownEvent=function(e){try{var t,i=e.charCode?e.charCode:e.keyCode,o=s.Z.getDataPrefix("index");this.selectedInfo.node?(this.selectedInfo.groupDom,t=this.selectedInfo.node.index):t=(e.srcElement||e.target).getAttribute(o),t||(t=0);var a=this.tree.findNodeByIndex(t);if(37===i||39===i||13===i){var l=37!==i;13===i?this.toggleChild(null,t,null):this.toggleChild(null,t,l);var n=this;this.redraw(!1,(function(){n.selectNode1(null,n.selectedInfo.node.index,!1,!1)}));var h=!!(a.childNodes&&a.childNodes[0]&&a.childNodes[0].rendered);this.inlineElement?r.f.fireEvent(this,"ontoggleclick",null,t,h):r.f.fireEvent(this,"ontoggleclick",a.element,t,h),r.f.stopEvent(e)}else if(38===i){
if(this.options.scrollFix)return void(this.dom[this.id+"_scrollY_div"].scrollTop-=1.5*this.options.rowHeight);var c=null;0==t?(t=1,c=this.tree.findNodeByIndex(t)):c=this.getPreviousNode(a),c?c.index&&this.selectNode1(null,c.index,!1):(this.dom[this.id+"_scrollY_div"].scrollTop-=2*this.options.rowHeight,this._arrowUpPressed=!0),r.f.stopEvent(e)}else if(40===i){if(this.options.scrollFix)return void(this.dom[this.id+"_scrollY_div"].scrollTop+=1.5*this.options.rowHeight);c=null;0==t?(t=1,c=this.tree.findNodeByIndex(t)):c=this.getNextNode(a),c?c.index&&this.selectNode1(null,c.index,!1):(this.dom[this.id+"_scrollY_div"].scrollTop+=2*this.options.rowHeight,this._arrowDownPressed=!0),r.f.stopEvent(e)}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.handleDblclickEvent=function(e){try{for(var t=!1,i=this.event.getTargetIterator(e,this.render);i.next();)if(i.match("treeview_label")&&(t=!0),t&&i.match("treeview_virtual_node")){var o=s.Z.getDataPrefix("index"),a=i.getElement().getAttribute(o),l=this.tree.findNodeByIndex(a).value;t&&("ondblclick"!==this.options.toggleEvent&&""!==this.options.toggleEvent||this.toggleChild(null,a)),r.f.fireEvent(this,"ondblclick",l,a),i.stop()}i=null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.handleMouseoverEvent=function(e){try{this.options.iwsSupport||r.f.stopEvent(e);for(var t=s.Z.getDataPrefix("index"),i=s.Z.getDataPrefix("value"),o=this.event.getTargetIterator(e,this.render);o.next();)if(o.match("treeview_label")){if(this.addClass(o.getElement(),"treeview_over"),this.options.tooltipDisplay||this.options.tooltipShowAlways){var a=o.getElement(),l=WebSquare.style.getAbsoluteLeft(a),n=WebSquare.style.getAbsoluteTop(a),h=a.firstChild.nodeValue,c=WebSquare.style.getAbsoluteLeft(this.render),p=!1;if(this.options.tooltipDisplay)if(l+a.offsetWidth>c+this.render.clientWidth+this.render.scrollLeft)p=!0;else if(s.Z.isIEAllVersion()&&!s.Z.isIE(6)&&!s.Z.isIE(7)){var u=a.style.display;a.style.display="block",a.clientWidth<a.scrollWidth&&(p=!0),a.style.display=u}if(p||this.options.tooltipShowAlways){var f=s.Z.getGlobalFunction(this.options.tooltipFormatter,this.scope_id);if(f&&"function"==typeof f){for(var m=new WebSquare.targetIterator(a,this.render),g=-1;m.next();)m.match("treeview_virtual_node")&&(g=m.getElement().getAttribute(t),m.stop());m=null;try{h=f(h,g,!!p||a.offsetWidth<a.scrollWidth)}catch(e){d.Y.printStackTrace(e,null,this)}}""!=h&&this.showTooltip(l,n,h)}}m=new WebSquare.targetIterator(o.getElement(),this.render),g=-1;for(var b="",x=null;m.next();)m.match("treeview_virtual_node")&&(g=m.getElement().getAttribute(t),b=m.getElement().getAttribute(i),x=this.tree.findNodeByIndex(g),m.stop());m=null,r.f.fireEvent(this,"onlabelover",g,x.element,b)}o=null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.handleMouseoutEvent=function(e){try{this.options.iwsSupport||r.f.stopEvent(e),(this.options.tooltipDisplay||this.options.tooltipShowAlways)&&this.hideTooltip();for(var t=this.event.getTargetIterator(e,this.render);t.next();)t.match("treeview_label")&&this.removeClass(t.getElement(),"treeview_over");t=null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.handleContextmenuEvent=function(e){try{this.options.iwsSupport||r.f.stopEvent(e);for(var t=!1,i=!1,o=!1,a=!1,l=s.Z.getDataPrefix("index"),n=this.event.getTargetIterator(e,this.render);n.next();){if(n.match("treeview_label")&&(a=!0),n.match("treeview_icon_navi")&&(t=!0),n.match("treeview_icon_label")&&(i=!0),n.match("treeview_checkbox")&&(o=!0),n.match("treeview_virtual_node")){var h=Number(n.getElement().getAttribute(l));if(t&&this.toggleChild(null,h),o){var c=document.getElementById(this.id+"_checkbox_"+h).checked;this.checkNode(h,c)}if(a||o||i){var p=this.options.multiselect&&(e.ctrlKey||e.shiftKey),u=this.options.multiselect&&this.multiSelectedInfo.indexOf(h)>=0;p||u||this.selectNode1(null,h),r.f.fireEvent(this,"onrightbuttonclick",this.findNodeByIndex(h),r.f.getMouseX(e),r.f.getMouseY(e))}n.stop()}
n.match("w2treeview_virtual")&&0===this.tree.nodeCount&&(r.f.fireEvent(this,"onrightbuttonclick",null,r.f.getMouseX(e),r.f.getMouseY(e)),n.stop())}n=null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.nodeToHTML=function(e){if(!e)return"";try{e.rendered=!0;var t=[],i="",o="",a="",l="",n="",h="",r="",c="",p="";if(this.options.customFormatter&&(this.tree.customFormatter=s.Z.getGlobalFunction(this.options.customFormatter,this.scope_id)),"function"==typeof this.tree.customFormatter){var u=this.tree.getCloneNode(e),f=this.tree.customFormatter.call(this,e.orgLabel,e.label,u)||e.label;c=this.options.escape?WebSquare.xml._encode(e.label+""):f,p=this.options.escape?WebSquare.xml._encode(e.value+""):e.value}else c=this.options.escape?WebSquare.xml._encode(e.label+""):e.label,p=this.options.escape?WebSquare.xml._encode(e.value+""):e.value;if(e.hasChild()){var m=e.isExpanded();i=m?"opened":"closed",o=m?"treeview_icon_close":"treeview_icon_open",a=m?"background: url("+this.options.folderCloseToggleImage+") no-repeat center center":"background: url("+this.options.folderOpenToggleImage+") no-repeat center center";var g=e.parentNode.childNodes;g&&g[g.length-1]==e&&(i+=" lastParentSibling")}else i="leaf",o=this.options.lineShow?e.isFirstChildByRoot()?1==e.parentNode.childNodes.length?"treeview_root_single_leaf":"treeview_root_multi_leaf":e.isLastChild()?"treeview_last_sibling":"treeview_leaf":"";var b=s.Z.getDataPrefix("index"),x=s.Z.getDataPrefix("value"),v=s.Z.getDataPrefix("depth");i+=" w2tree_depth_"+e.depth,"string"==typeof e.nodeCss&&e.nodeCss&&(i+=" "+e.nodeCss),t.push("<div id='"+this.id+"_node_"+e.index+"' tabindex='-1' class='treeview_virtual_node "+i+"' "+b+"='"+e.index+"' "+x+"='"+p+"' "+v+"='"+e.depth+"' style='height:"+this.options.rowHeight+"px;'>");var y=!1,N=[];if(this.options.lineShow){var _=e._getAncestor();if(_){n="treeview_guideline",h="width: 16px;";var I=e;for(y=!0,_.isLastChild()&&N.push(!1);I!=_;)N[I.depth-1]=!I.isLastChild(),I=I.parentNode}else n="treeview_no_guideline",h="width:"+16*(e.depth-1)+"px;"}else n="treeview_no_guideline",h="width:"+16*(e.depth-1)+"px;";if(y)for(var k=0;k<e.depth-1;k++)n=0==N[k]?"treeview_no_guideline":"treeview_guideline",t.push("<span class='"+n+"' style='"+h+"'> </span>");else t.push("<span class='"+n+"' style='"+h+"'> </span>");if(t.push("<span class='treeview_icon_navi "+o+"' style='"+a+"'></span>"),""!=e.image){var C=e.isExpanded()?e.expandedImage:e.image,w=this.getURL(C),S=e.imageTitle?"title='"+e.imageTitle+"'":"";t.push("<span id='"+this.id+"_icon_"+e.index+"' class='treeview_icon_label'"+S+" style='background-image:url("+w+")'></span>")}if(1==this.options.showCheckbox){var D=e.checked||e.partial?"checked='true' ":"",T=e.checkboxDisabled?"disabled='true' ":"",E=e.partial?"treeview_partialselect":"";!0===this.options.labelForCheckbox&&(r="for='"+this.id+"_checkbox_"+e.index+"'"),t.push("<input tabindex='-1' style='"+this.checkboxStyle+"' type='checkbox' "+D+T+" id='"+this.id+"_checkbox_"+e.index+"' class='treeview_checkbox "+E+"' />")}return e.labelStyleStr&&(l=e.labelStyleStr),t.push("<label "+r+" class='treeview_label "+this.options.labelclass+"' tabindex='-1' style='"+l+"' id='"+this.id+"_label_"+e.index+"'>"+c+"</label>"),t.push("</div>"),t.join("")}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.isLeaf=function(){try{return!this.selectedInfo||!this.selectedInfo.node||!this.selectedInfo.node.hasChild()}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._getDataObj=function(e){if(e){var t=WebSquare.WebSquareparser.parseItemset(e);this.modelControl.setItemset(t.nodeset,t.label,t.value),0==this.options.modelBinding&&(this.options.refreshCheckboxModel=!1,this.options.refreshCheckboxDisableModel=!1);var i={type:"",data:null},o=null,s=WebSquare.Elem.api.getElementsByTagName(e,"itemset",h.I._XML_NAMESPACE.W2)[0];if(s){var a=WebSquare.Elem.api.getValue(s,"@nodeset");this.useDataCollection=a.match("data:");var l=a.replace(/\[[^\[\]]*\]/g,"").match(/[^\/]*$/)
;l&&(l=l[0]);var n=WebSquare.Elem.api.getElementsByTagName(s,"label",h.I._XML_NAMESPACE.W2)[0],d=WebSquare.Elem.api.getElementsByTagName(s,"value",h.I._XML_NAMESPACE.W2)[0],r=WebSquare.Elem.api.getElementsByTagName(s,"depth",h.I._XML_NAMESPACE.W2)[0],c=WebSquare.Elem.api.getElementsByTagName(s,"folder",h.I._XML_NAMESPACE.W2)[0],p=null==n?"":n.getAttribute("ref"),u=null==d?"":d.getAttribute("ref"),f=null==r?"":r.getAttribute("ref"),m=null==c?"":c.getAttribute("ref"),g={image:"image",iconImage:"iconImage",selectedImage:"selectedImage",expandedImage:"expandedImage",leafImage:"leafImage",checkboxDisabled:"checkboxDisabled",imageTitle:"imageTitle",checkbox:"checkbox"};for(var b in g){var x=WebSquare.Elem.api.getElementsByTagName(s,""+b,h.I._XML_NAMESPACE.W2)[0];g[b]=null==x?"":x.getAttribute("ref")}var v=g.checkbox;this.useDataCollection&&this.tree.setDataPath(p,u,f,l,m,v);var y=g.image,N=g.iconImage,_=g.selectedImage,I=g.expandedImage,k=g.leafImage,C=g.checkboxDisabled,w=g.imageTitle;v=g.checkbox;if(y=this.options.defaultImage?this.options.defaultImage:y,N=this.options.iconImage?this.options.iconImage:N,_=this.options.selectedImage?this.options.selectedImage:_,I=this.options.expandedImage?this.options.expandedImage:I,k=this.options.leafImage?this.options.leafImage:k,C=this.options.checkboxDisabled?this.options.checkboxDisabled:C,this.tree.setXPath(a,p,u,f,l,m),this.tree.setCheckbox(v,this.options.trueValue,this.options.falseValue,C,this.options.checkboxDisabledTrueValue,this.options.checkboxDisabledFalseValue,this.options.checkboxDisabledAll,this.options.refreshCheckboxModel,this.options.refreshCheckboxDisableModel,this.options.hierarchy,g.checkbox),this.tree.setImage(y,N,k,_,I,w),this.useDataCollection)this.modelControl.getDataCollectionItemsetData(this.modelControl.id),null!=(o=this.modelControl.getDataComp())&&(i.type="dataList",i.data=o.id,this.successBinding=!0);else{var S=WebSquare.ModelUtil.findInstanceNodes(a,null,this.scope_id),D=null;null!=S&&("recursive"==this.options.dataType?D=this.tree.parseRecursiveToTree(S):"listed"==this.options.dataType&&(D=this.tree.parseListToTreeInstance(S))),i.type="xmlInstance",i.data=D,this.tree.isInstance=!0}}else{this.inlineElement=!0;var T="w2:";y=T+"image",N=T+"iconImage",_=T+"selectedImage",I=T+"expandedImage",k=T+"leafImage";y=""!=this.options.defaultImage?this.options.defaultImage:y,N=""!=this.options.iconImage?this.options.iconImage:N,_=""!=this.options.selectedImage?this.options.selectedImage:_,I=""!=this.options.expandedImage?this.options.expandedImage:I,k=""!=this.options.leafImage?this.options.leafImage:k,this.tree.setImage(y,N,k,_,I,T+"imageTitle"),this.tree.setCheckbox(T+"checkbox",this.options.trueValue,this.options.falseValue,T+"checkboxDisabled",this.options.checkboxDisabledTrueValue,this.options.checkboxDisabledFalseValue,this.options.checkboxDisabledAll,this.options.refreshCheckboxModel,this.options.refreshCheckboxDisableModel,this.options.hierarchy),i.type="inlineXML",i.data=e}return i}},p.prototype.refreshItemset=function(e){try{if(this.modelControl.isItemsetBinded()&&!this.refreshStop){this._initMaxRowHeight(),this.refreshStop=!0,this._expandedNodes=[];var t=this.tree.getNodeset(),i=!1;if(this.useDataCollection){var o;if(null!=(o=this.modelControl.getDataComp())){if(!this.successBinding){var s=(t=o.options.baseNode+"/"+o.options.repeatNode).replace(/\[[^\[\]]*\]/g,"").match(/[^\/]*$/);s&&(s=s[0]),this.tree.valueAttribute=o.options.valueAttribute?o.options.valueAttribute:"";var a=this.tree.dataPath.label,l=this.tree.dataPath.value,n=this.tree.dataPath.depth,h=this.tree.dataPath.folder,r=this.tree.dataPath.checkbox;this.tree.setDataPath(a,l,n,s,h,r),this.successBinding=!0,i=!0}this.tree.setData({type:"dataList",data:o.id})}}else{var c=WebSquare.ModelUtil.findInstanceNodes(t,null,this.scope_id),p=null
;null!=c&&("recursive"==this.options.dataType?p=this.tree.parseRecursiveToTree(c):"listed"==this.options.dataType&&(p=1==this.tree.isInstance?this.tree.parseListToTreeInstance(c):this.tree.parseListToTree(c))),this.tree.setData({type:"xmlInstance",data:p})}if(this._expandedNodes.push(this.tree.rootNode),this._setExpandedLevel(),i)if(e&&!0===e.setNodeSet){if(this.redraw(!0),this.useDataCollection)(o=this.modelControl.getDataComp()).bind("onbeforecelldatachange",this.event.bindAsEventListener(this,this.notifyValidCheck))}else this.setAction(),this.refreshStop=!0;else this.redraw(!0);if(this.useDataCollection)null!=(o=this.modelControl.getDataComp())&&o.getRowPosition();this.refreshStop=!1}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.refreshItemArr=function(){},p.prototype.setNodeSet=function(e,t){try{var i=t||{},o=e;if(e.indexOf("data:")>=0&&(o=e.replaceAll("data:","")),this.modelControl.getDataComp(o)){for(var s in this.useDataCollection=e.match("data:"),this.modelControl.unbindItemset(),this.modelControl.setItemset("data:"+o,i.label,i.value),this.modelControl.dataCollectionBindItemset(),this.modelControl.getDataCollectionItemsetData(this.modelControl.id),t)this.tree.dataPath[s]=t[s],"checkbox"===s&&(this.tree.checkbox.colID=t[s]);this.successBinding=!1,this.refreshItemset({setNodeSet:!0})}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.stopRefresh=function(e,t){try{this.refreshStop=s.Z.getBoolean(e),!0===t&&this.redraw(!0)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyValidCheck=function(e){try{if(e.colID===this.tree.dataPath.depth){var t=this.findNodeByIndex(e.rowIndex+1);if(e.newValue<1)throw{message:"Invalid value : [label : "+t.label+", newDepth : "+e.newValue+"]. The depthValue must be greater than 0."};if(e.oldValue&&e.newValue>e.oldValue&&t.isFirstChild())throw{message:"Invalid value : [label : "+t.label+", newDepth : "+e.newValue+"]. The depthValue must be less than "+(e.oldValue+1)}}return!0}catch(e){return d.Y.printStackTrace(e,null,this),!1}},p.prototype.notifyInvalid=function(){},p.prototype.notifySetCellData=function(e,t,i,o){try{if(this.refreshStop||parseInt(o,10)===parseInt(i,10))return;if(t===this.tree.dataPath.label)this.setLabelByIndex(e+1,i,!0);else if(t===this.tree.dataPath.checkbox)i==this.options.trueValue?this.checkNode(e+1,!0):i==this.options.falseValue&&this.checkNode(e+1,!1);else if(t===this.tree.dataPath.depth){if(Math.abs(i-o)>1)return void this.refreshItemset();this.stopRefresh(!0),this.notifyDepthChanged(e+1,i,o),this.stopRefresh(!1);var s=this.findNodeByIndex(e+1);s.parentNode===this.tree.rootNode?this.redraw():this.toggleChild(null,s.parentNode.index,!0)}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyDepthChanged=function(e,t,i){try{var o=this.findNodeByIndex(e),s=this.modelControl.getDataComp();if(this._initMaxRowHeight(),t>i){var a=(r=o.parentNode).childNodes[o.depthIndex-2],l=o.childNodes.splice(0,o.childNodes.length);r.childNodes.splice(o.depthIndex-1,1),o.parentNode=a,a.childNodes.push(o),o.depthIndex=a.childNodes.length,a.rendered=!1,o.rendered=!1;for(var n=0;n<l.length;n++)l[n].parentNode=a,a.childNodes.push(l[n]),l[n].depthIndex=a.childNodes.length,l[n].rendered=!1;r.childNodes[0].rendered=!1}else{if(o.hasChild())for(n=o.childNodes.length-1;n>=0;n--){var h=o.childNodes[n];s.setCellData(h.index-1,this.tree.dataPath.depth,h.depth-1),this.notifyDepthChanged(h.index,h.depth-1,h.depth)}var r,c=(r=o.parentNode).parentNode;if(o.depthIndex<r.childNodes.length){var p=r.childNodes.splice(o.depthIndex,r.childNodes.length-o.depthIndex);for(n=0;n<p.length;n++)p[n].parentNode=o,o.childNodes.push(p[n]),p[n].depthIndex=o.childNodes.length,p[n].rendered=!1}r.childNodes.splice(r.childNodes.length-1,1),o.parentNode=c,c.childNodes.splice(r.depthIndex,0,o);for(n=r.depthIndex;n<c.childNodes.length;n++)c.childNodes[n].depthIndex=n+1;c.childNodes[0].rendered=!1}o.depth=t,o.element.setAttribute(s.options.valueAttribute,t)}catch(e){
d.Y.printStackTrace(e,null,this)}},p.prototype.notifyInsertRow=function(e){try{if(this.refreshStop)return;this._initMaxRowHeight();var t=this.modelControl.getDataComp(),i=this.findNodeByIndex(e),o=new l;o.index=e+1,o.depthIndex=1,o.depth=i.depth+1,o.rendered=!1,o.parentNode=i;for(var s=t.getRowCount();s>=e+2;s--)this.tree.changeNodeIndex(s-1,s);this.tree.hash_index_node[e+1]=o,t.setCellData(e,this.tree.dataPath.depth,i.depth+1,null,!0);var a=t.getRowJSON(e);o.element=a,i.childNodes.unshift(o);for(s=0;s<i.childNodes.length;s++)i.childNodes[s].depthIndex=s+1;this.toggleChild(null,e,!0),this.tree.nodeCount=t.getRowCount()+1}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyInsertData=function(e,t,i){try{if(this.refreshStop||"string"!=typeof e||!0===t)return;"object"==typeof i&&null!=i||(i={});for(var o=e.split(",").sort((function(e,t){return Number(e)-Number(t)})),a=o.length,n=Number(o[0]),h=this.findNodeByIndex(n),r=h.hasChild()&&h.expandedNodes.length>0,c=h,p=this.tree.nodeCount-1;p>n;p--)this.tree.changeNodeIndex(p,p+a);for(var u=this.modelControl.getDataComp(),f=this.tree.dataPath.depth,m=this.tree.dataPath.label,g=this.tree.dataPath.value,b=this.tree.dataPath.checkbox,x=this.tree.dataPath.folder,v=0;v<a;v++){var y=Number(o[v]),N=u.getRowJSON(y);if((k=new l).element=N,k.index=y+1,k.rendered=!1,k.label=N[m],k.orgLabel=N[m],k.checked=N[b]===this.options.trueValue,k.value=N[g],k.folder=N[x],k.depth=N[f]>0?Number(N[f]):c.depth+1,Number(k.depth)<=Number(c.depth)){for(var _=Number(c.depth)-Number(k.depth),I=0;I<_&&null!=c;I++)c=c.parentNode;if(!c||!c.parentNode)return this.refreshItemset();k.parentNode=c.parentNode,this.tree._insertNode(k.parentNode.childNodes,c,k,!0),this.tree._insertNode(k.parentNode.expandedNodes,c,k,!0);for(I=0;I<k.parentNode.childNodes.length;I++)k.parentNode.childNodes[I].depthIndex=I+1}else{if(!(Number(k.depth)>Number(c.depth)))return this.refreshItemset();k.parentNode=c,v>0?(c.expandedNodes.push(k),c.childNodes.push(k)):(c.expandedNodes.unshift(k),c.childNodes.unshift(k));for(I=0;I<c.childNodes.length;I++)c.childNodes[I].depthIndex=I+1}c=k,this.tree.hash_index_node[n+v+1]=k,1==this.tree.useImage&&this.tree.parseDataListImage(k,!0)}if(!r&&h.hasChild()&&h.expandedNodes.length>0&&this._expandNode(h),this.tree.nodeCount=u.getRowCount()+1,a>0&&this.tree.hash_index_node[n].depth==this.tree.hash_index_node[n+1].depth){c=this.tree.hash_index_node[n];var k=this.tree.hash_index_node[n+1];for(p=0;p<c.childNodes.length;p++)k.childNodes.push(c.childNodes[p]),c.childNodes[p].parentNode=k;for(p=0;p<k.childNodes.length;p++)k.childNodes[p].depthIndex=p+1;for(p=0;p<c.expandedNodes.length;p++)k.expandedNodes.push(c.childNodes[p]);c.childNodes=[],c.expandedNodes=[]}!0!==i.skipRedraw&&s.Z.setTimeout((function(){this.redraw(!0)}),{delay:50,key:this.id+"_notifyInsertData",caller:this})}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyBeforeSetRowData=function(e,t){try{if(this.refreshStop)return;this._initMaxRowHeight();var i=this.modelControl.getDataComp();this.beforeSetRowData=t?{depth:i.getCellData(e,this.tree.dataPath.depth),label:i.getCellData(e,this.tree.dataPath.label),checkbox:i.getCellData(e,this.tree.dataPath.checkbox),overwrite:t}:{depth:Number(i.getCellData(e-1,this.tree.dataPath.depth))+1,label:"",checkbox:"",overwrite:t}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifySetRowData=function(e){try{if(this.refreshStop)return;this._initMaxRowHeight();var t,i=(t=this.modelControl.getDataComp()).getCellData(e,this.tree.dataPath.depth),o=t.getCellData(e,this.tree.dataPath.label),s=t.getCellData(e,this.tree.dataPath.checkbox);if(i!=this.beforeSetRowData.depth)if(this.notifyValidCheck({colID:this.tree.dataPath.depth,oldValue:this.beforeSetRowData.depth,newValue:i}))this.notifySetCellData(e,this.tree.dataPath.depth,i,this.beforeSetRowData.depth);else(t=this.modelControl.getDataComp()).setCellData(e,this.tree.dataPath.depth,this.beforeSetRowData.depth)
;o!=this.beforeSetRowData.label&&this.notifySetCellData(e,this.tree.dataPath.label,o,this.beforeSetRowData.label),s!=this.beforeSetRowData.checkbox&&this.notifySetCellData(e,this.tree.dataPath.checkbox,s,this.beforeSetRowData.checkbox),this.beforeSetRowData={},this.tree.nodeCount=t.getRowCount()+1}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyRemoveRow=function(e,t,i){try{if(this.refreshStop)return;"object"==typeof i&&null!=i||(i={}),isNaN(t)&&(t=1),this._initMaxRowHeight();var o=this.findNodeByIndex(e+1).parentNode;if(this.stopRefresh(!0),this.notifyRemoveRow_allChildren(e,t),this.stopRefresh(!1),0==o.index)o._hasChild=o.folder?null:0!=o.childNodes.length;else{var a=this.findNodeByIndex(e);if(a&&!a.isRoot()){if(a.isLastChild()){var l=document.getElementById(this.id+"_node_"+a.index);this.addClass(l,"w2treeview_last_sibling"),this.removeClass(l,"w2treeview_first_sibling"),a.isLeaf()&&this.addClass(l,"w2treeview_last_leaf")}else if(a.isFirstChild()){l=document.getElementById(this.id+"_node_"+a.index);this.addClass(l,"w2treeview_first_sibling")}if(a.parentNode.isLastChild()){var n=document.getElementById(this.id+"_guideline_"+a.parentNode.index);this.removeClass(n,"w2treeview_guideline"),this.addClass(n,"w2treeview_noguideline")}}}var h=this.modelControl.getDataComp();this.tree.nodeCount=h.getRowCount()+1,!0!==i.skipRedraw&&s.Z.setTimeout((function(){this.redraw(!0)}),{delay:50,key:this.id+"_notifyRemoveRow",caller:this})}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyRemoveRow_allChildren=function(e,t){try{this._initMaxRowHeight(),isNaN(t)&&(t=1);var i=this.findNodeByIndex(e+1),o=i.parentNode,s=this.modelControl.getDataComp(),a=e,l=s.getRowCount()+t,n=1;if(i.hasChild()){a=l-1;for(var h=i;!h.isRoot()&&h.depthIndex==h.parentNode.childNodes.length;)h=h.parentNode;h.isRoot()||h.depthIndex==h.parentNode.childNodes.length||(a=h.parentNode.childNodes[h.depthIndex].index-2);for(var r=[],c=e;c<a;c++)r.push(c),this.tree.clearNode(this.tree.findNodeByIndex(c+2),this.id),n++;s.removeRows(r)}o.childNodes.splice(i.depthIndex-1,1);for(c=i.depthIndex-1;c<o.childNodes.length;c++)o.childNodes[c].depthIndex=c+1;this.tree.clearNode(i,this.id);for(c=a+2;c<=l;c++)this.tree.changeNodeIndex(c,c-n);this.tree.nodeCount=s.getRowCount()+1}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyDataChanged=function(e){try{this.stopRefresh(!1),this.refreshItemset()}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.notifyRemovedRows=function(e,t,i){try{if(this.refreshStop||"string"!=typeof e||!0===t)return;"object"==typeof i&&null!=i||(i={});for(var o=e.split(",").sort((function(e,t){return Number(t)-Number(e)})),a=o.length,l=0;l<a;l++){var n=Number(o[l]);this.notifyRemoveRow(n,a-l,{skipRedraw:!0})}!0!==i.skipRedraw&&s.Z.setTimeout((function(){this.redraw(!0)}),{delay:50,key:this.id+"_notifyRemovedRows",caller:this})}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.getDataListInfo=function(){try{if(this.modelControl.isDataCollectionItemsetBinded){var e={};return e.id=this.modelControl.dataCollectionItemsetInfo.dataComp.id,e.nodeset=this.modelControl.itemsetObj.nodeset,e.label=this.modelControl.itemsetObj.label,e.value=this.modelControl.itemsetObj.value,e}return null}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.deselectNode=function(e){try{if(this.selectedInfo&&this.selectedInfo.node){var t=this.selectedInfo.node?this.tree.getCloneNode(this.selectedInfo.node):null,i=s.Z.getBoolean(this.options.useHirarchySelect);if(this.selectedInfo.dom&&(this.removeClass(this.selectedInfo.dom,this.options.labelonClickClass),this.removeClass(this.selectedInfo.groupDom,this.options.selectedClass),this.selectedInfo.dom.style.backgroundColor=this.originalBackgroundColor,this.selectedInfo.dom.style.color=this.originalColor),i&&this.selectedInfoStack.length>0){for(var o=0;o<this.selectedInfoStack.length;o++){var a=this.selectedInfoStack[o];a.dom&&(this.removeClass(a.dom,this.options.labelonClickClass),
a.dom.style.backgroundColor=a.org.background,a.dom.style.color=a.org.color),a.groupDom&&this.removeClass(a.groupDom,this.options.selectedClass)}this.selectedInfoStack=[]}r.f.fireEvent(this,"onchange",t,null),this.selectedInfo={groupDom:null,dom:null,node:null}}this._deselectNodeMulti()}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._deselectNodeMulti=function(e){try{for(;this.multiSelectedInfo.length>0;){var t=this.multiSelectedInfo.pop();this._deselectNodeByIndex(t)}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._deselectNodeByIndex=function(e){try{var t=document.getElementById(this.id+"_label_"+e);if(t){t.style.backgroundColor=this.originalBackgroundColor,t.style.color=this.originalColor,this.removeClass(t,this.options.labelonClickClass);var i=this.tree.findNodeByIndex(e);if(i&&i.image){var o=document.getElementById(this.id+"_icon_"+e);if(o){var s=i.isExpanded()?i.expandedImage:i.image,a=this.getURL(s);o.style="background-image:url("+a+")"}}}var l=document.getElementById(this.id+"_node_"+e);l&&this.removeClass(l,this.options.selectedClass)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setShowCheckBox=function(e){try{this.options.showCheckbox!=e&&(this.options.showCheckbox=e,this.redraw(!0))}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.checkResize=function(){try{if(this.render){var e=this.render.offsetWidth,t=this.render.offsetHeight;if(this.resizeObj&&e>0&&t>0){var i=this.uuid,o=function(){var e=WebSquare.idCache[i],t={skipScrollTop:!0};if(e.options.multiselect)e._selectNodeMulti();else if(e.selectedInfo.node)for(var o=0;o<e._items.length;o++)if(e._items[o]==e.selectedInfo.node){e.selectNode1(null,e.selectedInfo.node.index,!1,!1,t);break}};if(0==this.resizeObj.width&&0==this.resizeObj.height)this.redraw(!0,o);else{var s=e-this.resizeObj.width,a=t-this.resizeObj.height;0==s&&0==a||this.redraw(!0,o)}}this.resizeObj={width:e,height:t}}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.fixScrollTop=function(e){try{document.getElementById(this.id+"_main_div").scrollTop=0,WebSquare.event.preventDefault(e)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._checkScrollEnd=function(){try{var e=document.getElementById(this.id+"_scrollY_div");return e.scrollTop+this._epsilon>=e.scrollHeight-e.offsetHeight}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._getVisibleInfo=function(){try{for(var e=this.getElementById(this.id+"_main_div"),t=0,i=0,o=0;o<e.childNodes.length;o++){var s=e.childNodes[o].offsetHeight;t+=s,this._maxRowHeight=Math.max(this._maxRowHeight,s),this._minRowHeight=Math.min(this._minRowHeight,s),e.offsetHeight>=t&&i++}return{height:t,rowCount:i}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._getLastRowHeight=function(){try{var e=this.getElementById(this.id+"_main_div");return e.childNodes[e.childNodes.length-1].offsetHeight}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._getOverflowY=function(){try{var e=this.getElementById(this.id+"_main_div");return this._getVisibleInfo().height-e.offsetHeight}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._resizeY=function(e){try{if(isNaN(e)||0===Number(e))return;var t;t=e>0?Math.ceil(e/this.options.rowHeight)*this.options.rowHeight:Math.floor(e/this.options.rowHeight)*this.options.rowHeight;var i=this.getElementById(this.id+"_scrollY_scrollbar");i.style.height=i.offsetHeight+t+"px";var o=this.id+"_scrollY_div";s.Z.requestAnimationFrame((function(){document.getElementById(o).scrollTop+=t}))}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._initMaxRowHeight=function(){try{this._maxRowHeight=this.options.rowHeight||0,this._minRowHeight=this.options.rowHeight||0}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setNodeClass=function(e,t,i){try{var o;if("object"==typeof e&&"number"==typeof e.index?o=e:"number"==typeof e?o=this.tree.findNodeByIndex(e):"string"==typeof e&&(o=this.tree.findNodeByValue(e)),!o||!t||"string"!=typeof t)return
;if("string"==typeof o.nodeCss?-1===(" "+o.nodeCss+" ").indexOf(" "+t+" ")&&(o.nodeCss=(o.nodeCss+" "+t).replace(/\s\s/," ").wq_trim()):o.nodeCss=t,o.rendered){var s=document.getElementById(this.id+"_node_"+o.index);this.addClass(s,t)}if(!0===i)for(var a=0,l=o.childNodes.length;a<l;a++){var n=o.childNodes[a];this.setNodeClass(n,t,i)}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.removeNodeClass=function(e,t,i){try{var o;if("object"==typeof e&&"number"==typeof e.index?o=e:"number"==typeof e?o=this.tree.findNodeByIndex(e):"string"==typeof e&&(o=this.tree.findNodeByValue(e)),!o)return;var s="string"==typeof i&&i?i:o.nodeCss;if(o.rendered){var a=document.getElementById(this.id+"_node_"+o.index);this.removeClass(a,s)}if("string"==typeof o.nodeCss&&"string"==typeof i?o.nodeCss=(" "+o.nodeCss+" ").replace(new RegExp(" "+i+" ","g")," ").replace(/\s\s/," ").wq_trim():o.nodeCss="",!0===t)for(var l=0,n=o.childNodes.length;l<n;l++){var h=o.childNodes[l];this.removeNodeClass(h,t,i)}}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype.setTopNodeIndex=function(e){try{var t=this.tree.findNodeByIndex(e),i=Math.max(t._start-1,0)*this.options.rowHeight;this._bSkipScrollY=!0,document.getElementById(this.id+"_scrollY_div").scrollTop=i;var o=this.uuid;return new Promise((function(e,t){s.Z.requestAnimationFrame((function(){var t=WebSquare.idCache[o];t.redraw(false),t._bSkipScrollY=!1,e()}))})).catch((function(e){var t=WebSquare.idCache[o];t._bSkipScrollY=!1,d.Y.printStackTrace(e,null,t)}))}catch(e){this._bSkipScrollY=!1,d.Y.printStackTrace(e,null,this)}},p.prototype.moveSelectedNode=function(e,t){try{if(!this.useDataCollection)return!1;var i=this.modelControl.getDataComp(),o=Number(e);-1===t&&(o=e-1);var s=this._getValidDropNodeArr(o);if(!s.length)return a.v.printLog("treeview moveSelectedNode : Invalid argument. [destIndex] must not be child of [srcIndex].["+this.id+"]"),!1;for(var l=[],n=this.tree.dataPath.depth,h=this.tree.findNodeByIndex(o),r=h.depth,c=h.hasChild()?1:0,p=[],u=this._getIndexsWithChildren(s),f=0,m=this.getLastChildIndex(u[0]),g=0,b=0;b<u.length;b++){var x=u[b]-1;p.push(x);var v=i.getRowJSON(x),y=v[n],N=Number(y);0===b?g=r-N+c:b>m&&(m=this.getLastChildIndex(u[b]),g=r-N+c);var _=N+g;"number"!=typeof y&&(_=String(_)),v[n]=_,r=Number(_),l.push(v),o>x&&f++}return this.stopRefresh(!0),i.removeRows(p),this.stopRefresh(!1),this.notifyRemovedRows(p.join(","),!1,{skipRedraw:!0}),i.insertJSON(o-f,l),this.selectNode(null,o+1),!0}catch(e){return d.Y.printStackTrace(e,null,this),!1}},p.prototype._getIndexsWithChildren=function(e){try{if(!(e instanceof Array))return e;for(var t={},i=0;i<e.length;i++){var o=e[i];if(!0!==t[o]){for(var s=this.getLastChildIndex(o),a=o;a<=s;a++)t[a]=!0;t[o]=!0}}var l=[];for(var n in t)!0===t[n]&&l.push(Number(n));return l.sort((function(e,t){return Number(e)-Number(t)}))}catch(t){return d.Y.printStackTrace(t,null,this),e}},p.prototype._isParentRelation=function(e,t){try{return!isNaN(e)&&!isNaN(t)&&e!=t&&(e<t&&this.getLastChildIndex(e)>=t)}catch(e){d.Y.printStackTrace(e,null,this)}},p.prototype._getValidDropNodeArr=function(e){try{var t=[];this.options.multiselect?t=this.multiSelectedInfo.slice(0).sort((function(e,t){return Number(e)-Number(t)})):this.selectedInfo.node&&(t=[this.selectedInfo.node.index]);for(var i=[],o=0;o<t.length;o++)this._isParentRelation(t[o],e)||t[o]===e||i.push(t[o]);return i}catch(e){d.Y.printStackTrace(e,null,this)}}}}]);